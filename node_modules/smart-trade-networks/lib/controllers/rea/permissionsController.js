"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PermissionsController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var _deploy = require("../../ethereum/deploy/deploy");

var _encodeCall = require("../../ethereum/encodeCall");

var artifact = _interopRequireWildcard(require("../../ethereum/abi/Permissions.json"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var PermissionsController = /*#__PURE__*/function () {
  function PermissionsController(_permissionsAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, PermissionsController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_permissionsAddress", void 0);
    (0, _defineProperty2["default"])(this, "_permissionsContract", void 0);
    this._permissionsAddress = _permissionsAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(PermissionsController, [{
    key: "_getPermissionsContract",
    value: function () {
      var _getPermissionsContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._permissionsContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._permissionsContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getPermissionsContract)(this._permissionsAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._permissionsContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Permissions contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getPermissionsContract() {
        return _getPermissionsContract2.apply(this, arguments);
      }

      return _getPermissionsContract;
    }()
  }, {
    key: "getContract",
    value:
    /**Getters */
    function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context2.sent;
                return _context2.abrupt("return", permissionsContract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getPermission",
    value: function () {
      var _getPermission = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(action, companyAddress, nftAddress, signatorie) {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context3.sent;
                return _context3.abrupt("return", permissionsContract.getPermission(action, companyAddress, nftAddress, signatorie));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getPermission(_x, _x2, _x3, _x4) {
        return _getPermission.apply(this, arguments);
      }

      return getPermission;
    }()
  }, {
    key: "isSignerApproved",
    value: function () {
      var _isSignerApproved = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(companyAddress, signatorie) {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context4.sent;
                return _context4.abrupt("return", permissionsContract.isSignerApproved(companyAddress, signatorie));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function isSignerApproved(_x5, _x6) {
        return _isSignerApproved.apply(this, arguments);
      }

      return isSignerApproved;
    }()
  }, {
    key: "getCompaniesContract",
    value: function () {
      var _getCompaniesContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5() {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context5.sent;
                return _context5.abrupt("return", permissionsContract.getCompaniesContract());

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function getCompaniesContract() {
        return _getCompaniesContract.apply(this, arguments);
      }

      return getCompaniesContract;
    }()
    /**Setters */

  }, {
    key: "setCompaniesContract",
    value: function () {
      var _setCompaniesContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(newAddress) {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context6.sent;
                return _context6.abrupt("return", permissionsContract.functions.setCompaniesContract(newAddress));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function setCompaniesContract(_x7) {
        return _setCompaniesContract.apply(this, arguments);
      }

      return setCompaniesContract;
    }()
  }, {
    key: "setPermission",
    value: function () {
      var _setPermission = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(action, companyAddress, nftAddress, allow) {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context7.sent;
                return _context7.abrupt("return", permissionsContract.functions.setPermission(action, companyAddress, nftAddress, allow));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function setPermission(_x8, _x9, _x10, _x11) {
        return _setPermission.apply(this, arguments);
      }

      return setPermission;
    }()
  }, {
    key: "setPermissions",
    value: function () {
      var _setPermissions = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(actions, companyAddress, nftAddress, allow) {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context8.sent;
                return _context8.abrupt("return", permissionsContract.functions.setPermissions(actions, companyAddress, nftAddress, allow));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function setPermissions(_x12, _x13, _x14, _x15) {
        return _setPermissions.apply(this, arguments);
      }

      return setPermissions;
    }()
  }, {
    key: "setBoolPermissions",
    value: function () {
      var _setBoolPermissions = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(permissions, companyAddress, nftAddress) {
        var permissionsContract;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._getPermissionsContract();

              case 2:
                permissionsContract = _context9.sent;
                return _context9.abrupt("return", permissionsContract.functions.setBoolPermissions(permissions, companyAddress, nftAddress));

              case 4:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setBoolPermissions(_x16, _x17, _x18) {
        return _setBoolPermissions.apply(this, arguments);
      }

      return setBoolPermissions;
    }()
    /** Helpers */

  }], [{
    key: "deployPermissionsContract",
    value: function () {
      var _deployPermissionsContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee10(signer, owner, companiesAddress) {
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                return _context10.abrupt("return", (0, _deploy.deployPermissions)(signer, owner, companiesAddress));

              case 1:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10);
      }));

      function deployPermissionsContract(_x19, _x20, _x21) {
        return _deployPermissionsContract.apply(this, arguments);
      }

      return deployPermissionsContract;
    }()
  }, {
    key: "encodeCall",
    value: function encodeCall(functionName, args) {
      return (0, _encodeCall.encode)(artifact, functionName, args);
    }
  }, {
    key: "decodeCall",
    value: function decodeCall(data) {
      return (0, _encodeCall.decode)(artifact, data);
    }
  }]);
  return PermissionsController;
}();

exports.PermissionsController = PermissionsController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9yZWEvcGVybWlzc2lvbnNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIlBlcm1pc3Npb25zQ29udHJvbGxlciIsIl9wZXJtaXNzaW9uc0FkZHJlc3MiLCJzaWduZXJPclByb3ZpZGVyIiwiU2lnbmVyIiwiZXRoZXJzIiwicHJvdmlkZXJzIiwiSnNvblJwY1NpZ25lciIsIl9zaWduZXIiLCJ3ZWIzV3JhcHBlciIsIldlYjNQcm92aWRlciIsImdldFNpZ25lciIsIl9wZXJtaXNzaW9uc0NvbnRyYWN0IiwiY29udHJhY3QiLCJFcnJvciIsIl9nZXRQZXJtaXNzaW9uc0NvbnRyYWN0IiwicGVybWlzc2lvbnNDb250cmFjdCIsImFjdGlvbiIsImNvbXBhbnlBZGRyZXNzIiwibmZ0QWRkcmVzcyIsInNpZ25hdG9yaWUiLCJnZXRQZXJtaXNzaW9uIiwiaXNTaWduZXJBcHByb3ZlZCIsImdldENvbXBhbmllc0NvbnRyYWN0IiwibmV3QWRkcmVzcyIsImZ1bmN0aW9ucyIsInNldENvbXBhbmllc0NvbnRyYWN0IiwiYWxsb3ciLCJzZXRQZXJtaXNzaW9uIiwiYWN0aW9ucyIsInNldFBlcm1pc3Npb25zIiwicGVybWlzc2lvbnMiLCJzZXRCb29sUGVybWlzc2lvbnMiLCJzaWduZXIiLCJvd25lciIsImNvbXBhbmllc0FkZHJlc3MiLCJmdW5jdGlvbk5hbWUiLCJhcmdzIiwiYXJ0aWZhY3QiLCJkYXRhIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0lBeUJhQSxxQjtBQU1ULGlDQUFZQyxtQkFBWixFQUF5Q0MsZ0JBQXpDLEVBQTZFO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDekUsU0FBS0QsbUJBQUwsR0FBMkJBLG1CQUEzQjs7QUFFQSxRQUFHQyxnQkFBZ0IsWUFBWUMsY0FBNUIsSUFBc0NELGdCQUFnQixZQUFZRSxlQUFPQyxTQUFQLENBQWlCQyxh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Q0FBUDtBQUNIOzs7V0FFRCxvQkFBeUJFLElBQXpCLEVBQTJEO0FBQ3ZELGFBQU8sd0JBQU9ELFFBQVAsRUFBaUJDLElBQWpCLENBQVA7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJpZ051bWJlcmlzaCwgQ29udHJhY3RUcmFuc2FjdGlvbiwgZXRoZXJzLCBTaWduZXIgfSBmcm9tIFwiZXRoZXJzXCI7XG5cbmltcG9ydCB7IFBlcm1pc3Npb25zIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgeyBnZXRQZXJtaXNzaW9uc0NvbnRyYWN0IH0gZnJvbSBcIi4uLy4uL2NoYWluL3ByZWZhYkNvbnRyYWN0RmFjdG9yeVwiO1xuaW1wb3J0IHsgZGVwbG95UGVybWlzc2lvbnMgfSBmcm9tIFwiLi4vLi4vZXRoZXJldW0vZGVwbG95L2RlcGxveVwiO1xuaW1wb3J0IHsgZGVjb2RlLCBlbmNvZGUgfSBmcm9tIFwiLi4vLi4vZXRoZXJldW0vZW5jb2RlQ2FsbFwiO1xuaW1wb3J0ICogYXMgYXJ0aWZhY3QgZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2FiaS9QZXJtaXNzaW9ucy5qc29uXCJcbmltcG9ydCB7IFByb3ZpZGVyT3JTaWduZXIgfSBmcm9tIFwiLi4vLi4vbG9jYWxUeXBlc1wiO1xuaW1wb3J0IHsgRGVjb2RlZENhbGwgfSBmcm9tIFwiLi4vaGVscGVycy9hYmlEZWNvZGVyQ29udHJvbGxlclwiO1xuXG5leHBvcnQgdHlwZSBQZXJtaXNzaW9uc0Jvb2xBcnJheSA9XG4gICAgW1xuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuLFxuICAgICAgICBib29sZWFuXG4gICAgXVxuXG5cbmV4cG9ydCBjbGFzcyBQZXJtaXNzaW9uc0NvbnRyb2xsZXIge1xuXG4gICAgcHJpdmF0ZSBfc2lnbmVyOiBTaWduZXI7XG4gICAgcHJpdmF0ZSBfcGVybWlzc2lvbnNBZGRyZXNzIDogc3RyaW5nXG4gICAgcHJpdmF0ZSBfcGVybWlzc2lvbnNDb250cmFjdD8gOiBQZXJtaXNzaW9uc1xuXG4gICAgY29uc3RydWN0b3IoX3Blcm1pc3Npb25zQWRkcmVzczogc3RyaW5nLCBzaWduZXJPclByb3ZpZGVyOiBQcm92aWRlck9yU2lnbmVyKSB7XG4gICAgICAgIHRoaXMuX3Blcm1pc3Npb25zQWRkcmVzcyA9IF9wZXJtaXNzaW9uc0FkZHJlc3M7XG5cbiAgICAgICAgaWYoc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIFNpZ25lciB8fCBzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgZXRoZXJzLnByb3ZpZGVycy5Kc29uUnBjU2lnbmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9zaWduZXIgPSBzaWduZXJPclByb3ZpZGVyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgd2ViM1dyYXBwZXIgPSBuZXcgZXRoZXJzLnByb3ZpZGVycy5XZWIzUHJvdmlkZXIoc2lnbmVyT3JQcm92aWRlcikgXG4gICAgICAgICAgICB0aGlzLl9zaWduZXIgPSB3ZWIzV3JhcHBlci5nZXRTaWduZXIoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZ2V0UGVybWlzc2lvbnNDb250cmFjdCgpOiBQcm9taXNlPFBlcm1pc3Npb25zPiB7XG4gICAgICAgIGlmKHRoaXMuX3Blcm1pc3Npb25zQ29udHJhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wZXJtaXNzaW9uc0NvbnRyYWN0XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ29ubmVjdCB0byB0aGUgY29udHJhY3Qgd2l0aCBteSBzaWduZXJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgZ2V0UGVybWlzc2lvbnNDb250cmFjdCh0aGlzLl9wZXJtaXNzaW9uc0FkZHJlc3MsIHRoaXMuX3NpZ25lcilcbiAgICAgICAgICAgIHRoaXMuX3Blcm1pc3Npb25zQ29udHJhY3QgPSBjb250cmFjdDtcbiAgICAgICAgICAgIHJldHVybiBjb250cmFjdFxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgRmFpbGVkIHRvIGdldCBQZXJtaXNzaW9ucyBjb250cmFjdDogJHtlfWApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGRlcGxveVBlcm1pc3Npb25zQ29udHJhY3Qoc2lnbmVyOiBTaWduZXIsIG93bmVyOiBzdHJpbmcsIGNvbXBhbmllc0FkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8UGVybWlzc2lvbnM+IHtcbiAgICAgICAgcmV0dXJuIGRlcGxveVBlcm1pc3Npb25zKHNpZ25lciwgb3duZXIsIGNvbXBhbmllc0FkZHJlc3MpO1xuICAgIH1cblxuICAgIC8qKkdldHRlcnMgKi9cbiAgICBwdWJsaWMgYXN5bmMgZ2V0Q29udHJhY3QoKTogUHJvbWlzZTxQZXJtaXNzaW9ucz4ge1xuICAgICAgICBjb25zdCBwZXJtaXNzaW9uc0NvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0UGVybWlzc2lvbnNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcGVybWlzc2lvbnNDb250cmFjdFxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRQZXJtaXNzaW9uKGFjdGlvbjogQmlnTnVtYmVyaXNoLCBjb21wYW55QWRkcmVzczogc3RyaW5nLCBuZnRBZGRyZXNzOiBzdHJpbmcsIHNpZ25hdG9yaWU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBwZXJtaXNzaW9uc0NvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0UGVybWlzc2lvbnNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcGVybWlzc2lvbnNDb250cmFjdC5nZXRQZXJtaXNzaW9uKGFjdGlvbiwgY29tcGFueUFkZHJlc3MsIG5mdEFkZHJlc3MsIHNpZ25hdG9yaWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBpc1NpZ25lckFwcHJvdmVkKGNvbXBhbnlBZGRyZXNzOiBzdHJpbmcsIHNpZ25hdG9yaWU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBwZXJtaXNzaW9uc0NvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0UGVybWlzc2lvbnNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcGVybWlzc2lvbnNDb250cmFjdC5pc1NpZ25lckFwcHJvdmVkKGNvbXBhbnlBZGRyZXNzLCBzaWduYXRvcmllKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0Q29tcGFuaWVzQ29udHJhY3QoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgcGVybWlzc2lvbnNDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFBlcm1pc3Npb25zQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIHBlcm1pc3Npb25zQ29udHJhY3QuZ2V0Q29tcGFuaWVzQ29udHJhY3QoKTtcbiAgICB9XG5cbiAgICAvKipTZXR0ZXJzICovXG4gICAgcHVibGljIGFzeW5jIHNldENvbXBhbmllc0NvbnRyYWN0KG5ld0FkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBwZXJtaXNzaW9uc0NvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0UGVybWlzc2lvbnNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcGVybWlzc2lvbnNDb250cmFjdC5mdW5jdGlvbnMuc2V0Q29tcGFuaWVzQ29udHJhY3QobmV3QWRkcmVzcyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHNldFBlcm1pc3Npb24oYWN0aW9uOiBCaWdOdW1iZXJpc2gsIGNvbXBhbnlBZGRyZXNzOiBzdHJpbmcsIG5mdEFkZHJlc3M6IHN0cmluZywgYWxsb3c6IGJvb2xlYW4pOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgcGVybWlzc2lvbnNDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFBlcm1pc3Npb25zQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIHBlcm1pc3Npb25zQ29udHJhY3QuZnVuY3Rpb25zLnNldFBlcm1pc3Npb24oYWN0aW9uLCBjb21wYW55QWRkcmVzcywgbmZ0QWRkcmVzcywgYWxsb3cpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBzZXRQZXJtaXNzaW9ucyhhY3Rpb25zOiBBcnJheTxCaWdOdW1iZXJpc2g+LCBjb21wYW55QWRkcmVzczogc3RyaW5nLCBuZnRBZGRyZXNzOiBzdHJpbmcsIGFsbG93OiBib29sZWFuKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IHBlcm1pc3Npb25zQ29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRQZXJtaXNzaW9uc0NvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBwZXJtaXNzaW9uc0NvbnRyYWN0LmZ1bmN0aW9ucy5zZXRQZXJtaXNzaW9ucyhhY3Rpb25zLCBjb21wYW55QWRkcmVzcywgbmZ0QWRkcmVzcywgYWxsb3cpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBzZXRCb29sUGVybWlzc2lvbnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25zQm9vbEFycmF5LCBjb21wYW55QWRkcmVzczogc3RyaW5nLCBuZnRBZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgcGVybWlzc2lvbnNDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFBlcm1pc3Npb25zQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIHBlcm1pc3Npb25zQ29udHJhY3QuZnVuY3Rpb25zLnNldEJvb2xQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucywgY29tcGFueUFkZHJlc3MsIG5mdEFkZHJlc3MpO1xuICAgIH1cblxuICAgIC8qKiBIZWxwZXJzICovXG4gICAgcHVibGljIHN0YXRpYyBlbmNvZGVDYWxsKGZ1bmN0aW9uTmFtZTogc3RyaW5nLCBhcmdzPzogYW55W10pOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gZW5jb2RlKGFydGlmYWN0LCBmdW5jdGlvbk5hbWUsIGFyZ3MpXG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBkZWNvZGVDYWxsKGRhdGE6IHN0cmluZyk6IERlY29kZWRDYWxsIHwgbnVsbCB7XG4gICAgICAgIHJldHVybiBkZWNvZGUoYXJ0aWZhY3QsIGRhdGEpXG4gICAgfVxufSJdfQ==
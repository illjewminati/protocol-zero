"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.confirmLastMultisigTx = exports.helperTestMultisig = exports.helperDeployMultisig = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _ = require("../../../");

var helperDeployMultisig = /*#__PURE__*/function () {
  var _ref = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(signers) {
    var mSigOwner1, mSigOwner2, owners, multisigContract, multisigContractAddress;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return signers[0].getAddress();

          case 2:
            mSigOwner1 = _context.sent;
            _context.next = 5;
            return signers[1].getAddress();

          case 5:
            mSigOwner2 = _context.sent;
            owners = [mSigOwner1, mSigOwner2];
            _context.next = 9;
            return _.MultisigController.deployMultisigContract(signers[0], owners, 1);

          case 9:
            multisigContract = _context.sent;
            multisigContractAddress = multisigContract.address;
            return _context.abrupt("return", [multisigContract, multisigContractAddress]);

          case 12:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  return function helperDeployMultisig(_x) {
    return _ref.apply(this, arguments);
  };
}();

exports.helperDeployMultisig = helperDeployMultisig;

var helperTestMultisig = /*#__PURE__*/function () {
  var _ref2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(signers, multisigContractAddress) {
    var multisigController, owners, signer0, requirement, isOwner, encodedDataAO, tx, newRequirement, newOwner, encodedDataNR, tx2, newOwners, mSigOwner1, mSigOwner2, mSigOwner3, encodedDataReplaceO, tx4, encodedDataRO, tx3;
    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            expect(multisigContractAddress.length).toEqual(42);
            multisigController = new _.MultisigController(multisigContractAddress, signers[0]);
            _context2.next = 4;
            return multisigController.getOwners();

          case 4:
            owners = _context2.sent;
            _context2.next = 7;
            return signers[0].getAddress();

          case 7:
            signer0 = _context2.sent;
            expect(owners.length).toEqual(2);
            _context2.next = 11;
            return multisigController.getRequiredSignatures();

          case 11:
            requirement = _context2.sent;
            expect(requirement.toString()).toEqual("1");
            _context2.next = 15;
            return multisigController.isOwner(signer0);

          case 15:
            isOwner = _context2.sent;
            expect(isOwner).toEqual(true);
            encodedDataAO = _.MultisigController.encodeCall("changeRequirement", [2]);
            _context2.next = 20;
            return multisigController.submitTransaction(multisigContractAddress, 0, encodedDataAO, {
              gasLimit: 7500000
            });

          case 20:
            tx = _context2.sent;
            _context2.next = 23;
            return tx.wait();

          case 23:
            _context2.next = 25;
            return multisigController.getRequiredSignatures();

          case 25:
            newRequirement = _context2.sent;
            expect(newRequirement.toString()).toEqual("2");
            _context2.next = 29;
            return signers[3].getAddress();

          case 29:
            newOwner = _context2.sent;
            encodedDataNR = _.MultisigController.encodeCall("addOwner", [newOwner]);
            _context2.next = 33;
            return multisigController.submitTransaction(multisigContractAddress, 0, encodedDataNR, {
              gasLimit: 7500000
            });

          case 33:
            tx2 = _context2.sent;
            _context2.next = 36;
            return tx2.wait();

          case 36:
            _context2.next = 38;
            return confirmLastMultisigTx(multisigContractAddress, signers[1]);

          case 38:
            _context2.next = 40;
            return multisigController.getOwners();

          case 40:
            newOwners = _context2.sent;
            expect(newOwners.length).toEqual(3);
            _context2.next = 44;
            return signers[0].getAddress();

          case 44:
            mSigOwner1 = _context2.sent;
            _context2.next = 47;
            return signers[1].getAddress();

          case 47:
            mSigOwner2 = _context2.sent;
            _context2.next = 50;
            return signers[2].getAddress();

          case 50:
            mSigOwner3 = _context2.sent;
            encodedDataReplaceO = _.MultisigController.encodeCall("replaceOwner", [newOwner, mSigOwner3]);
            _context2.next = 54;
            return multisigController.submitTransaction(multisigContractAddress, 0, encodedDataReplaceO, {
              gasLimit: 7500000
            });

          case 54:
            tx4 = _context2.sent;
            _context2.next = 57;
            return tx4.wait();

          case 57:
            _context2.next = 59;
            return confirmLastMultisigTx(multisigContractAddress, signers[1]);

          case 59:
            _context2.next = 61;
            return multisigController.getOwners();

          case 61:
            newOwners = _context2.sent;
            expect(newOwners.length).toEqual(3);
            expect(newOwners).toEqual(expect.arrayContaining([mSigOwner1, mSigOwner2, mSigOwner3]));
            encodedDataRO = _.MultisigController.encodeCall("removeOwner", [mSigOwner3]);
            _context2.next = 67;
            return multisigController.submitTransaction(multisigContractAddress, 0, encodedDataRO, {
              gasLimit: 7500000
            });

          case 67:
            tx3 = _context2.sent;
            _context2.next = 70;
            return tx3.wait();

          case 70:
            _context2.next = 72;
            return confirmLastMultisigTx(multisigContractAddress, signers[1]);

          case 72:
            _context2.next = 74;
            return multisigController.getOwners();

          case 74:
            newOwners = _context2.sent;
            expect(newOwners.length).toEqual(2);
            expect(newOwners).toEqual(expect.arrayContaining([mSigOwner1, mSigOwner2]));

          case 77:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  return function helperTestMultisig(_x2, _x3) {
    return _ref2.apply(this, arguments);
  };
}();

exports.helperTestMultisig = helperTestMultisig;

var confirmLastMultisigTx = /*#__PURE__*/function () {
  var _ref3 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(multisigContractAddress, signer) {
    var multisigController, txCount, confirmTx;
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            multisigController = new _.MultisigController(multisigContractAddress, signer);
            _context3.next = 3;
            return multisigController.getTransactionCount(true, true);

          case 3:
            txCount = _context3.sent;
            console.log("txCount", txCount);
            _context3.next = 7;
            return multisigController.confirmTransaction(parseInt(txCount.toString()) - 1, {
              gasLimit: 7500000
            });

          case 7:
            confirmTx = _context3.sent;
            _context3.next = 10;
            return confirmTx.wait();

          case 10:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));

  return function confirmLastMultisigTx(_x4, _x5) {
    return _ref3.apply(this, arguments);
  };
}();

exports.confirmLastMultisigTx = confirmLastMultisigTx;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9ldGhlcmV1bS9fX3Rlc3RzX18vaGVscGVycy9tdWx0aXNpZy50cyJdLCJuYW1lcyI6WyJoZWxwZXJEZXBsb3lNdWx0aXNpZyIsInNpZ25lcnMiLCJnZXRBZGRyZXNzIiwibVNpZ093bmVyMSIsIm1TaWdPd25lcjIiLCJvd25lcnMiLCJNdWx0aXNpZ0NvbnRyb2xsZXIiLCJkZXBsb3lNdWx0aXNpZ0NvbnRyYWN0IiwibXVsdGlzaWdDb250cmFjdCIsIm11bHRpc2lnQ29udHJhY3RBZGRyZXNzIiwiYWRkcmVzcyIsImhlbHBlclRlc3RNdWx0aXNpZyIsImV4cGVjdCIsImxlbmd0aCIsInRvRXF1YWwiLCJtdWx0aXNpZ0NvbnRyb2xsZXIiLCJnZXRPd25lcnMiLCJzaWduZXIwIiwiZ2V0UmVxdWlyZWRTaWduYXR1cmVzIiwicmVxdWlyZW1lbnQiLCJ0b1N0cmluZyIsImlzT3duZXIiLCJlbmNvZGVkRGF0YUFPIiwiZW5jb2RlQ2FsbCIsInN1Ym1pdFRyYW5zYWN0aW9uIiwiZ2FzTGltaXQiLCJ0eCIsIndhaXQiLCJuZXdSZXF1aXJlbWVudCIsIm5ld093bmVyIiwiZW5jb2RlZERhdGFOUiIsInR4MiIsImNvbmZpcm1MYXN0TXVsdGlzaWdUeCIsIm5ld093bmVycyIsIm1TaWdPd25lcjMiLCJlbmNvZGVkRGF0YVJlcGxhY2VPIiwidHg0IiwiYXJyYXlDb250YWluaW5nIiwiZW5jb2RlZERhdGFSTyIsInR4MyIsInNpZ25lciIsImdldFRyYW5zYWN0aW9uQ291bnQiLCJ0eENvdW50IiwiY29uc29sZSIsImxvZyIsImNvbmZpcm1UcmFuc2FjdGlvbiIsInBhcnNlSW50IiwiY29uZmlybVR4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQ0E7O0FBR08sSUFBTUEsb0JBQW9CO0FBQUEsMkZBQUcsaUJBQU9DLE9BQVA7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFDUEEsT0FBTyxDQUFDLENBQUQsQ0FBUCxD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QUFpQyxDQUFqQztBQUNBRixZQUFBQSxNQUFNLENBQUNxQixTQUFELENBQU4sQ0FBa0JuQixPQUFsQixDQUEwQkYsTUFBTSxDQUFDeUIsZUFBUCxDQUF1QixDQUFDbEMsVUFBRCxFQUFhQyxVQUFiLENBQXZCLENBQTFCOztBQWpEOEI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsR0FBSDs7QUFBQSxrQkFBbEJPLGtCQUFrQjtBQUFBO0FBQUE7QUFBQSxHQUF4Qjs7OztBQXFEQSxJQUFNcUIscUJBQXFCO0FBQUEsNEZBQUcsa0JBQU92Qix1QkFBUCxFQUF3QytCLE1BQXhDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUMzQnpCLFlBQUFBLGtCQUQyQixHQUNOLElBQUlULG9CQUFKLENBQXVCRyx1QkFBdkIsRUFBZ0QrQixNQUFoRCxDQURNO0FBQUE7QUFBQSxtQkFHWHpCLGtCQUFrQixDQUFDMEIsbUJBQW5CLENBQXVDLElBQXZDLEVBQTZDLElBQTdDLENBSFc7O0FBQUE7QUFHM0JDLFlBQUFBLE9BSDJCO0FBSWpDQyxZQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxTQUFaLEVBQXVCRixPQUF2QjtBQUppQztBQUFBLG1CQU1UM0Isa0JBQWtCLENBQUM4QixrQkFBbkIsQ0FBc0NDLFFBQVEsQ0FBQ0osT0FBTyxDQUFDdEIsUUFBUixFQUFELENBQVIsR0FBK0IsQ0FBckUsRUFBd0U7QUFBRUssY0FBQUEsUUFBUSxFQUFFO0FBQVosYUFBeEUsQ0FOUzs7QUFBQTtBQU0zQnNCLFlBQUFBLFNBTjJCO0FBQUE7QUFBQSxtQkFPM0JBLFNBQVMsQ0FBQ3BCLElBQVYsRUFQMkI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsR0FBSDs7QUFBQSxrQkFBckJLLHFCQUFxQjtBQUFBO0FBQUE7QUFBQSxHQUEzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV0aGVycyB9IGZyb20gXCJldGhlcnNcIjtcbmltcG9ydCB7IE11bHRpc2lnQ29udHJvbGxlciB9IGZyb20gXCIuLi8uLi8uLi9cIjtcbmltcG9ydCB7IE11bHRpc2lnV2FsbGV0IH0gZnJvbSBcIi4uLy4uLy4uL3R5cGVzXCI7XG5cbmV4cG9ydCBjb25zdCBoZWxwZXJEZXBsb3lNdWx0aXNpZyA9IGFzeW5jIChzaWduZXJzOiBBcnJheTxldGhlcnMuU2lnbmVyPik6IFByb21pc2U8W011bHRpc2lnV2FsbGV0LCBzdHJpbmddPiA9PiB7XG4gICAgY29uc3QgbVNpZ093bmVyMSA9IGF3YWl0IHNpZ25lcnNbMF0uZ2V0QWRkcmVzcygpO1xuICAgIGNvbnN0IG1TaWdPd25lcjIgPSBhd2FpdCBzaWduZXJzWzFdLmdldEFkZHJlc3MoKTtcbiAgICBjb25zdCBvd25lcnMgPSBbbVNpZ093bmVyMSwgbVNpZ093bmVyMl07XG4gICAgY29uc3QgbXVsdGlzaWdDb250cmFjdDogTXVsdGlzaWdXYWxsZXQ9IGF3YWl0IE11bHRpc2lnQ29udHJvbGxlci5kZXBsb3lNdWx0aXNpZ0NvbnRyYWN0KHNpZ25lcnNbMF0sIG93bmVycywgMSk7XG4gICAgY29uc3QgbXVsdGlzaWdDb250cmFjdEFkZHJlc3MgPSBtdWx0aXNpZ0NvbnRyYWN0LmFkZHJlc3M7XG4gICAgcmV0dXJuIFttdWx0aXNpZ0NvbnRyYWN0LCBtdWx0aXNpZ0NvbnRyYWN0QWRkcmVzc107XG59XG5cbmV4cG9ydCBjb25zdCBoZWxwZXJUZXN0TXVsdGlzaWcgPSBhc3luYyAoc2lnbmVyczogQXJyYXk8ZXRoZXJzLlNpZ25lcj4sIG11bHRpc2lnQ29udHJhY3RBZGRyZXNzOiBzdHJpbmcpID0+IHtcbiAgICBleHBlY3QobXVsdGlzaWdDb250cmFjdEFkZHJlc3MubGVuZ3RoKS50b0VxdWFsKDQyKTtcbiAgICBjb25zdCBtdWx0aXNpZ0NvbnRyb2xsZXIgPSBuZXcgTXVsdGlzaWdDb250cm9sbGVyKG11bHRpc2lnQ29udHJhY3RBZGRyZXNzLCBzaWduZXJzWzBdKTtcblxuICAgIGNvbnN0IG93bmVycyA9IGF3YWl0IG11bHRpc2lnQ29udHJvbGxlci5nZXRPd25lcnMoKTtcbiAgICBjb25zdCBzaWduZXIwID0gYXdhaXQgc2lnbmVyc1swXS5nZXRBZGRyZXNzKClcbiAgICBleHBlY3Qob3duZXJzLmxlbmd0aCkudG9FcXVhbCgyKTtcblxuICAgIGNvbnN0IHJlcXVpcmVtZW50ID0gYXdhaXQgbXVsdGlzaWdDb250cm9sbGVyLmdldFJlcXVpcmVkU2lnbmF0dXJlcygpO1xuICAgIGV4cGVjdChyZXF1aXJlbWVudC50b1N0cmluZygpKS50b0VxdWFsKFwiMVwiKTtcblxuICAgIGNvbnN0IGlzT3duZXIgPSBhd2FpdCBtdWx0aXNpZ0NvbnRyb2xsZXIuaXNPd25lcihzaWduZXIwKTtcbiAgICBleHBlY3QoaXNPd25lcikudG9FcXVhbCh0cnVlKTtcblxuICAgIGNvbnN0IGVuY29kZWREYXRhQU8gPSBNdWx0aXNpZ0NvbnRyb2xsZXIuZW5jb2RlQ2FsbChcImNoYW5nZVJlcXVpcmVtZW50XCIsIFsyXSlcbiAgICBjb25zdCB0eCA9IGF3YWl0IG11bHRpc2lnQ29udHJvbGxlci5zdWJtaXRUcmFuc2FjdGlvbihtdWx0aXNpZ0NvbnRyYWN0QWRkcmVzcywgMCwgZW5jb2RlZERhdGFBTywgeyBnYXNMaW1pdDogNzUwMDAwMH0pXG4gICAgYXdhaXQgdHgud2FpdCgpXG4gICAgY29uc3QgbmV3UmVxdWlyZW1lbnQgPSBhd2FpdCBtdWx0aXNpZ0NvbnRyb2xsZXIuZ2V0UmVxdWlyZWRTaWduYXR1cmVzKCk7XG4gICAgZXhwZWN0KG5ld1JlcXVpcmVtZW50LnRvU3RyaW5nKCkpLnRvRXF1YWwoXCIyXCIpO1xuXG4gICAgY29uc3QgbmV3T3duZXIgPSBhd2FpdCBzaWduZXJzWzNdLmdldEFkZHJlc3MoKVxuICAgIGNvbnN0IGVuY29kZWREYXRhTlIgPSBNdWx0aXNpZ0NvbnRyb2xsZXIuZW5jb2RlQ2FsbChcImFkZE93bmVyXCIsIFtuZXdPd25lcl0pXG4gICAgY29uc3QgdHgyID0gYXdhaXQgbXVsdGlzaWdDb250cm9sbGVyLnN1Ym1pdFRyYW5zYWN0aW9uKG11bHRpc2lnQ29udHJhY3RBZGRyZXNzLCAwLCBlbmNvZGVkRGF0YU5SLCB7IGdhc0xpbWl0OiA3NTAwMDAwfSlcbiAgICBhd2FpdCB0eDIud2FpdCgpXG5cbiAgICBhd2FpdCBjb25maXJtTGFzdE11bHRpc2lnVHgobXVsdGlzaWdDb250cmFjdEFkZHJlc3MsIHNpZ25lcnNbMV0pO1xuICAgXG4gICAgbGV0IG5ld093bmVycyA9IGF3YWl0IG11bHRpc2lnQ29udHJvbGxlci5nZXRPd25lcnMoKTtcbiAgICBleHBlY3QobmV3T3duZXJzLmxlbmd0aCkudG9FcXVhbCgzKTtcblxuICAgIGNvbnN0IG1TaWdPd25lcjEgPSBhd2FpdCBzaWduZXJzWzBdLmdldEFkZHJlc3MoKTtcbiAgICBjb25zdCBtU2lnT3duZXIyID0gYXdhaXQgc2lnbmVyc1sxXS5nZXRBZGRyZXNzKCk7XG4gICAgY29uc3QgbVNpZ093bmVyMyA9IGF3YWl0IHNpZ25lcnNbMl0uZ2V0QWRkcmVzcygpO1xuICAgIFxuXG4gICAgY29uc3QgZW5jb2RlZERhdGFSZXBsYWNlTyA9IE11bHRpc2lnQ29udHJvbGxlci5lbmNvZGVDYWxsKFwicmVwbGFjZU93bmVyXCIsIFtuZXdPd25lciwgbVNpZ093bmVyM10pXG4gICAgY29uc3QgdHg0ID0gYXdhaXQgbXVsdGlzaWdDb250cm9sbGVyLnN1Ym1pdFRyYW5zYWN0aW9uKG11bHRpc2lnQ29udHJhY3RBZGRyZXNzLCAwLCBlbmNvZGVkRGF0YVJlcGxhY2VPLCB7IGdhc0xpbWl0OiA3NTAwMDAwfSlcbiAgICBhd2FpdCB0eDQud2FpdCgpO1xuICAgIGF3YWl0IGNvbmZpcm1MYXN0TXVsdGlzaWdUeChtdWx0aXNpZ0NvbnRyYWN0QWRkcmVzcywgc2lnbmVyc1sxXSk7XG4gICAgbmV3T3duZXJzID0gYXdhaXQgbXVsdGlzaWdDb250cm9sbGVyLmdldE93bmVycygpO1xuICAgIGV4cGVjdChuZXdPd25lcnMubGVuZ3RoKS50b0VxdWFsKDMpOyBcbiAgICBleHBlY3QobmV3T3duZXJzKS50b0VxdWFsKGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW21TaWdPd25lcjEsIG1TaWdPd25lcjIsIG1TaWdPd25lcjNdKSk7XG5cbiAgICBjb25zdCBlbmNvZGVkRGF0YVJPID0gTXVsdGlzaWdDb250cm9sbGVyLmVuY29kZUNhbGwoXCJyZW1vdmVPd25lclwiLCBbbVNpZ093bmVyM10pXG4gICAgY29uc3QgdHgzID0gYXdhaXQgbXVsdGlzaWdDb250cm9sbGVyLnN1Ym1pdFRyYW5zYWN0aW9uKG11bHRpc2lnQ29udHJhY3RBZGRyZXNzLCAwLCBlbmNvZGVkRGF0YVJPLCB7IGdhc0xpbWl0OiA3NTAwMDAwfSlcbiAgICBhd2FpdCB0eDMud2FpdCgpO1xuICAgIGF3YWl0IGNvbmZpcm1MYXN0TXVsdGlzaWdUeChtdWx0aXNpZ0NvbnRyYWN0QWRkcmVzcywgc2lnbmVyc1sxXSk7XG4gICAgbmV3T3duZXJzID0gYXdhaXQgbXVsdGlzaWdDb250cm9sbGVyLmdldE93bmVycygpO1xuICAgIGV4cGVjdChuZXdPd25lcnMubGVuZ3RoKS50b0VxdWFsKDIpOyBcbiAgICBleHBlY3QobmV3T3duZXJzKS50b0VxdWFsKGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW21TaWdPd25lcjEsIG1TaWdPd25lcjJdKSk7XG5cbn1cblxuZXhwb3J0IGNvbnN0IGNvbmZpcm1MYXN0TXVsdGlzaWdUeCA9IGFzeW5jIChtdWx0aXNpZ0NvbnRyYWN0QWRkcmVzczogc3RyaW5nLCBzaWduZXI6IGV0aGVycy5TaWduZXIpID0+IHtcbiAgICBjb25zdCBtdWx0aXNpZ0NvbnRyb2xsZXIgPSBuZXcgTXVsdGlzaWdDb250cm9sbGVyKG11bHRpc2lnQ29udHJhY3RBZGRyZXNzLCBzaWduZXIpO1xuXG4gICAgY29uc3QgdHhDb3VudCA9IGF3YWl0IG11bHRpc2lnQ29udHJvbGxlci5nZXRUcmFuc2FjdGlvbkNvdW50KHRydWUsIHRydWUpO1xuICAgIGNvbnNvbGUubG9nKFwidHhDb3VudFwiLCB0eENvdW50KTtcblxuICAgIGNvbnN0IGNvbmZpcm1UeCA9IGF3YWl0IG11bHRpc2lnQ29udHJvbGxlci5jb25maXJtVHJhbnNhY3Rpb24ocGFyc2VJbnQodHhDb3VudC50b1N0cmluZygpKSAtIDEsIHsgZ2FzTGltaXQ6IDc1MDAwMDB9KTtcbiAgICBhd2FpdCBjb25maXJtVHgud2FpdCgpXG59Il19
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FeeCollectorDeployerController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var artifact = _interopRequireWildcard(require("../../ethereum/abi/MultisigWallet.json"));

var _encodeCall = require("../../ethereum/encodeCall");

var _deploy = require("../../ethereum/deploy/deploy");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var FeeCollectorDeployerController = /*#__PURE__*/function () {
  function FeeCollectorDeployerController(feeCollectorAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, FeeCollectorDeployerController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_feeCollectorDeployerAddress", void 0);
    (0, _defineProperty2["default"])(this, "_feeCollectorDeployerContract", void 0);
    this._feeCollectorDeployerAddress = feeCollectorAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(FeeCollectorDeployerController, [{
    key: "_getcontract",
    value: function () {
      var _getcontract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._feeCollectorDeployerContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._feeCollectorDeployerContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getFeeCollectorDeployerContract)(this._feeCollectorDeployerAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._feeCollectorDeployerContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Fee Collector Deployer contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getcontract() {
        return _getcontract2.apply(this, arguments);
      }

      return _getcontract;
    }()
  }, {
    key: "getContract",
    value:
    /**Getters */
    function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getcontract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getFeeCollectorBytecode",
    value: function () {
      var _getFeeCollectorBytecode = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
        var erc721Contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getcontract();

              case 2:
                erc721Contract = _context3.sent;
                return _context3.abrupt("return", erc721Contract.getFeeCollectorBytecode());

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getFeeCollectorBytecode() {
        return _getFeeCollectorBytecode.apply(this, arguments);
      }

      return getFeeCollectorBytecode;
    }()
  }, {
    key: "getProxyBytecode",
    value: function () {
      var _getProxyBytecode = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4() {
        var erc721Contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getcontract();

              case 2:
                erc721Contract = _context4.sent;
                return _context4.abrupt("return", erc721Contract.getProxyBytecode());

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function getProxyBytecode() {
        return _getProxyBytecode.apply(this, arguments);
      }

      return getProxyBytecode;
    }()
    /** @param bytecode  can be retrieved by calling get___Bytecode()*/

    /** @param _salt is a random number used to create an address */

  }, {
    key: "getAddress",
    value: function () {
      var _getAddress = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(bytecode, salt) {
        var erc721Contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getcontract();

              case 2:
                erc721Contract = _context5.sent;
                return _context5.abrupt("return", erc721Contract.getAddress(bytecode, salt));

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function getAddress(_x, _x2) {
        return _getAddress.apply(this, arguments);
      }

      return getAddress;
    }()
  }, {
    key: "getSalt",
    value: function () {
      var _getSalt = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(contractAddress) {
        var erc721Contract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getcontract();

              case 2:
                erc721Contract = _context6.sent;
                return _context6.abrupt("return", erc721Contract.getContractSalt(contractAddress));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function getSalt(_x3) {
        return _getSalt.apply(this, arguments);
      }

      return getSalt;
    }()
    /**Setters */

  }, {
    key: "deployPrecomputed",
    value: function () {
      var _deployPrecomputed = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(bytecode, salt) {
        var contract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getcontract();

              case 2:
                contract = _context7.sent;
                return _context7.abrupt("return", contract.functions.deployPrecomputed(bytecode, salt));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function deployPrecomputed(_x4, _x5) {
        return _deployPrecomputed.apply(this, arguments);
      }

      return deployPrecomputed;
    }()
  }, {
    key: "setProxyOwner",
    value: function () {
      var _setProxyOwner = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(newOwner, proxy) {
        var contract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getcontract();

              case 2:
                contract = _context8.sent;
                return _context8.abrupt("return", contract.functions.setProxyOwner(newOwner, proxy));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function setProxyOwner(_x6, _x7) {
        return _setProxyOwner.apply(this, arguments);
      }

      return setProxyOwner;
    }()
    /** Helpers */

  }], [{
    key: "deployFeeCollectorDeployer",
    value: function () {
      var _deployFeeCollectorDeployer2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(signer) {
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                return _context9.abrupt("return", (0, _deploy.deployFeeCollectorDeployer)(signer));

              case 1:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9);
      }));

      function deployFeeCollectorDeployer(_x8) {
        return _deployFeeCollectorDeployer2.apply(this, arguments);
      }

      return deployFeeCollectorDeployer;
    }()
  }, {
    key: "encodeCall",
    value: function encodeCall(functionName, args) {
      return (0, _encodeCall.encode)(artifact, functionName, args);
    }
  }, {
    key: "decodeCall",
    value: function decodeCall(data) {
      return (0, _encodeCall.decode)(artifact, data);
    }
  }, {
    key: "getBytecode",
    value: function getBytecode() {
      return artifact.bytecode;
    }
  }]);
  return FeeCollectorDeployerController;
}();

exports.FeeCollectorDeployerController = FeeCollectorDeployerController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9tdWx0aXNpZy9mZWVDb2xsZWN0b3JEZXBsb3llckNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiRmVlQ29sbGVjdG9yRGVwbG95ZXJDb250cm9sbGVyIiwiZmVlQ29sbGVjdG9yQWRkcmVzcyIsInNpZ25lck9yUHJvdmlkZXIiLCJfZmVlQ29sbGVjdG9yRGVwbG95ZXJBZGRyZXNzIiwiU2lnbmVyIiwiZXRoZXJzIiwicHJvdmlkZXJzIiwiSnNvblJwY1NpZ25lciIsIl9zaWduZXIiLCJ3ZWIzV3JhcHBlciIsIldlYjNQcm92aWRlciIsImdldFNpZ25lciIsIl9mZWVDb2xsZWN0b3JEZXBsb3llckNvbnRyYWN0IiwiY29udHJhY3QiLCJFcnJvciIsIl9nZXRjb250cmFjdCIsImVyYzcyMUNvbnRyYWN0IiwiZ2V0RmVlQ29sbGVjdG9yQnl0ZWNvZGUiLCJnZXRQcm94eUJ5dGVjb2RlIiwiYnl0ZWNvZGUiLCJzYWx0IiwiZ2V0QWRkcmVzcyIsImNvbnRyYWN0QWRkcmVzcyIsImdldENvbnRyYWN0U2FsdCIsImZ1bmN0aW9ucyIsImRlcGxveVByZWNvbXB1dGVkIiwibmV3T3duZXIiLCJwcm94eSIsInNldFByb3h5T3duZXIiLCJzaWduZXIiLCJmdW5jdGlvbk5hbWUiLCJhcmdzIiwiYXJ0aWZhY3QiLCJkYXRhIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFFQTs7Ozs7O0lBSWFBLDhCO0FBS1QsMENBQVlDLG1CQUFaLEVBQXlDQyxnQkFBekMsRUFBNkU7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUN6RSxTQUFLQyw0QkFBTCxHQUFvQ0YsbUJBQXBDOztBQUVBLFFBQUdDLGdCQUFnQixZQUFZRSxjQUE1QixJQUFzQ0YsZ0JBQWdCLFlBQVlHLGVBQU9DLFNBQVAsQ0FBaUJDLGFBQXRGLEVBQXFHO0FBQ2pHLFdBQUtDLE9BQUwsR0FBZU4sZ0JBQWY7QUFDSCxL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akMsRUFBMkNDLEtBQTNDLENBTFg7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsTzs7Ozs7Ozs7QUFTQTs7Ozs7dUhBckRBLGtCQUNJRSxNQURKO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxrREFHVyx3Q0FBMkJBLE1BQTNCLENBSFg7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsTzs7Ozs7Ozs7OztXQXNEQSxvQkFBeUJDLFlBQXpCLEVBQStDQyxJQUEvQyxFQUFxRTtBQUNqRSxhQUFPLHdCQUFPQyxRQUFQLEVBQWlCRixZQUFqQixFQUErQkMsSUFBL0IsQ0FBUDtBQUNIOzs7V0FFRCxvQkFBeUJFLElBQXpCLEVBQTJEO0FBQ3ZELGFBQU8sd0JBQU9ELFFBQVAsRUFBaUJDLElBQWpCLENBQVA7QUFDSDs7O1dBRUQsdUJBQW9DO0FBQ2hDLGFBQU9ELFFBQVEsQ0FBQ2IsUUFBaEI7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJpZ051bWJlcmlzaCwgQnl0ZXNMaWtlLCBDb250cmFjdFRyYW5zYWN0aW9uLCBldGhlcnMsIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcbmltcG9ydCB7IGdldEZlZUNvbGxlY3RvckRlcGxveWVyQ29udHJhY3QgfSBmcm9tIFwiLi4vLi4vY2hhaW4vcHJlZmFiQ29udHJhY3RGYWN0b3J5XCI7XG5pbXBvcnQgeyBGZWVDb2xsZWN0b3JEZXBsb3llciB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuXG5pbXBvcnQgKiBhcyBhcnRpZmFjdCBmcm9tIFwiLi4vLi4vZXRoZXJldW0vYWJpL011bHRpc2lnV2FsbGV0Lmpzb25cIlxuaW1wb3J0IHsgZGVjb2RlLCBlbmNvZGUgfSBmcm9tIFwiLi4vLi4vZXRoZXJldW0vZW5jb2RlQ2FsbFwiO1xuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5pbXBvcnQgeyBkZXBsb3lGZWVDb2xsZWN0b3JEZXBsb3llciB9IGZyb20gXCIuLi8uLi9ldGhlcmV1bS9kZXBsb3kvZGVwbG95XCI7XG5pbXBvcnQgeyBEZWNvZGVkQ2FsbCB9IGZyb20gXCIuLi9oZWxwZXJzL2FiaURlY29kZXJDb250cm9sbGVyXCI7XG5cblxuZXhwb3J0IGNsYXNzIEZlZUNvbGxlY3RvckRlcGxveWVyQ29udHJvbGxlciB7XG4gICAgcHJpdmF0ZSBfc2lnbmVyOiBTaWduZXI7XG4gICAgcHJpdmF0ZSBfZmVlQ29sbGVjdG9yRGVwbG95ZXJBZGRyZXNzIDogc3RyaW5nXG4gICAgcHJpdmF0ZSBfZmVlQ29sbGVjdG9yRGVwbG95ZXJDb250cmFjdD8gOiBGZWVDb2xsZWN0b3JEZXBsb3llclxuXG4gICAgY29uc3RydWN0b3IoZmVlQ29sbGVjdG9yQWRkcmVzczogc3RyaW5nLCBzaWduZXJPclByb3ZpZGVyOiBQcm92aWRlck9yU2lnbmVyKSB7XG4gICAgICAgIHRoaXMuX2ZlZUNvbGxlY3RvckRlcGxveWVyQWRkcmVzcyA9IGZlZUNvbGxlY3RvckFkZHJlc3M7XG4gICAgICAgIFxuICAgICAgICBpZihzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgU2lnbmVyIHx8IHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBldGhlcnMucHJvdmlkZXJzLkpzb25ScGNTaWduZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHNpZ25lck9yUHJvdmlkZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB3ZWIzV3JhcHBlciA9IG5ldyBldGhlcnMucHJvdmlkZXJzLldlYjNQcm92aWRlcihzaWduZXJPclByb3ZpZGVyIGFzIGFueSkgXG4gICAgICAgICAgICB0aGlzLl9zaWduZXIgPSB3ZWIzV3JhcHBlci5nZXRTaWduZXIoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZ2V0Y29udHJhY3QoKTogUHJvbWlzZTxGZWVDb2xsZWN0b3JEZXBsb3llcj4ge1xuICAgICAgICBpZih0aGlzLl9mZWVDb2xsZWN0b3JEZXBsb3llckNvbnRyYWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZmVlQ29sbGVjdG9yRGVwbG95ZXJDb250cmFjdFxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgdG8gdGhlIGNvbnRyYWN0IHdpdGggbXkgc2lnbmVyXG4gICAgICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldEZlZUNvbGxlY3RvckRlcGxveWVyQ29udHJhY3QodGhpcy5fZmVlQ29sbGVjdG9yRGVwbG95ZXJBZGRyZXNzLCB0aGlzLl9zaWduZXIpXG4gICAgICAgICAgICB0aGlzLl9mZWVDb2xsZWN0b3JEZXBsb3llckNvbnRyYWN0ID0gY29udHJhY3Q7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhY3RcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYEZhaWxlZCB0byBnZXQgRmVlIENvbGxlY3RvciBEZXBsb3llciBjb250cmFjdDogJHtlfWApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGRlcGxveUZlZUNvbGxlY3RvckRlcGxveWVyKFxuICAgICAgICBzaWduZXI6IFNpZ25lclxuICAgICk6IFByb21pc2U8RmVlQ29sbGVjdG9yRGVwbG95ZXI+IHtcbiAgICAgICAgcmV0dXJuIGRlcGxveUZlZUNvbGxlY3RvckRlcGxveWVyKHNpZ25lcik7XG4gICAgfVxuXG4gICAgLyoqR2V0dGVycyAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRDb250cmFjdCgpOiBQcm9taXNlPEZlZUNvbGxlY3RvckRlcGxveWVyPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldEZlZUNvbGxlY3RvckJ5dGVjb2RlKCk6IFByb21pc2U8Qnl0ZXNMaWtlPiB7XG4gICAgICAgIGNvbnN0IGVyYzcyMUNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGVyYzcyMUNvbnRyYWN0LmdldEZlZUNvbGxlY3RvckJ5dGVjb2RlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldFByb3h5Qnl0ZWNvZGUoKTogUHJvbWlzZTxCeXRlc0xpa2U+IHtcbiAgICAgICAgY29uc3QgZXJjNzIxQ29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRjb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gZXJjNzIxQ29udHJhY3QuZ2V0UHJveHlCeXRlY29kZSgpO1xuICAgIH1cblxuICAgIC8qKiBAcGFyYW0gYnl0ZWNvZGUgIGNhbiBiZSByZXRyaWV2ZWQgYnkgY2FsbGluZyBnZXRfX19CeXRlY29kZSgpKi9cbiAgICAvKiogQHBhcmFtIF9zYWx0IGlzIGEgcmFuZG9tIG51bWJlciB1c2VkIHRvIGNyZWF0ZSBhbiBhZGRyZXNzICovXG4gICAgcHVibGljIGFzeW5jIGdldEFkZHJlc3MoYnl0ZWNvZGU6IEJ5dGVzTGlrZSwgc2FsdDogQmlnTnVtYmVyaXNoKTogUHJvbWlzZTxCeXRlc0xpa2U+IHtcbiAgICAgICAgY29uc3QgZXJjNzIxQ29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRjb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gZXJjNzIxQ29udHJhY3QuZ2V0QWRkcmVzcyhieXRlY29kZSwgc2FsdCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldFNhbHQoY29udHJhY3RBZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPEJpZ051bWJlcmlzaD4ge1xuICAgICAgICBjb25zdCBlcmM3MjFDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldGNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBlcmM3MjFDb250cmFjdC5nZXRDb250cmFjdFNhbHQoY29udHJhY3RBZGRyZXNzKTtcbiAgICB9XG4gICAgXG5cbiAgICAgLyoqU2V0dGVycyAqLyAgXG4gICAgcHVibGljIGFzeW5jIGRlcGxveVByZWNvbXB1dGVkKFxuICAgICAgICBieXRlY29kZTogQnl0ZXNMaWtlLCBcbiAgICAgICAgc2FsdDogQmlnTnVtYmVyaXNoXG4gICAgKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5kZXBsb3lQcmVjb21wdXRlZChieXRlY29kZSwgc2FsdCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHNldFByb3h5T3duZXIoXG4gICAgICAgIG5ld093bmVyOiBzdHJpbmcsIFxuICAgICAgICBwcm94eTogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5zZXRQcm94eU93bmVyKG5ld093bmVyLCBwcm94eSk7XG4gICAgfVxuXG4gICBcbiAgICAvKiogSGVscGVycyAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZW5jb2RlQ2FsbChmdW5jdGlvbk5hbWU6IHN0cmluZywgYXJncz86IGFueVtdKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGVuY29kZShhcnRpZmFjdCwgZnVuY3Rpb25OYW1lLCBhcmdzKVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZGVjb2RlQ2FsbChkYXRhOiBzdHJpbmcpOiBEZWNvZGVkQ2FsbCB8IG51bGwge1xuICAgICAgICByZXR1cm4gZGVjb2RlKGFydGlmYWN0LCBkYXRhKVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0Qnl0ZWNvZGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGFydGlmYWN0LmJ5dGVjb2RlO1xuICAgIH1cblxufSJdfQ==
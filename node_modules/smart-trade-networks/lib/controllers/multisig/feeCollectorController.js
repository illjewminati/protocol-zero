"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FeeCollectorController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var artifact = _interopRequireWildcard(require("../../ethereum/abi/FeeCollector.json"));

var _encodeCall = require("../../ethereum/encodeCall");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var FeeCollectorController = /*#__PURE__*/function () {
  function FeeCollectorController(feeCollectorAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, FeeCollectorController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_feeCollectorAddress", void 0);
    (0, _defineProperty2["default"])(this, "_feeCollectorContract", void 0);
    this._feeCollectorAddress = feeCollectorAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(FeeCollectorController, [{
    key: "_getcontract",
    value: function () {
      var _getcontract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._feeCollectorContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._feeCollectorContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getFeeCollectorContract)(this._feeCollectorAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._feeCollectorContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Fee Collector contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getcontract() {
        return _getcontract2.apply(this, arguments);
      }

      return _getcontract;
    }()
    /**Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getcontract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getFeeByMultisig",
    value: function () {
      var _getFeeByMultisig = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(address) {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getcontract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.getFeeByMultisig(address));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getFeeByMultisig(_x) {
        return _getFeeByMultisig.apply(this, arguments);
      }

      return getFeeByMultisig;
    }()
  }, {
    key: "getFee",
    value: function () {
      var _getFee = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4() {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getcontract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.getFee());

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function getFee() {
        return _getFee.apply(this, arguments);
      }

      return getFee;
    }()
  }, {
    key: "getFeeCollector",
    value: function () {
      var _getFeeCollector = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5() {
        var contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getcontract();

              case 2:
                contract = _context5.sent;
                return _context5.abrupt("return", contract.getFeeCollector());

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function getFeeCollector() {
        return _getFeeCollector.apply(this, arguments);
      }

      return getFeeCollector;
    }()
  }, {
    key: "isWhitelisted",
    value: function () {
      var _isWhitelisted = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(address) {
        var contract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getcontract();

              case 2:
                contract = _context6.sent;
                return _context6.abrupt("return", contract.isWhitelisted(address));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function isWhitelisted(_x2) {
        return _isWhitelisted.apply(this, arguments);
      }

      return isWhitelisted;
    }()
    /**Setters */

  }, {
    key: "setFeeCollector",
    value: function () {
      var _setFeeCollector = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(address) {
        var contract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getcontract();

              case 2:
                contract = _context7.sent;
                return _context7.abrupt("return", contract.functions.setFeeCollector(address));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function setFeeCollector(_x3) {
        return _setFeeCollector.apply(this, arguments);
      }

      return setFeeCollector;
    }()
  }, {
    key: "setFee",
    value: function () {
      var _setFee = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(newFee) {
        var contract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getcontract();

              case 2:
                contract = _context8.sent;
                return _context8.abrupt("return", contract.functions.setFee(newFee));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function setFee(_x4) {
        return _setFee.apply(this, arguments);
      }

      return setFee;
    }()
  }, {
    key: "setFeeByMultisig",
    value: function () {
      var _setFeeByMultisig = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(address, newFee) {
        var contract;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._getcontract();

              case 2:
                contract = _context9.sent;
                return _context9.abrupt("return", contract.functions.setFeeByMultisig(address, newFee));

              case 4:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setFeeByMultisig(_x5, _x6) {
        return _setFeeByMultisig.apply(this, arguments);
      }

      return setFeeByMultisig;
    }()
  }, {
    key: "whitelistMultisig",
    value: function () {
      var _whitelistMultisig = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee10(address, allow) {
        var contract;
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                _context10.next = 2;
                return this._getcontract();

              case 2:
                contract = _context10.sent;
                return _context10.abrupt("return", contract.functions.whitelistMultisig(address, allow));

              case 4:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function whitelistMultisig(_x7, _x8) {
        return _whitelistMultisig.apply(this, arguments);
      }

      return whitelistMultisig;
    }()
  }, {
    key: "withdraw",
    value: function () {
      var _withdraw = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee11(tokenAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.next = 2;
                return this._getcontract();

              case 2:
                contract = _context11.sent;
                return _context11.abrupt("return", contract.functions.withdraw(tokenAddress));

              case 4:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function withdraw(_x9) {
        return _withdraw.apply(this, arguments);
      }

      return withdraw;
    }()
    /** Helpers */

  }], [{
    key: "encodeCall",
    value: function encodeCall(functionName, args) {
      return (0, _encodeCall.encode)(artifact, functionName, args);
    }
  }, {
    key: "decodeCall",
    value: function decodeCall(data) {
      return (0, _encodeCall.decode)(artifact, data);
    }
  }]);
  return FeeCollectorController;
}();

exports.FeeCollectorController = FeeCollectorController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9tdWx0aXNpZy9mZWVDb2xsZWN0b3JDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIkZlZUNvbGxlY3RvckNvbnRyb2xsZXIiLCJmZWVDb2xsZWN0b3JBZGRyZXNzIiwic2lnbmVyT3JQcm92aWRlciIsIl9mZWVDb2xsZWN0b3JBZGRyZXNzIiwiU2lnbmVyIiwiZXRoZXJzIiwicHJvdmlkZXJzIiwiSnNvblJwY1NpZ25lciIsIl9zaWduZXIiLCJ3ZWIzV3JhcHBlciIsIldlYjNQcm92aWRlciIsImdldFNpZ25lciIsIl9mZWVDb2xsZWN0b3JDb250cmFjdCIsImNvbnRyYWN0IiwiRXJyb3IiLCJfZ2V0Y29udHJhY3QiLCJhZGRyZXNzIiwiZ2V0RmVlQnlNdWx0aXNpZyIsImdldEZlZSIsImdldEZlZUNvbGxlY3RvciIsImlzV2hpdGVsaXN0ZWQiLCJmdW5jdGlvbnMiLCJzZXRGZWVDb2xsZWN0b3IiLCJuZXdGZWUiLCJzZXRGZWUiLCJzZXRGZWVCeU11bHRpc2lnIiwiYWxsb3ciLCJ3aGl0ZWxpc3RNdWx0aXNpZyIsInRva2VuQWRkcmVzcyIsIndpdGhkcmF3IiwiZnVuY3Rpb25OYW1lIiwiYXJncyIsImFydGlmYWN0IiwiZGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBR0E7O0FBQ0E7Ozs7OztJQUthQSxzQjtBQUtULGtDQUFZQyxtQkFBWixFQUF5Q0MsZ0JBQXpDLEVBQTZFO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDekUsU0FBS0Msb0JBQUwsR0FBNEJGLG1CQUE1Qjs7QUFFQSxRQUFHQyxnQkFBZ0IsWUFBWUUsY0FBNUIsSUFBc0NGLGdCQUFnQixZQUFZRyxlQUFPQyxTQUFQLENBQWlCQyxhQUF0RixFQUFxRztBQUNqRyxXQUFLQyxPQUFMLEdBQWVOLGdCQUFmO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsVUFBTU8sV0FBVyxHQUFHLElBQUlKLGVBQU9DLFNBQVAsQ0FB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QUEsdUJBQzJCLEtBQUtSLFlBQUwsRUFEM0I7O0FBQUE7QUFDVUYsZ0JBQUFBLFFBRFY7QUFBQSxrREFFV0EsUUFBUSxDQUFDUSxTQUFULENBQW1CSSxnQkFBbkIsQ0FBb0NULE9BQXBDLEVBQTZDTyxNQUE3QyxDQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7Ozs7OzZHQUtBLG1CQUErQlAsT0FBL0IsRUFBZ0RVLEtBQWhEO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQzJCLEtBQUtYLFlBQUwsRUFEM0I7O0FBQUE7QUFDVUYsZ0JBQUFBLFFBRFY7QUFBQSxtREFFV0EsUUFBUSxDQUFDUSxTQUFULENBQW1CTSxpQkFBbkIsQ0FBcUNYLE9BQXJDLEVBQThDVSxLQUE5QyxDQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7Ozs7O29HQUtBLG1CQUFzQkUsWUFBdEI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFDMkIsS0FBS2IsWUFBTCxFQUQzQjs7QUFBQTtBQUNVRixnQkFBQUEsUUFEVjtBQUFBLG1EQUVXQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJRLFFBQW5CLENBQTRCRCxZQUE1QixDQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7O0FBTUE7Ozs7V0FDQSxvQkFBeUJFLFlBQXpCLEVBQStDQyxJQUEvQyxFQUFxRTtBQUNqRSxhQUFPLHdCQUFPQyxRQUFQLEVBQWlCRixZQUFqQixFQUErQkMsSUFBL0IsQ0FBUDtBQUNIOzs7V0FFRCxvQkFBeUJFLElBQXpCLEVBQTJEO0FBQ3ZELGFBQU8sd0JBQU9ELFFBQVAsRUFBaUJDLElBQWpCLENBQVA7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJpZ051bWJlcmlzaCwgQ29udHJhY3RUcmFuc2FjdGlvbiwgZXRoZXJzLCBTaWduZXIgfSBmcm9tIFwiZXRoZXJzXCI7XG5pbXBvcnQgeyBnZXRGZWVDb2xsZWN0b3JDb250cmFjdCB9IGZyb20gXCIuLi8uLi9jaGFpbi9wcmVmYWJDb250cmFjdEZhY3RvcnlcIjtcbmltcG9ydCB7IEZlZUNvbGxlY3RvciB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuXG5pbXBvcnQgKiBhcyBhcnRpZmFjdCBmcm9tIFwiLi4vLi4vZXRoZXJldW0vYWJpL0ZlZUNvbGxlY3Rvci5qc29uXCJcbmltcG9ydCB7IGRlY29kZSwgZW5jb2RlIH0gZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2VuY29kZUNhbGxcIjtcbmltcG9ydCB7IFByb3ZpZGVyT3JTaWduZXIgfSBmcm9tIFwiLi4vLi4vbG9jYWxUeXBlc1wiO1xuaW1wb3J0IHsgRGVjb2RlZENhbGwgfSBmcm9tIFwiLi4vaGVscGVycy9hYmlEZWNvZGVyQ29udHJvbGxlclwiO1xuXG5cbmV4cG9ydCBjbGFzcyBGZWVDb2xsZWN0b3JDb250cm9sbGVyIHtcbiAgICBwcml2YXRlIF9zaWduZXI6IFNpZ25lcjtcbiAgICBwcml2YXRlIF9mZWVDb2xsZWN0b3JBZGRyZXNzIDogc3RyaW5nXG4gICAgcHJpdmF0ZSBfZmVlQ29sbGVjdG9yQ29udHJhY3Q/IDogRmVlQ29sbGVjdG9yXG5cbiAgICBjb25zdHJ1Y3RvcihmZWVDb2xsZWN0b3JBZGRyZXNzOiBzdHJpbmcsIHNpZ25lck9yUHJvdmlkZXI6IFByb3ZpZGVyT3JTaWduZXIpIHtcbiAgICAgICAgdGhpcy5fZmVlQ29sbGVjdG9yQWRkcmVzcyA9IGZlZUNvbGxlY3RvckFkZHJlc3M7XG4gICAgICAgIFxuICAgICAgICBpZihzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgU2lnbmVyIHx8IHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBldGhlcnMucHJvdmlkZXJzLkpzb25ScGNTaWduZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHNpZ25lck9yUHJvdmlkZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB3ZWIzV3JhcHBlciA9IG5ldyBldGhlcnMucHJvdmlkZXJzLldlYjNQcm92aWRlcihzaWduZXJPclByb3ZpZGVyIGFzIGFueSkgXG4gICAgICAgICAgICB0aGlzLl9zaWduZXIgPSB3ZWIzV3JhcHBlci5nZXRTaWduZXIoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZ2V0Y29udHJhY3QoKTogUHJvbWlzZTxGZWVDb2xsZWN0b3I+IHtcbiAgICAgICAgaWYodGhpcy5fZmVlQ29sbGVjdG9yQ29udHJhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mZWVDb2xsZWN0b3JDb250cmFjdFxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgdG8gdGhlIGNvbnRyYWN0IHdpdGggbXkgc2lnbmVyXG4gICAgICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldEZlZUNvbGxlY3RvckNvbnRyYWN0KHRoaXMuX2ZlZUNvbGxlY3RvckFkZHJlc3MsIHRoaXMuX3NpZ25lcilcbiAgICAgICAgICAgIHRoaXMuX2ZlZUNvbGxlY3RvckNvbnRyYWN0ID0gY29udHJhY3Q7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhY3RcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYEZhaWxlZCB0byBnZXQgRmVlIENvbGxlY3RvciBjb250cmFjdDogJHtlfWApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipHZXR0ZXJzICovXG4gICAgcHVibGljIGFzeW5jIGdldENvbnRyYWN0KCk6IFByb21pc2U8RmVlQ29sbGVjdG9yPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldEZlZUJ5TXVsdGlzaWcoYWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxCaWdOdW1iZXJpc2g+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRjb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZ2V0RmVlQnlNdWx0aXNpZyhhZGRyZXNzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0RmVlKCk6IFByb21pc2U8QmlnTnVtYmVyaXNoPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmdldEZlZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRGZWVDb2xsZWN0b3IoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRjb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZ2V0RmVlQ29sbGVjdG9yKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGlzV2hpdGVsaXN0ZWQoYWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmlzV2hpdGVsaXN0ZWQoYWRkcmVzcyk7XG4gICAgfVxuICAgIFxuXG4gICAgIC8qKlNldHRlcnMgKi8gIFxuICAgIHB1YmxpYyBhc3luYyBzZXRGZWVDb2xsZWN0b3IoYWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5zZXRGZWVDb2xsZWN0b3IoYWRkcmVzcyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHNldEZlZShuZXdGZWU6IEJpZ051bWJlcmlzaCk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldGNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMuc2V0RmVlKG5ld0ZlZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHNldEZlZUJ5TXVsdGlzaWcoYWRkcmVzczogc3RyaW5nLCBuZXdGZWU6IEJpZ051bWJlcmlzaCk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldGNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMuc2V0RmVlQnlNdWx0aXNpZyhhZGRyZXNzLCBuZXdGZWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyB3aGl0ZWxpc3RNdWx0aXNpZyhhZGRyZXNzOiBzdHJpbmcsIGFsbG93OiBib29sZWFuKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy53aGl0ZWxpc3RNdWx0aXNpZyhhZGRyZXNzLCBhbGxvdyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHdpdGhkcmF3KHRva2VuQWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Y29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy53aXRoZHJhdyh0b2tlbkFkZHJlc3MpO1xuICAgIH1cblxuICAgXG4gICAgLyoqIEhlbHBlcnMgKi9cbiAgICBwdWJsaWMgc3RhdGljIGVuY29kZUNhbGwoZnVuY3Rpb25OYW1lOiBzdHJpbmcsIGFyZ3M/OiBhbnlbXSk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBlbmNvZGUoYXJ0aWZhY3QsIGZ1bmN0aW9uTmFtZSwgYXJncylcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRlY29kZUNhbGwoZGF0YTogc3RyaW5nKTogRGVjb2RlZENhbGwgfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIGRlY29kZShhcnRpZmFjdCwgZGF0YSlcbiAgICB9XG5cbn0iXX0=
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ManagerController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var _deploy = require("../../ethereum/deploy/deploy");

var ManagerController = /*#__PURE__*/function () {
  function ManagerController(managerAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, ManagerController);
    (0, _defineProperty2["default"])(this, "_managerAddress", void 0);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_managerContract", void 0);
    this._managerAddress = managerAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(ManagerController, [{
    key: "_getManagerContract",
    value: function () {
      var _getManagerContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._managerContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._managerContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getManagerContract)(this._managerAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._managerContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get STN721Manager contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getManagerContract() {
        return _getManagerContract2.apply(this, arguments);
      }

      return _getManagerContract;
    }()
  }, {
    key: "getContract",
    value:
    /**Getters */
    function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getChild",
    value: function () {
      var _getChild = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(stn721Parent, tokenId) {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.getChild(stn721Parent, tokenId));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getChild(_x, _x2) {
        return _getChild.apply(this, arguments);
      }

      return getChild;
    }()
  }, {
    key: "getAll",
    value: function () {
      var _getAll = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4() {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.getAll());

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function getAll() {
        return _getAll.apply(this, arguments);
      }

      return getAll;
    }()
    /** Setters */

  }, {
    key: "addController",
    value: function () {
      var _addController = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(newController) {
        var contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context5.sent;
                return _context5.abrupt("return", contract.functions.addController(newController));

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function addController(_x3) {
        return _addController.apply(this, arguments);
      }

      return addController;
    }()
  }, {
    key: "removeController",
    value: function () {
      var _removeController = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(controller) {
        var contract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context6.sent;
                return _context6.abrupt("return", contract.functions.removeController(controller));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function removeController(_x4) {
        return _removeController.apply(this, arguments);
      }

      return removeController;
    }()
  }, {
    key: "createParentSTN721",
    value: function () {
      var _createParentSTN = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(name, symbol) {
        var contract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context7.sent;
                return _context7.abrupt("return", contract.functions.createParentSTN721(name, symbol));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function createParentSTN721(_x5, _x6) {
        return _createParentSTN.apply(this, arguments);
      }

      return createParentSTN721;
    }()
  }, {
    key: "createChildSTN721",
    value: function () {
      var _createChildSTN = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(stn721Parent, tokenId, name, symbol) {
        var contract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context8.sent;
                return _context8.abrupt("return", contract.functions.createChildSTN721(stn721Parent, tokenId, name, symbol));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function createChildSTN721(_x7, _x8, _x9, _x10) {
        return _createChildSTN.apply(this, arguments);
      }

      return createChildSTN721;
    }()
  }, {
    key: "mint",
    value: function () {
      var _mint = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(stn721, divisible, tokenIds, receiver) {
        var contract;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context9.sent;
                return _context9.abrupt("return", contract.functions.mint(stn721, divisible, tokenIds, receiver));

              case 4:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function mint(_x11, _x12, _x13, _x14) {
        return _mint.apply(this, arguments);
      }

      return mint;
    }()
  }, {
    key: "mintChild",
    value: function () {
      var _mintChild = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee10(stn721Child, divisible, tokenIds) {
        var contract;
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                _context10.next = 2;
                return this._getManagerContract();

              case 2:
                contract = _context10.sent;
                return _context10.abrupt("return", contract.functions.mintChild(stn721Child, divisible, tokenIds));

              case 4:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function mintChild(_x15, _x16, _x17) {
        return _mintChild.apply(this, arguments);
      }

      return mintChild;
    }()
  }], [{
    key: "deploySTN721ManagerContract",
    value: function () {
      var _deploySTN721ManagerContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee11(signer, produceAddress, controllers) {
        return _regenerator["default"].wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                return _context11.abrupt("return", (0, _deploy.deploySTN721Manager)(signer, produceAddress, controllers));

              case 1:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11);
      }));

      function deploySTN721ManagerContract(_x18, _x19, _x20) {
        return _deploySTN721ManagerContract.apply(this, arguments);
      }

      return deploySTN721ManagerContract;
    }()
  }]);
  return ManagerController;
}();

exports.ManagerController = ManagerController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9yZWEvbWFuYWdlckNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiTWFuYWdlckNvbnRyb2xsZXIiLCJtYW5hZ2VyQWRkcmVzcyIsInNpZ25lck9yUHJvdmlkZXIiLCJfbWFuYWdlckFkZHJlc3MiLCJTaWduZXIiLCJldGhlcnMiLCJwcm92aWRlcnMiLCJKc29uUnBjU2lnbmVyIiwiX3NpZ25lciIsIndlYjNXcmFwcGVyIiwiV2ViM1Byb3ZpZGVyIiwiZ2V0U2lnbmVyIiwiX21hbmFnZXJDb250cmFjdCIsImNvbnRyYWN0IiwiRXJyb3IiLCJfZ2V0TWFuYWdlckNvbnRyYWN0Iiwic3RuNzIxUGFyZW50IiwidG9rZW5JZCIsImdldENoaWxkIiwiZ2V0QWxsIiwibmV3Q29udHJvbGxlciIsImZ1bmN0aW9ucyIsImFkZENvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwicmVtb3ZlQ29udHJvbGxlciIsIm5hbWUiLCJzeW1ib2wiLCJjcmVhdGVQYXJlbnRTVE43MjEiLCJjcmVhdGVDaGlsZFNUTjcyMSIsInN0bjcyMSIsImRpdmlzaWJsZSIsInRva2VuSWRzIiwicmVjZWl2ZXIiLCJtaW50Iiwic3RuNzIxQ2hpbGQiLCJtaW50Q2hpbGQiLCJzaWduZXIiLCJwcm9kdWNlQWRkcmVzcyIsImNvbnRyb2xsZXJzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0lBS2FBLGlCO0FBTVQsNkJBQVlDLGNBQVosRUFBb0NDLGdCQUFwQyxFQUF3RTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ3BFLFNBQUtDLGVBQUwsR0FBdUJGLGNBQXZCOztBQUVBLFFBQUdDLGdCQUFnQixZQUFZRSxjQUE1QixJQUFzQ0YsZ0JBQWdCLFlBQVlHLGVBQU9DLFNBQVAsQ0FBaUJDLGFBQXRGLEVBQXFHO0FBQ2pHLFdBQUtDLE9BQUwsR0FBZU4sZ0JBQWY7QUFDSCxLQUZELE1BRU87QUFDSCxVQUFNTyxXQUFXLEdB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LCBldGhlcnMsIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcbmltcG9ydCB7IGdldE1hbmFnZXJDb250cmFjdCB9IGZyb20gXCIuLi8uLi9jaGFpbi9wcmVmYWJDb250cmFjdEZhY3RvcnlcIjtcbmltcG9ydCB7IGRlcGxveVNUTjcyMU1hbmFnZXIgfSBmcm9tIFwiLi4vLi4vZXRoZXJldW0vZGVwbG95L2RlcGxveVwiO1xuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5pbXBvcnQgeyBTVE43MjFNYW5hZ2VyIH0gZnJvbSBcIi4uLy4uL3R5cGVzL1NUTjcyMU1hbmFnZXJcIjtcblxuXG5leHBvcnQgY2xhc3MgTWFuYWdlckNvbnRyb2xsZXIge1xuXG4gICAgcHJpdmF0ZSBfbWFuYWdlckFkZHJlc3M6IHN0cmluZztcbiAgICBwcml2YXRlIF9zaWduZXI6IFNpZ25lcjtcbiAgICBwcml2YXRlIF9tYW5hZ2VyQ29udHJhY3Q/IDogU1RONzIxTWFuYWdlclxuXG4gICAgY29uc3RydWN0b3IobWFuYWdlckFkZHJlc3M6IHN0cmluZywgc2lnbmVyT3JQcm92aWRlcjogUHJvdmlkZXJPclNpZ25lcikge1xuICAgICAgICB0aGlzLl9tYW5hZ2VyQWRkcmVzcyA9IG1hbmFnZXJBZGRyZXNzO1xuXG4gICAgICAgIGlmKHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBTaWduZXIgfHwgc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1NpZ25lcikge1xuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gc2lnbmVyT3JQcm92aWRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYjNXcmFwcGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHNpZ25lck9yUHJvdmlkZXIpIFxuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gd2ViM1dyYXBwZXIuZ2V0U2lnbmVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2dldE1hbmFnZXJDb250cmFjdCgpOiBQcm9taXNlPFNUTjcyMU1hbmFnZXI+IHtcbiAgICAgICAgaWYodGhpcy5fbWFuYWdlckNvbnRyYWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFuYWdlckNvbnRyYWN0O1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgdG8gdGhlIGNvbnRyYWN0IHdpdGggbXkgc2lnbmVyXG4gICAgICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldE1hbmFnZXJDb250cmFjdCh0aGlzLl9tYW5hZ2VyQWRkcmVzcywgdGhpcy5fc2lnbmVyKTtcbiAgICAgICAgICAgIHRoaXMuX21hbmFnZXJDb250cmFjdCA9IGNvbnRyYWN0O1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRyYWN0O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgRmFpbGVkIHRvIGdldCBTVE43MjFNYW5hZ2VyIGNvbnRyYWN0OiAke2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGRlcGxveVNUTjcyMU1hbmFnZXJDb250cmFjdChzaWduZXI6IFNpZ25lciwgcHJvZHVjZUFkZHJlc3M6IHN0cmluZywgY29udHJvbGxlcnM6IEFycmF5PHN0cmluZz4pOiBQcm9taXNlPFNUTjcyMU1hbmFnZXI+IHtcbiAgICAgICAgcmV0dXJuIGRlcGxveVNUTjcyMU1hbmFnZXIoc2lnbmVyLCBwcm9kdWNlQWRkcmVzcywgY29udHJvbGxlcnMpXG4gICAgfVxuXG4gICAgLyoqR2V0dGVycyAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRDb250cmFjdCgpOiBQcm9taXNlPFNUTjcyMU1hbmFnZXI+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRNYW5hZ2VyQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldENoaWxkKHN0bjcyMVBhcmVudDogc3RyaW5nLCB0b2tlbklkOiBCaWdOdW1iZXJpc2gpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldE1hbmFnZXJDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZ2V0Q2hpbGQoc3RuNzIxUGFyZW50LCB0b2tlbklkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0QWxsKCk6IFByb21pc2U8QXJyYXk8c3RyaW5nPj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldE1hbmFnZXJDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZ2V0QWxsKCk7XG4gICAgfVxuXG4gICAgLyoqIFNldHRlcnMgKi8gICAgXG5cbiAgICBwdWJsaWMgYXN5bmMgYWRkQ29udHJvbGxlcihuZXdDb250cm9sbGVyOiBzdHJpbmcpOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRNYW5hZ2VyQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5hZGRDb250cm9sbGVyKG5ld0NvbnRyb2xsZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyByZW1vdmVDb250cm9sbGVyKGNvbnRyb2xsZXI6IHN0cmluZyk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldE1hbmFnZXJDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZnVuY3Rpb25zLnJlbW92ZUNvbnRyb2xsZXIoY29udHJvbGxlcik7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGNyZWF0ZVBhcmVudFNUTjcyMShcbiAgICAgICAgbmFtZTogc3RyaW5nLCBcbiAgICAgICAgc3ltYm9sOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRNYW5hZ2VyQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5jcmVhdGVQYXJlbnRTVE43MjEobmFtZSwgc3ltYm9sKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgY3JlYXRlQ2hpbGRTVE43MjEoXG4gICAgICAgIHN0bjcyMVBhcmVudDogc3RyaW5nLCBcbiAgICAgICAgdG9rZW5JZDogQmlnTnVtYmVyaXNoLCBcbiAgICAgICAgbmFtZTogc3RyaW5nLCBcbiAgICAgICAgc3ltYm9sOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRNYW5hZ2VyQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5jcmVhdGVDaGlsZFNUTjcyMShzdG43MjFQYXJlbnQsIHRva2VuSWQsIG5hbWUsIHN5bWJvbCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIG1pbnQoIFxuICAgICAgICBzdG43MjE6IHN0cmluZywgXG4gICAgICAgIGRpdmlzaWJsZTogYm9vbGVhbiwgXG4gICAgICAgIHRva2VuSWRzOiBBcnJheTxCaWdOdW1iZXJpc2g+LCBcbiAgICAgICAgcmVjZWl2ZXI6IHN0cmluZ1xuICAgICk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldE1hbmFnZXJDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZnVuY3Rpb25zLm1pbnQoc3RuNzIxLCBkaXZpc2libGUsIHRva2VuSWRzLCByZWNlaXZlcik7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIG1pbnRDaGlsZChcbiAgICAgICAgc3RuNzIxQ2hpbGQ6IHN0cmluZywgXG4gICAgICAgIGRpdmlzaWJsZTogYm9vbGVhbiwgXG4gICAgICAgIHRva2VuSWRzOiBBcnJheTxCaWdOdW1iZXJpc2g+XG4gICAgKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0TWFuYWdlckNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMubWludENoaWxkKHN0bjcyMUNoaWxkLCBkaXZpc2libGUsIHRva2VuSWRzKTtcbiAgICB9XG59Il19
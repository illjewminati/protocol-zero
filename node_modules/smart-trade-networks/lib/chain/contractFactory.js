"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof3 = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.deployContract = deployContract;
exports.getContract = getContract;
exports.initializeContract = initializeContract;
exports.initializeContractWithArgs = initializeContractWithArgs;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _ethers = require("ethers");

var _providerFactory = require("./providerFactory");

var _signerFactory = require("./signerFactory");

var artifactOwnedUpgradeabilityProxy2 = _interopRequireWildcard(require("../ethereum/abi/OwnedUpgradeabilityProxyOriginal.json"));

var _encodeCall = require("../ethereum/encodeCall");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof3(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function deployContract(_x, _x2) {
  return _deployContract.apply(this, arguments);
}

function _deployContract() {
  _deployContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(signer, compilerOutput) {
    var contractFactory,
        _len,
        args,
        _key,
        contract,
        _args = arguments;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.prev = 0;
            contractFactory = _ethers.ContractFactory.fromSolidity(compilerOutput, signer);

            for (_len = _args.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
              args[_key - 2] = _args[_key];
            }

            _context.next = 5;
            return contractFactory.deploy.apply(contractFactory, args);

          case 5:
            contract = _context.sent;
            _context.next = 8;
            return contract.deployed();

          case 8:
            return _context.abrupt("return", _context.sent);

          case 11:
            _context.prev = 11;
            _context.t0 = _context["catch"](0);
            throw Error("deployContract(): ".concat(_context.t0));

          case 14:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[0, 11]]);
  }));
  return _deployContract.apply(this, arguments);
}

;

function getContract(_x3, _x4, _x5) {
  return _getContract.apply(this, arguments);
}

function _getContract() {
  _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(address, abi, addressOrIndexOrSigner) {
    var signer, provider;
    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            if (!(addressOrIndexOrSigner !== undefined)) {
              _context2.next = 12;
              break;
            }

            if (["string", "number"].includes((0, _typeof2["default"])(addressOrIndexOrSigner))) {
              _context2.next = 5;
              break;
            }

            signer = addressOrIndexOrSigner;
            _context2.next = 9;
            break;

          case 5:
            if (!(signer instanceof _ethers.Signer)) {
              _context2.next = 9;
              break;
            }

            _context2.next = 8;
            return (0, _signerFactory.getSigner)(addressOrIndexOrSigner);

          case 8:
            signer = _context2.sent;

          case 9:
            return _context2.abrupt("return", new _ethers.Contract(address, abi, signer));

          case 12:
            provider = (0, _providerFactory.getProvider)();
            return _context2.abrupt("return", new _ethers.Contract(address, abi, provider));

          case 14:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));
  return _getContract.apply(this, arguments);
}

function initializeContract(_x6, _x7, _x8, _x9) {
  return _initializeContract.apply(this, arguments);
}

function _initializeContract() {
  _initializeContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(signer, compilerOutput, initializer, args) {
    var proxiedContract, proxy, initializeData;
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            _context3.prev = 0;
            _context3.next = 3;
            return deployContract(signer, compilerOutput);

          case 3:
            proxiedContract = _context3.sent;
            _context3.next = 6;
            return deployContract(signer, artifactOwnedUpgradeabilityProxy2);

          case 6:
            proxy = _context3.sent;
            initializeData = (0, _encodeCall.encode)(compilerOutput, initializer, args);
            _context3.next = 10;
            return proxy.functions.upgradeToAndCall(proxiedContract.address, initializeData);

          case 10:
            _context3.next = 12;
            return getContract(proxy.address, compilerOutput.abi, signer);

          case 12:
            _context3.t0 = _context3.sent;
            _context3.t1 = proxy.address;
            return _context3.abrupt("return", [_context3.t0, _context3.t1]);

          case 17:
            _context3.prev = 17;
            _context3.t2 = _context3["catch"](0);
            throw Error("initializeContract(): ".concat(_context3.t2));

          case 20:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3, null, [[0, 17]]);
  }));
  return _initializeContract.apply(this, arguments);
}

function initializeContractWithArgs(_x10, _x11, _x12, _x13, _x14) {
  return _initializeContractWithArgs.apply(this, arguments);
}

function _initializeContractWithArgs() {
  _initializeContractWithArgs = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(signer, upgradabilitiyArgs, compilerOutput, initializer, args) {
    var proxiedContract, proxy, initializeData;
    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            _context4.prev = 0;
            _context4.next = 3;
            return deployContract(signer, compilerOutput);

          case 3:
            proxiedContract = _context4.sent;
            _context4.next = 6;
            return deployContract(signer, artifactOwnedUpgradeabilityProxy2, upgradabilitiyArgs);

          case 6:
            proxy = _context4.sent;
            initializeData = (0, _encodeCall.encode)(compilerOutput, initializer, args);
            _context4.next = 10;
            return proxy.functions.upgradeToAndCall(proxiedContract.address, initializeData);

          case 10:
            _context4.next = 12;
            return getContract(proxy.address, compilerOutput.abi, signer);

          case 12:
            _context4.t0 = _context4.sent;
            _context4.t1 = proxy.address;
            return _context4.abrupt("return", [_context4.t0, _context4.t1]);

          case 17:
            _context4.prev = 17;
            _context4.t2 = _context4["catch"](0);
            throw Error("initializeContract(): ".concat(_context4.t2));

          case 20:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4, null, [[0, 17]]);
  }));
  return _initializeContractWithArgs.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jaGFpbi9jb250cmFjdEZhY3RvcnkudHMiXSwibmFtZXMiOlsiZGVwbG95Q29udHJhY3QiLCJzaWduZXIiLCJjb21waWxlck91dHB1dCIsImNvbnRyYWN0RmFjdG9yeSIsIkNvbnRyYWN0RmFjdG9yeSIsImZyb21Tb2xpZGl0eSIsImFyZ3MiLCJkZXBsb3kiLCJjb250cmFjdCIsImRlcGxveWVkIiwiRXJyb3IiLCJnZXRDb250cmFjdCIsImFkZHJlc3MiLCJhYmkiLCJhZGRyZXNzT3JJbmRleE9yU2lnbmVyIiwidW5kZWZpbmVkIiwiaW5jbHVkZXMiLCJTaWduZXIiLCJDb250cmFjdCIsInByb3ZpZGVyIiwiaW5pdGlhbGl6ZUNvbnRyYWN0IiwiaW5pdGlhbGl6ZXIiLCJwcm94aWVkQ29udHJhY3QiLCJhcnRpZmFjdE93bmVkVXBncmFkZWFiaWxpdHlQcm94eTIiLCJwcm94eSIsImluaXRpYWxpemVEYXRhIiwiZnVuY3Rpb25zIiwidXBncmFkZVRvQW5kQ2FsbCIsImluaXRpYWxpemVDb250cmFjdFdpdGhBcmdzIiwidXBncmFkYWJpbGl0aXlBcmdzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOzs7Ozs7U0FJc0JBLGM7Ozs7O2tHQUFmLGlCQUNIQyxNQURHLEVBRUhDLGNBRkc7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1PQyxZQUFBQSxlQU5QLEdBTXlCQyx3QkFBZ0JDLFlBQWhCLENBQTZCSCxjQUE3QixFQUE2Q0QsTUFBN0MsQ0FOekI7O0FBQUEsc0NBR0FLLElBSEE7QUFHQUEsY0FBQUEsSUFIQTtBQUFBOztBQUFBO0FBQUEsbUJBTzRCSCxlQUFlLENBQUNJLE1BQWhCLE9BQUFKLGVBQWUsRUFBV0csSUFBWCxDQVAzQzs7QUFBQTtBQU9PRSxZQUFBQSxRQVBQO0FBQUE7QUFBQSxtQkFRZUEsUUFBUSxD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LEVBQWdCVixjQUFjLENBQUNXLEdBQS9CLEVBQW9DWixNQUFwQyxDQWhCMUI7O0FBQUE7QUFBQTtBQUFBLDJCQWdCdUV1QixLQUFLLENBQUNaLE9BaEI3RTtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQUFBLGtCQW1CT0YsS0FBSywrQ0FuQlo7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnRyYWN0LCBDb250cmFjdEZhY3RvcnksIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcbmltcG9ydCB7IE93bmVkVXBncmFkZWFiaWxpdHlQcm94eSB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgZ2V0UHJvdmlkZXIgfSBmcm9tIFwiLi9wcm92aWRlckZhY3RvcnlcIjtcbmltcG9ydCB7IGdldFNpZ25lciB9IGZyb20gXCIuL3NpZ25lckZhY3RvcnlcIjtcbmltcG9ydCAqIGFzIGFydGlmYWN0T3duZWRVcGdyYWRlYWJpbGl0eVByb3h5IGZyb20gXCIuLi9ldGhlcmV1bS9hYmkvT3duZWRVcGdyYWRlYWJpbGl0eVByb3h5Lmpzb25cIlxuaW1wb3J0ICogYXMgYXJ0aWZhY3RPd25lZFVwZ3JhZGVhYmlsaXR5UHJveHkyIGZyb20gXCIuLi9ldGhlcmV1bS9hYmkvT3duZWRVcGdyYWRlYWJpbGl0eVByb3h5T3JpZ2luYWwuanNvblwiXG5pbXBvcnQgeyBlbmNvZGUgfSBmcm9tIFwiLi4vZXRoZXJldW0vZW5jb2RlQ2FsbFwiO1xuXG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlcGxveUNvbnRyYWN0IDxUIGV4dGVuZHMgQ29udHJhY3Q+KFxuICAgIHNpZ25lcjogU2lnbmVyLFxuICAgIGNvbXBpbGVyT3V0cHV0OiBhbnksXG4gICAgLi4uYXJnczogYW55W11cbik6IFByb21pc2U8VD4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0RmFjdG9yeSA9IENvbnRyYWN0RmFjdG9yeS5mcm9tU29saWRpdHkoY29tcGlsZXJPdXRwdXQsIHNpZ25lcik7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0OiBUID0gKGF3YWl0IGNvbnRyYWN0RmFjdG9yeS5kZXBsb3koLi4uYXJncykpIGFzIFQ7XG4gICAgICAgIHJldHVybiAoYXdhaXQgY29udHJhY3QuZGVwbG95ZWQoKSkgYXMgVDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoYGRlcGxveUNvbnRyYWN0KCk6ICR7ZX1gKVxuICAgIH1cbn07XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRyYWN0IDxUIGV4dGVuZHMgQ29udHJhY3Q+KFxuICAgIGFkZHJlc3M6IHN0cmluZyxcbiAgICBhYmk6IGFueSxcbiAgICBhZGRyZXNzT3JJbmRleE9yU2lnbmVyPzogc3RyaW5nIHwgbnVtYmVyIHwgU2lnbmVyLFxuKTogUHJvbWlzZTxUPiB7XG4gICAgbGV0IHNpZ25lcjogU2lnbmVyXG4gICAgaWYgKGFkZHJlc3NPckluZGV4T3JTaWduZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoIVtcInN0cmluZ1wiLCBcIm51bWJlclwiXS5pbmNsdWRlcyh0eXBlb2YoYWRkcmVzc09ySW5kZXhPclNpZ25lcikpKSB7XG4gICAgICAgICAgICBzaWduZXIgPSBhZGRyZXNzT3JJbmRleE9yU2lnbmVyIGFzIHVua25vd24gYXMgU2lnbmVyXG4gICAgICAgIH0gZWxzZSBpZiAoc2lnbmVyIGluc3RhbmNlb2YgU2lnbmVyKSB7XG4gICAgICAgICAgICBzaWduZXIgPSBhd2FpdCBnZXRTaWduZXIoYWRkcmVzc09ySW5kZXhPclNpZ25lciBhcyBzdHJpbmcgfCBudW1iZXIpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBDb250cmFjdChhZGRyZXNzLCBhYmksIHNpZ25lcikgYXMgVFxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gZ2V0UHJvdmlkZXIoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBDb250cmFjdChhZGRyZXNzLCBhYmksIHByb3ZpZGVyKSBhcyBUXG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNvbnRyYWN0IDxUIGV4dGVuZHMgQ29udHJhY3Q+IChcbiAgICBzaWduZXI6IFNpZ25lcixcbiAgICBjb21waWxlck91dHB1dDogYW55LFxuICAgIGluaXRpYWxpemVyOiBzdHJpbmcsXG4gICAgYXJncz86IGFueVtdIHwgW11cbik6IFByb21pc2U8W1QsIHN0cmluZ10+IHsgICAgXG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm94aWVkQ29udHJhY3Q6IFQgPSBhd2FpdCAgZGVwbG95Q29udHJhY3Qoc2lnbmVyLCBjb21waWxlck91dHB1dClcbiAgICAgICAgY29uc3QgcHJveHk6IE93bmVkVXBncmFkZWFiaWxpdHlQcm94eSA9IGF3YWl0IGRlcGxveUNvbnRyYWN0KHNpZ25lciwgYXJ0aWZhY3RPd25lZFVwZ3JhZGVhYmlsaXR5UHJveHkyKTtcbiAgICAgICBcbiAgICAgICAgY29uc3QgaW5pdGlhbGl6ZURhdGEgPSBlbmNvZGUoY29tcGlsZXJPdXRwdXQsIGluaXRpYWxpemVyLCBhcmdzKVxuICAgICAgIFxuICAgICAgICBhd2FpdCBwcm94eS5mdW5jdGlvbnMudXBncmFkZVRvQW5kQ2FsbChwcm94aWVkQ29udHJhY3QuYWRkcmVzcywgaW5pdGlhbGl6ZURhdGEpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIFthd2FpdCBnZXRDb250cmFjdChwcm94eS5hZGRyZXNzLCBjb21waWxlck91dHB1dC5hYmksIHNpZ25lciksIHByb3h5LmFkZHJlc3NdXG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IEVycm9yKGBpbml0aWFsaXplQ29udHJhY3QoKTogJHtlfWApXG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNvbnRyYWN0V2l0aEFyZ3MgPFQgZXh0ZW5kcyBDb250cmFjdD4gKFxuICAgIHNpZ25lcjogU2lnbmVyLFxuICAgIHVwZ3JhZGFiaWxpdGl5QXJnczogYW55W10sXG4gICAgY29tcGlsZXJPdXRwdXQ6IGFueSxcbiAgICBpbml0aWFsaXplcjogc3RyaW5nLFxuICAgIGFyZ3M/OiBhbnlbXSB8IFtdXG4pOiBQcm9taXNlPFtULCBzdHJpbmddPiB7ICAgIFxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJveGllZENvbnRyYWN0OiBUID0gYXdhaXQgIGRlcGxveUNvbnRyYWN0KHNpZ25lciwgY29tcGlsZXJPdXRwdXQpXG4gICAgICAgIGNvbnN0IHByb3h5OiBPd25lZFVwZ3JhZGVhYmlsaXR5UHJveHkgPSBhd2FpdCBkZXBsb3lDb250cmFjdChzaWduZXIsIGFydGlmYWN0T3duZWRVcGdyYWRlYWJpbGl0eVByb3h5MiwgdXBncmFkYWJpbGl0aXlBcmdzKTtcbiAgICAgICBcbiAgICAgICAgY29uc3QgaW5pdGlhbGl6ZURhdGEgPSBlbmNvZGUoY29tcGlsZXJPdXRwdXQsIGluaXRpYWxpemVyLCBhcmdzKVxuICAgICAgIFxuICAgICAgICBhd2FpdCBwcm94eS5mdW5jdGlvbnMudXBncmFkZVRvQW5kQ2FsbChwcm94aWVkQ29udHJhY3QuYWRkcmVzcywgaW5pdGlhbGl6ZURhdGEpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIFthd2FpdCBnZXRDb250cmFjdChwcm94eS5hZGRyZXNzLCBjb21waWxlck91dHB1dC5hYmksIHNpZ25lciksIHByb3h5LmFkZHJlc3NdXG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IEVycm9yKGBpbml0aWFsaXplQ29udHJhY3QoKTogJHtlfWApXG4gICAgfVxufVxuXG5cblxuIl19
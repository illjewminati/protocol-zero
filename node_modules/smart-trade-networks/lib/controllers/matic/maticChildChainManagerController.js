"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MaticChildChainManagerController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var MaticChildChainManagerController = /*#__PURE__*/function () {
  function MaticChildChainManagerController(rootChainAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, MaticChildChainManagerController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_childChainManagerAddress", void 0);
    (0, _defineProperty2["default"])(this, "_childChainmanagerContract", void 0);
    this._childChainManagerAddress = rootChainAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(MaticChildChainManagerController, [{
    key: "_getChildChainManagerContract",
    value: function () {
      var _getChildChainManagerContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._childChainmanagerContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._childChainmanagerContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getMaticChildChainManager)(this._childChainManagerAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._childChainmanagerContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get ChildChainManager contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getChildChainManagerContract() {
        return _getChildChainManagerContract2.apply(this, arguments);
      }

      return _getChildChainManagerContract;
    }()
    /** Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getChildChainManagerContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getChildToken",
    value: function () {
      var _getChildToken = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(rootTokenAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getChildChainManagerContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.rootToChildToken(rootTokenAddress));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getChildToken(_x) {
        return _getChildToken.apply(this, arguments);
      }

      return getChildToken;
    }()
  }, {
    key: "getRootToken",
    value: function () {
      var _getRootToken = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(childTokenAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getChildChainManagerContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.childToRootToken(childTokenAddress));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function getRootToken(_x2) {
        return _getRootToken.apply(this, arguments);
      }

      return getRootToken;
    }()
  }]);
  return MaticChildChainManagerController;
}();

exports.MaticChildChainManagerController = MaticChildChainManagerController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9tYXRpYy9tYXRpY0NoaWxkQ2hhaW5NYW5hZ2VyQ29udHJvbGxlci50cyJdLCJuYW1lcyI6WyJNYXRpY0NoaWxkQ2hhaW5NYW5hZ2VyQ29udHJvbGxlciIsInJvb3RDaGFpbkFkZHJlc3MiLCJzaWduZXJPclByb3ZpZGVyIiwiX2NoaWxkQ2hhaW5NYW5hZ2VyQWRkcmVzcyIsIlNpZ25lciIsImV0aGVycyIsInByb3ZpZGVycyIsIkpzb25ScGNTaWduZXIiLCJfc2lnbmVyIiwid2ViM1dyYXBwZXIiLCJXZWIzUHJvdmlkZXIiLCJnZXRTaWduZXIiLCJfY2hpbGRDaGFpbm1hbmFnZXJDb250cmFjdCIsImNvbnRyYWN0IiwiRXJyb3IiLCJfZ2V0Q2hpbGRDaGFpbk1hbmFnZXJDb250cmFjdCIsInJvb3RUb2tlbkFkZHJlc3MiLCJyb290VG9DaGlsZFRva2VuIiwiY2hpbGRUb2tlbkFkZHJlc3MiLCJjaGlsZFRvUm9vdFRva2VuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0lBSWFBLGdDO0FBTVQsNENBQVlDLGdCQUFaLEVBQXNDQyxnQkFBdEMsRUFBMEU7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUN0RSxTQUFLQyx5QkFBTCxHQUFpQ0YsZ0JBQWpDOztBQUVBLFFBQUdDLGdCQUFnQixZQUFZRSxjQUE1QixJQUFzQ0YsZ0JBQWdCLFlBQVlHLGVBQU9DLFNBQVAsQ0FBaUJDLGFBQXRGLEVBQXFHO0FBQ2pHLFdBQUtDLE9BQUwsR0FBZU4sZ0JBQWY7QUFDSCxLQUZELE1BRU87QUFDSCxVQUFNTyxXQUFXLEdBQUcsSUFBSUosZUFBT0MsU0FBUCxDQUFpQkksWUFBckIsQ0FBa0NSLGdCQUFsQyxDQUFwQjtBQUNBLFdBQUtNLE9BQUwsR0FBZUMsV0FBVyxDQUFDRSxTQUFaLEVBQWY7QUFDSDtBQUNKOzs7Ozt5SEFHRDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxxQkFDTyxLQUFLQywwQkFEWjtBQUFBO0FBQUE7QUFBQTs7QUFBQSxpREFFZSxLQUFLQSwwQkFGcEI7O0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBTytCLHNEQUEwQixLQUFLVCx5QkFBL0IsRUFBMEQsS0FBS0ssT0FBL0QsQ0FQL0I7O0FBQUE7QUFPY0ssZ0JBQUFBLFFBUGQ7QUFRUSxxQkFBS0QsMEJBQUwsR0FBa0NDLFFBQWxDO0FBUlIsaURBU2VBLFFBVGY7O0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBWWNDLEtBQUssa0VBWm5COztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7O0FBZ0JBOzs7Ozt1R0FFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQUMyQixLQUFLQyw2QkFBTCxFQUQzQjs7QUFBQTtBQUNVRixnQkFBQUEsUUFEVjtBQUFBLGtEQUVXQSxRQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7Ozs7O3lHQUtBLGtCQUEyQkcsZ0JBQTNCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQzJCLEtBQUtELDZCQUFMLEVBRDNCOztBQUFBO0FBQ1VGLGdCQUFBQSxRQURWO0FBQUEsa0RBRVdBLFFBQVEsQ0FBQ0ksZ0JBQVQsQ0FBMEJELGdCQUExQixDQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7Ozs7O3dHQUtBLGtCQUEwQkUsaUJBQTFCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQzJCLEtBQUtILDZCQUFMLEVBRDNCOztBQUFBO0FBQ1VGLGdCQUFBQSxRQURWO0FBQUEsa0RBRVdBLFFBQVEsQ0FBQ00sZ0JBQVQsQ0FBMEJELGlCQUExQixDQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBldGhlcnMsIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcbmltcG9ydCB7IGdldE1hdGljQ2hpbGRDaGFpbk1hbmFnZXIgfSBmcm9tIFwiLi4vLi4vY2hhaW4vcHJlZmFiQ29udHJhY3RGYWN0b3J5XCI7IFxuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5pbXBvcnQgeyBDaGlsZENoYWluTWFuYWdlciB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgTWF0aWNDaGlsZENoYWluTWFuYWdlckNvbnRyb2xsZXIge1xuXG4gICAgcHJvdGVjdGVkIF9zaWduZXI6IFNpZ25lcjtcbiAgICBwcml2YXRlIF9jaGlsZENoYWluTWFuYWdlckFkZHJlc3MgOiBzdHJpbmdcbiAgICBwcml2YXRlIF9jaGlsZENoYWlubWFuYWdlckNvbnRyYWN0PyA6IENoaWxkQ2hhaW5NYW5hZ2VyXG5cbiAgICBjb25zdHJ1Y3Rvcihyb290Q2hhaW5BZGRyZXNzOiBzdHJpbmcsIHNpZ25lck9yUHJvdmlkZXI6IFByb3ZpZGVyT3JTaWduZXIpIHtcbiAgICAgICAgdGhpcy5fY2hpbGRDaGFpbk1hbmFnZXJBZGRyZXNzID0gcm9vdENoYWluQWRkcmVzcztcblxuICAgICAgICBpZihzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgU2lnbmVyIHx8IHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBldGhlcnMucHJvdmlkZXJzLkpzb25ScGNTaWduZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHNpZ25lck9yUHJvdmlkZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB3ZWIzV3JhcHBlciA9IG5ldyBldGhlcnMucHJvdmlkZXJzLldlYjNQcm92aWRlcihzaWduZXJPclByb3ZpZGVyKSBcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHdlYjNXcmFwcGVyLmdldFNpZ25lcigpXG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIHByaXZhdGUgYXN5bmMgX2dldENoaWxkQ2hhaW5NYW5hZ2VyQ29udHJhY3QoKTogUHJvbWlzZTxDaGlsZENoYWluTWFuYWdlcj4ge1xuICAgICAgICBpZih0aGlzLl9jaGlsZENoYWlubWFuYWdlckNvbnRyYWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRDaGFpbm1hbmFnZXJDb250cmFjdFxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgdG8gdGhlIGNvbnRyYWN0IHdpdGggbXkgc2lnbmVyXG4gICAgICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldE1hdGljQ2hpbGRDaGFpbk1hbmFnZXIodGhpcy5fY2hpbGRDaGFpbk1hbmFnZXJBZGRyZXNzLCB0aGlzLl9zaWduZXIpXG4gICAgICAgICAgICB0aGlzLl9jaGlsZENoYWlubWFuYWdlckNvbnRyYWN0ID0gY29udHJhY3Q7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhY3RcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYEZhaWxlZCB0byBnZXQgQ2hpbGRDaGFpbk1hbmFnZXIgY29udHJhY3Q6ICR7ZX1gKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEdldHRlcnMgKi9cblxuICAgIHB1YmxpYyBhc3luYyBnZXRDb250cmFjdCgpOiBQcm9taXNlPENoaWxkQ2hhaW5NYW5hZ2VyPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q2hpbGRDaGFpbk1hbmFnZXJDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3RcbiAgICB9XG4gXG4gICAgcHVibGljIGFzeW5jIGdldENoaWxkVG9rZW4ocm9vdFRva2VuQWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDaGlsZENoYWluTWFuYWdlckNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5yb290VG9DaGlsZFRva2VuKHJvb3RUb2tlbkFkZHJlc3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRSb290VG9rZW4oY2hpbGRUb2tlbkFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q2hpbGRDaGFpbk1hbmFnZXJDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuY2hpbGRUb1Jvb3RUb2tlbihjaGlsZFRva2VuQWRkcmVzcyk7XG4gICAgfVxuXG59Il19
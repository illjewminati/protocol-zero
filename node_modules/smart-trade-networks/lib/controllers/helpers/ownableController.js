"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.OwnableController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var OwnableController = /*#__PURE__*/function () {
  function OwnableController(address, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, OwnableController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_address", void 0);
    (0, _defineProperty2["default"])(this, "_contract", void 0);
    this._address = address;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(OwnableController, [{
    key: "_getContract",
    value: function () {
      var _getContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._contract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._contract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getOwnableContract)(this._address, this._signer);

              case 5:
                contract = _context.sent;
                this._contract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get ERC721 contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getContract() {
        return _getContract2.apply(this, arguments);
      }

      return _getContract;
    }()
    /**Setters */

  }, {
    key: "transferOwnership",
    value: function () {
      var _transferOwnership = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(newOwner) {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract.functions.transferOwnership(newOwner));

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function transferOwnership(_x) {
        return _transferOwnership.apply(this, arguments);
      }

      return transferOwnership;
    }()
  }]);
  return OwnableController;
}();

exports.OwnableController = OwnableController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9oZWxwZXJzL293bmFibGVDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIk93bmFibGVDb250cm9sbGVyIiwiYWRkcmVzcyIsInNpZ25lck9yUHJvdmlkZXIiLCJfYWRkcmVzcyIsIlNpZ25lciIsImV0aGVycyIsInByb3ZpZGVycyIsIkpzb25ScGNTaWduZXIiLCJfc2lnbmVyIiwid2ViM1dyYXBwZXIiLCJXZWIzUHJvdmlkZXIiLCJnZXRTaWduZXIiLCJfY29udHJhY3QiLCJjb250cmFjdCIsIkVycm9yIiwibmV3T3duZXIiLCJfZ2V0Q29udHJhY3QiLCJmdW5jdGlvbnMiLCJ0cmFuc2Zlck93bmVyc2hpcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztJQUthQSxpQjtBQU1ULDZCQUFZQyxPQUFaLEVBQTZCQyxnQkFBN0IsRUFBaUU7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUM3RCxTQUFLQyxRQUFMLEdBQWdCRixPQUFoQjs7QUFFQSxRQUFHQyxnQkFBZ0IsWUFBWUUsY0FBNUIsSUFBc0NGLGdCQUFnQixZQUFZRyxlQUFPQyxTQUFQLENBQWlCQyxhQUF0RixFQUFxRztBQUNqRyxXQUFLQyxPQUFMLEdBQWVOLGdCQUFmO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsVUFBTU8sV0FBVyxHQUFHLElBQUlKLGVBQU9DLFNBQVAsQ0FBaUJJLFlBQXJCLENBQWtDUixnQkFBbEMsQ0FBcEI7QUFDQSxXQUFLTSxPQUFMLEdBQWVDLFdBQVcsQ0FBQ0UsU0FBWixFQUFmO0FBQ0g7QUFDSjs7Ozs7d0dBRUQ7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEscUJBQ08sS0FBS0MsU0FEWjtBQUFBO0FBQUE7QUFBQTs7QUFBQSxpREFFZSxLQUFLQSxTQUZwQjs7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFPK0IsK0NBQW1CLEtBQUtULFFBQXhCLEVBQWtDLEtBQUtLLE9BQXZDLENBUC9COztBQUFBO0FBT2NLLGdCQUFBQSxRQVBkO0FBUVEscUJBQUtELFNBQUwsR0FBaUJDLFFBQWpCO0FBUlIsaURBU2VBLFFBVGY7O0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBWWNDLEtBQUssdURBWm5COztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7O0FBaUJBOzs7Ozs2R0FDQSxrQkFBK0JDLFFBQS9CO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQzJCLEtBQUtDLFlBQUwsRUFEM0I7O0FBQUE7QUFDVUgsZ0JBQUFBLFFBRFY7QUFBQSxrREFFV0EsUUFBUSxDQUFDSSxTQUFULENBQW1CQyxpQkFBbkIsQ0FBcUNILFFBQXJDLENBRlg7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnRyYWN0VHJhbnNhY3Rpb24sIGV0aGVycywgU2lnbmVyIH0gZnJvbSBcImV0aGVyc1wiO1xuaW1wb3J0IHsgZ2V0T3duYWJsZUNvbnRyYWN0IH0gZnJvbSBcIi4uLy4uL2NoYWluL3ByZWZhYkNvbnRyYWN0RmFjdG9yeVwiO1xuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5pbXBvcnQgeyBPd25hYmxlIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5cblxuZXhwb3J0IGNsYXNzIE93bmFibGVDb250cm9sbGVyIHtcblxuICAgIHByb3RlY3RlZCBfc2lnbmVyOiBTaWduZXI7XG4gICAgcHJpdmF0ZSBfYWRkcmVzcyA6IHN0cmluZ1xuICAgIHByaXZhdGUgX2NvbnRyYWN0PyA6IE93bmFibGVcblxuICAgIGNvbnN0cnVjdG9yKGFkZHJlc3M6IHN0cmluZywgc2lnbmVyT3JQcm92aWRlcjogUHJvdmlkZXJPclNpZ25lcikge1xuICAgICAgICB0aGlzLl9hZGRyZXNzID0gYWRkcmVzcztcblxuICAgICAgICBpZihzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgU2lnbmVyIHx8IHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBldGhlcnMucHJvdmlkZXJzLkpzb25ScGNTaWduZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHNpZ25lck9yUHJvdmlkZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB3ZWIzV3JhcHBlciA9IG5ldyBldGhlcnMucHJvdmlkZXJzLldlYjNQcm92aWRlcihzaWduZXJPclByb3ZpZGVyKSBcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHdlYjNXcmFwcGVyLmdldFNpZ25lcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9nZXRDb250cmFjdCgpOiBQcm9taXNlPE93bmFibGU+IHtcbiAgICAgICAgaWYodGhpcy5fY29udHJhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb250cmFjdFxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgdG8gdGhlIGNvbnRyYWN0IHdpdGggbXkgc2lnbmVyXG4gICAgICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldE93bmFibGVDb250cmFjdCh0aGlzLl9hZGRyZXNzLCB0aGlzLl9zaWduZXIpXG4gICAgICAgICAgICB0aGlzLl9jb250cmFjdCA9IGNvbnRyYWN0O1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBGYWlsZWQgdG8gZ2V0IEVSQzcyMSBjb250cmFjdDogJHtlfWApXG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIC8qKlNldHRlcnMgKi9cbiAgICBwdWJsaWMgYXN5bmMgdHJhbnNmZXJPd25lcnNoaXAobmV3T3duZXI6IHN0cmluZyk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMudHJhbnNmZXJPd25lcnNoaXAobmV3T3duZXIpO1xuICAgIH1cbn0iXX0=
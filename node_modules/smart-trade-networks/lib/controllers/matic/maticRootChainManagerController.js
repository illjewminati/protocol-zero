"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MaticRootChainManagerController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var MaticRootChainManagerController = /*#__PURE__*/function () {
  function MaticRootChainManagerController(rootChainAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, MaticRootChainManagerController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_rootChainManagerAddress", void 0);
    (0, _defineProperty2["default"])(this, "_rootChainmanagerContract", void 0);
    this._rootChainManagerAddress = rootChainAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(MaticRootChainManagerController, [{
    key: "_getRootChainManagerContract",
    value: function () {
      var _getRootChainManagerContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._rootChainmanagerContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._rootChainmanagerContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getMaticRootChainManager)(this._rootChainManagerAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._rootChainmanagerContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get RootChainManagerStorage contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getRootChainManagerContract() {
        return _getRootChainManagerContract2.apply(this, arguments);
      }

      return _getRootChainManagerContract;
    }()
    /** Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getRootChainManagerContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getChildToken",
    value: function () {
      var _getChildToken = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(rootTokenAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getRootChainManagerContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.rootToChildToken(rootTokenAddress));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getChildToken(_x) {
        return _getChildToken.apply(this, arguments);
      }

      return getChildToken;
    }()
  }, {
    key: "getRootToken",
    value: function () {
      var _getRootToken = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(childTokenAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getRootChainManagerContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.childToRootToken(childTokenAddress));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function getRootToken(_x2) {
        return _getRootToken.apply(this, arguments);
      }

      return getRootToken;
    }()
  }]);
  return MaticRootChainManagerController;
}();

exports.MaticRootChainManagerController = MaticRootChainManagerController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9tYXRpYy9tYXRpY1Jvb3RDaGFpbk1hbmFnZXJDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIk1hdGljUm9vdENoYWluTWFuYWdlckNvbnRyb2xsZXIiLCJyb290Q2hhaW5BZGRyZXNzIiwic2lnbmVyT3JQcm92aWRlciIsIl9yb290Q2hhaW5NYW5hZ2VyQWRkcmVzcyIsIlNpZ25lciIsImV0aGVycyIsInByb3ZpZGVycyIsIkpzb25ScGNTaWduZXIiLCJfc2lnbmVyIiwid2ViM1dyYXBwZXIiLCJXZWIzUHJvdmlkZXIiLCJnZXRTaWduZXIiLCJfcm9vdENoYWlubWFuYWdlckNvbnRyYWN0IiwiY29udHJhY3QiLCJFcnJvciIsIl9nZXRSb290Q2hhaW5NYW5hZ2VyQ29udHJhY3QiLCJyb290VG9rZW5BZGRyZXNzIiwicm9vdFRvQ2hpbGRUb2tlbiIsImNoaWxkVG9rZW5BZGRyZXNzIiwiY2hpbGRUb1Jvb3RUb2tlbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztJQU1hQSwrQjtBQU1ULDJDQUFZQyxnQkFBWixFQUFzQ0MsZ0JBQXRDLEVBQTBFO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDdEUsU0FBS0Msd0JBQUwsR0FBZ0NGLGdCQUFoQzs7QUFFQSxRQUFHQyxnQkFBZ0IsWUFBWUUsY0FBNUIsSUFBc0NGLGdCQUFnQixZQUFZRyxlQUFPQyxTQUFQLENBQWlCQyxhQUF0RixFQUFxRztBQUNqRyxXQUFLQyxPQUFMLEdBQWVOLGdCQUFmO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsVUFBTU8sV0FBVyxHQUFHLElBQUlKLGVBQU9DLFNBQVAsQ0FBaUJJLFlBQXJCLENBQWtDUixnQkFBbEMsQ0FBcEI7QUFDQSxXQUFLTSxPQUFMLEdBQWVDLFdBQVcsQ0FBQ0UsU0FBWixFQUFmO0FBQ0g7QUFDSjs7Ozs7d0hBR0Q7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEscUJBQ08sS0FBS0MseUJBRFo7QUFBQTtBQUFBO0FBQUE7O0FBQUEsaURBRWUsS0FBS0EseUJBRnBCOztBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQU8rQixxREFBeUIsS0FBS1Qsd0JBQTlCLEVBQXdELEtBQUtLLE9BQTdELENBUC9COztBQUFBO0FBT2NLLGdCQUFBQSxRQVBkO0FBUVEscUJBQUtELHlCQUFMLEdBQWlDQyxRQUFqQztBQVJSLGlEQVNlQSxRQVRmOztBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQVljQyxLQUFLLHdFQVpuQjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxPOzs7Ozs7OztBQWdCQTs7Ozs7dUdBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFDMkIsS0FBS0MsNEJBQUwsRUFEM0I7O0FBQUE7QUFDVUYsZ0JBQUFBLFFBRFY7QUFBQSxrREFFV0EsUUFGWDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxPOzs7Ozs7Ozs7Ozt5R0FLQSxrQkFBMkJHLGdCQUEzQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQUMyQixLQUFLRCw0QkFBTCxFQUQzQjs7QUFBQTtBQUNVRixnQkFBQUEsUUFEVjtBQUFBLGtEQUVXQSxRQUFRLENBQUNJLGdCQUFULENBQTBCRCxnQkFBMUIsQ0FGWDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxPOzs7Ozs7Ozs7Ozt3R0FLQSxrQkFBMEJFLGlCQUExQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQUMyQixLQUFLSCw0QkFBTCxFQUQzQjs7QUFBQTtBQUNVRixnQkFBQUEsUUFEVjtBQUFBLGtEQUVXQSxRQUFRLENBQUNNLGdCQUFULENBQTBCRCxpQkFBMUIsQ0FGWDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXRoZXJzLCBTaWduZXIgfSBmcm9tIFwiZXRoZXJzXCI7XG5pbXBvcnQgeyBnZXRNYXRpY1Jvb3RDaGFpbk1hbmFnZXIgfSBmcm9tIFwiLi4vLi4vY2hhaW4vcHJlZmFiQ29udHJhY3RGYWN0b3J5XCI7XG5pbXBvcnQgeyBQcm92aWRlck9yU2lnbmVyIH0gZnJvbSBcIi4uLy4uL2xvY2FsVHlwZXNcIjtcbmltcG9ydCB7IFJvb3RDaGFpbk1hbmFnZXJTdG9yYWdlIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5cblxuXG5leHBvcnQgY2xhc3MgTWF0aWNSb290Q2hhaW5NYW5hZ2VyQ29udHJvbGxlciB7XG5cbiAgICBwcm90ZWN0ZWQgX3NpZ25lcjogU2lnbmVyO1xuICAgIHByaXZhdGUgX3Jvb3RDaGFpbk1hbmFnZXJBZGRyZXNzIDogc3RyaW5nXG4gICAgcHJpdmF0ZSBfcm9vdENoYWlubWFuYWdlckNvbnRyYWN0PyA6IFJvb3RDaGFpbk1hbmFnZXJTdG9yYWdlXG5cbiAgICBjb25zdHJ1Y3Rvcihyb290Q2hhaW5BZGRyZXNzOiBzdHJpbmcsIHNpZ25lck9yUHJvdmlkZXI6IFByb3ZpZGVyT3JTaWduZXIpIHtcbiAgICAgICAgdGhpcy5fcm9vdENoYWluTWFuYWdlckFkZHJlc3MgPSByb290Q2hhaW5BZGRyZXNzO1xuXG4gICAgICAgIGlmKHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBTaWduZXIgfHwgc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1NpZ25lcikge1xuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gc2lnbmVyT3JQcm92aWRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYjNXcmFwcGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHNpZ25lck9yUHJvdmlkZXIpIFxuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gd2ViM1dyYXBwZXIuZ2V0U2lnbmVyKClcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZ2V0Um9vdENoYWluTWFuYWdlckNvbnRyYWN0KCk6IFByb21pc2U8Um9vdENoYWluTWFuYWdlclN0b3JhZ2U+IHtcbiAgICAgICAgaWYodGhpcy5fcm9vdENoYWlubWFuYWdlckNvbnRyYWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcm9vdENoYWlubWFuYWdlckNvbnRyYWN0XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ29ubmVjdCB0byB0aGUgY29udHJhY3Qgd2l0aCBteSBzaWduZXJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgZ2V0TWF0aWNSb290Q2hhaW5NYW5hZ2VyKHRoaXMuX3Jvb3RDaGFpbk1hbmFnZXJBZGRyZXNzLCB0aGlzLl9zaWduZXIpXG4gICAgICAgICAgICB0aGlzLl9yb290Q2hhaW5tYW5hZ2VyQ29udHJhY3QgPSBjb250cmFjdDtcbiAgICAgICAgICAgIHJldHVybiBjb250cmFjdFxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgRmFpbGVkIHRvIGdldCBSb290Q2hhaW5NYW5hZ2VyU3RvcmFnZSBjb250cmFjdDogJHtlfWApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogR2V0dGVycyAqL1xuXG4gICAgcHVibGljIGFzeW5jIGdldENvbnRyYWN0KCk6IFByb21pc2U8Um9vdENoYWluTWFuYWdlclN0b3JhZ2U+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRSb290Q2hhaW5NYW5hZ2VyQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgfVxuIFxuICAgIHB1YmxpYyBhc3luYyBnZXRDaGlsZFRva2VuKHJvb3RUb2tlbkFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Um9vdENoYWluTWFuYWdlckNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5yb290VG9DaGlsZFRva2VuKHJvb3RUb2tlbkFkZHJlc3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRSb290VG9rZW4oY2hpbGRUb2tlbkFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Um9vdENoYWluTWFuYWdlckNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5jaGlsZFRvUm9vdFRva2VuKGNoaWxkVG9rZW5BZGRyZXNzKTtcbiAgICB9XG5cbn0iXX0=
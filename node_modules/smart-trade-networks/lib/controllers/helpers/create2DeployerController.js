"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Create2DeployerController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var Create2DeployerController = /*#__PURE__*/function () {
  function Create2DeployerController(create2DeployerAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, Create2DeployerController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_create2DeployerAddress", void 0);
    (0, _defineProperty2["default"])(this, "_create2DeployerContract", void 0);
    this._create2DeployerAddress = create2DeployerAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(Create2DeployerController, [{
    key: "_getCreate2DeployerContract",
    value: function () {
      var _getCreate2DeployerContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._create2DeployerContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._create2DeployerContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getCreate2DeployerContract)(this._create2DeployerAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._create2DeployerContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Create2 contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getCreate2DeployerContract() {
        return _getCreate2DeployerContract2.apply(this, arguments);
      }

      return _getCreate2DeployerContract;
    }()
    /**Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getCreate2DeployerContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "precomputeAddress",
    value: function precomputeAddress(contractBytecode, salt, constructorTypes, constructorArgs) {
      return buildCreate2Address(this._create2DeployerAddress, saltToHex(salt), buildBytecode(constructorTypes, constructorArgs, contractBytecode));
    }
    /**Setters */

  }, {
    key: "deployContract",
    value: function () {
      var _deployContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(salt, contractBytecode, constructorTypes, constructorArgs) {
        var contract, saltHex, bytecode;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getCreate2DeployerContract();

              case 2:
                contract = _context3.sent;
                saltHex = saltToHex(salt);
                bytecode = buildBytecode(constructorTypes, constructorArgs, contractBytecode);
                return _context3.abrupt("return", contract.functions.deploy(bytecode, saltHex));

              case 6:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function deployContract(_x, _x2, _x3, _x4) {
        return _deployContract.apply(this, arguments);
      }

      return deployContract;
    }()
  }]);
  return Create2DeployerController;
}();
/** Class helpers */


exports.Create2DeployerController = Create2DeployerController;

var buildCreate2Address = function buildCreate2Address(factoryAddress, saltHex, byteCode) {
  return "0x".concat(_ethers.ethers.utils.keccak256("0x".concat(['ff', factoryAddress, saltHex, _ethers.ethers.utils.keccak256(byteCode)].map(function (x) {
    return x.replace(/0x/, '');
  }).join(''))).slice(-40)).toLowerCase();
};

var buildBytecode = function buildBytecode(constructorTypes, constructorArgs, contractBytecode) {
  return "".concat(contractBytecode).concat(encodeParams(constructorTypes, constructorArgs).slice(2));
};

var encodeParams = function encodeParams(dataTypes, data) {
  var abiCoder = _ethers.ethers.utils.defaultAbiCoder;
  return abiCoder.encode(dataTypes, data);
};

var saltToHex = function saltToHex(salt) {
  return _ethers.ethers.utils.id(salt.toString());
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9oZWxwZXJzL2NyZWF0ZTJEZXBsb3llckNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiQ3JlYXRlMkRlcGxveWVyQ29udHJvbGxlciIsImNyZWF0ZTJEZXBsb3llckFkZHJlc3MiLCJzaWduZXJPclByb3ZpZGVyIiwiX2NyZWF0ZTJEZXBsb3llckFkZHJlc3MiLCJTaWduZXIiLCJldGhlcnMiLCJwcm92aWRlcnMiLCJKc29uUnBjU2lnbmVyIiwiX3NpZ25lciIsIndlYjNXcmFwcGVyIiwiV2ViM1Byb3ZpZGVyIiwiZ2V0U2lnbmVyIiwiX2NyZWF0ZTJEZXBsb3llckNvbnRyYWN0IiwiY29udHJhY3QiLCJFcnJvciIsIl9nZXRDcmVhdGUyRGVwbG95ZXJDb250cmFjdCIsImNvbnRyYWN0Qnl0ZWNvZGUiLCJzYWx0IiwiY29uc3RydWN0b3JUeXBlcyIsImNvbnN0cnVjdG9yQXJncyIsImJ1aWxkQ3JlYXRlMkFkZHJlc3MiLCJzYWx0VG9IZXgiLCJidWlsZEJ5dGVjb2RlIiwic2FsdEhleCIsImJ5dGVjb2RlIiwiZnVuY3Rpb25zIiwiZGVwbG95IiwiZmFjdG9yeUFkZHJlc3MiLCJieXRlQ29kZSIsInV0aWxzIiwia2VjY2FrMjU2IiwibWFwIiwieCIsInJlcGxhY2UiLCJqb2luIiwic2xpY2UiLCJ0b0xvd2VyQ2FzZSIsImVuY29kZVBhcmFtcyIsImRhdGFUeXBlcyIsImRhdGEiLCJhYmlDb2RlciIsImRlZmF1bHRBYmlDb2RlciIsImVuY29kZSIsImlkIiwidG9TdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTs7QUFFQTs7SUFLYUEseUI7QUFNVCxxQ0FBWUMsc0JBQVosRUFBNENDLGdCQUE1QyxFQUFnRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQzVFLFNBQUtDLHVCQUFMLEdBQStCRixzQkFBL0I7O0FBRUEsUUFBR0MsZ0JBQWdCLFlBQVlFLGNBQTVCLElBQXNDRixnQkFBZ0IsWUFB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LENBQVosQ0FBZ0RnQixLQUFoRCxDQUFzRCxDQUF0RCxDQUpMO0FBQUEsQ0FBdEI7O0FBTUEsSUFBTUUsWUFBWSxHQUFHLFNBQWZBLFlBQWUsQ0FBQ0MsU0FBRCxFQUFtQkMsSUFBbkIsRUFBbUM7QUFDdEQsTUFBTUMsUUFBUSxHQUFHbkMsZUFBT3dCLEtBQVAsQ0FBYVksZUFBOUI7QUFDQSxTQUFPRCxRQUFRLENBQUNFLE1BQVQsQ0FBZ0JKLFNBQWhCLEVBQTJCQyxJQUEzQixDQUFQO0FBQ0QsQ0FIRDs7QUFLQSxJQUFNbEIsU0FBUyxHQUFHLFNBQVpBLFNBQVksQ0FBQ0osSUFBRDtBQUFBLFNBQTJCWixlQUFPd0IsS0FBUCxDQUFhYyxFQUFiLENBQWdCMUIsSUFBSSxDQUFDMkIsUUFBTCxFQUFoQixDQUEzQjtBQUFBLENBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBDb250cmFjdFRyYW5zYWN0aW9uLCBldGhlcnMsIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcblxuaW1wb3J0IHsgZ2V0Q3JlYXRlMkRlcGxveWVyQ29udHJhY3QgfSBmcm9tIFwiLi4vLi4vY2hhaW4vcHJlZmFiQ29udHJhY3RGYWN0b3J5XCI7XG5pbXBvcnQgeyBDcmVhdGUyRGVwbG95ZXIgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IFByb3ZpZGVyT3JTaWduZXIgfSBmcm9tIFwiLi4vLi4vbG9jYWxUeXBlc1wiO1xuXG5cbmV4cG9ydCBjbGFzcyBDcmVhdGUyRGVwbG95ZXJDb250cm9sbGVyIHtcbiAgICBcbiAgcHJpdmF0ZSBfc2lnbmVyOiBTaWduZXI7XG4gIHByaXZhdGUgX2NyZWF0ZTJEZXBsb3llckFkZHJlc3MgOiBzdHJpbmc7XG4gIHByaXZhdGUgX2NyZWF0ZTJEZXBsb3llckNvbnRyYWN0PyA6IENyZWF0ZTJEZXBsb3llcjtcblxuICAgIGNvbnN0cnVjdG9yKGNyZWF0ZTJEZXBsb3llckFkZHJlc3M6IHN0cmluZywgc2lnbmVyT3JQcm92aWRlcjogUHJvdmlkZXJPclNpZ25lcikge1xuICAgICAgICB0aGlzLl9jcmVhdGUyRGVwbG95ZXJBZGRyZXNzID0gY3JlYXRlMkRlcGxveWVyQWRkcmVzcztcbiAgICAgICAgXG4gICAgICAgIGlmKHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBTaWduZXIgfHwgc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1NpZ25lcikge1xuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gc2lnbmVyT3JQcm92aWRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYjNXcmFwcGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHNpZ25lck9yUHJvdmlkZXIgYXMgYW55KSBcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHdlYjNXcmFwcGVyLmdldFNpZ25lcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfZ2V0Q3JlYXRlMkRlcGxveWVyQ29udHJhY3QoKTogUHJvbWlzZTxDcmVhdGUyRGVwbG95ZXI+IHtcbiAgICAgICAgaWYodGhpcy5fY3JlYXRlMkRlcGxveWVyQ29udHJhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGUyRGVwbG95ZXJDb250cmFjdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBDb25uZWN0IHRvIHRoZSBjb250cmFjdCB3aXRoIG15IHNpZ25lclxuICAgICAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCBnZXRDcmVhdGUyRGVwbG95ZXJDb250cmFjdCh0aGlzLl9jcmVhdGUyRGVwbG95ZXJBZGRyZXNzLCB0aGlzLl9zaWduZXIpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlMkRlcGxveWVyQ29udHJhY3QgPSBjb250cmFjdDtcbiAgICAgICAgICAgIHJldHVybiBjb250cmFjdDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYEZhaWxlZCB0byBnZXQgQ3JlYXRlMiBjb250cmFjdDogJHtlfWApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipHZXR0ZXJzICovXG4gICAgcHVibGljIGFzeW5jIGdldENvbnRyYWN0KCk6IFByb21pc2U8Q3JlYXRlMkRlcGxveWVyPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q3JlYXRlMkRlcGxveWVyQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBwcmVjb21wdXRlQWRkcmVzcyhcbiAgICAgIGNvbnRyYWN0Qnl0ZWNvZGU6IHN0cmluZywgXG4gICAgICBzYWx0OiBzdHJpbmcgfCBudW1iZXIsIFxuICAgICAgY29uc3RydWN0b3JUeXBlczogQXJyYXk8YW55PiwgXG4gICAgICBjb25zdHJ1Y3RvckFyZ3M6IEFycmF5PGFueT4sXG4gICAgKTogc3RyaW5nIHtcbiAgICAgIHJldHVybiBidWlsZENyZWF0ZTJBZGRyZXNzKFxuICAgICAgICB0aGlzLl9jcmVhdGUyRGVwbG95ZXJBZGRyZXNzLFxuICAgICAgICBzYWx0VG9IZXgoc2FsdCksXG4gICAgICAgIGJ1aWxkQnl0ZWNvZGUoY29uc3RydWN0b3JUeXBlcywgY29uc3RydWN0b3JBcmdzLCBjb250cmFjdEJ5dGVjb2RlKSxcbiAgICAgIClcbiAgICB9XG4gICAgXG5cbiAgLyoqU2V0dGVycyAqLyAgXG4gIHB1YmxpYyBhc3luYyBkZXBsb3lDb250cmFjdChcbiAgICBzYWx0OiBudW1iZXIgfCBzdHJpbmcsXG4gICAgY29udHJhY3RCeXRlY29kZTogc3RyaW5nLFxuICAgIGNvbnN0cnVjdG9yVHlwZXM6IEFycmF5PHN0cmluZz4sXG4gICAgY29uc3RydWN0b3JBcmdzOiBBcnJheTxhbnk+XG4gICk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q3JlYXRlMkRlcGxveWVyQ29udHJhY3QoKTtcblxuICAgIGNvbnN0IHNhbHRIZXggPSBzYWx0VG9IZXgoc2FsdCk7XG5cbiAgICBjb25zdCBieXRlY29kZSA9IGJ1aWxkQnl0ZWNvZGUoXG4gICAgICBjb25zdHJ1Y3RvclR5cGVzLFxuICAgICAgY29uc3RydWN0b3JBcmdzLFxuICAgICAgY29udHJhY3RCeXRlY29kZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5kZXBsb3koYnl0ZWNvZGUsIHNhbHRIZXgpO1xuICB9XG59XG5cblxuICAvKiogQ2xhc3MgaGVscGVycyAqL1xuICBjb25zdCBidWlsZENyZWF0ZTJBZGRyZXNzID0gKGZhY3RvcnlBZGRyZXNzOiBzdHJpbmcsIHNhbHRIZXg6IHN0cmluZywgYnl0ZUNvZGU6IHN0cmluZykgPT4ge1xuICAgIHJldHVybiBgMHgke2V0aGVycy51dGlsc1xuICAgICAgLmtlY2NhazI1NihcbiAgICAgICAgYDB4JHtbJ2ZmJywgZmFjdG9yeUFkZHJlc3MsIHNhbHRIZXgsIGV0aGVycy51dGlscy5rZWNjYWsyNTYoYnl0ZUNvZGUpXVxuICAgICAgICAgIC5tYXAoKHgpID0+IHgucmVwbGFjZSgvMHgvLCAnJykpXG4gICAgICAgICAgLmpvaW4oJycpfWAsXG4gICAgICApXG4gICAgICAuc2xpY2UoLTQwKX1gLnRvTG93ZXJDYXNlKClcbiAgfVxuXG4gIGNvbnN0IGJ1aWxkQnl0ZWNvZGUgPSAoXG4gICAgY29uc3RydWN0b3JUeXBlczogYW55W10sXG4gICAgY29uc3RydWN0b3JBcmdzOiBhbnlbXSxcbiAgICBjb250cmFjdEJ5dGVjb2RlOiBzdHJpbmcsXG4gICkgPT4gYCR7Y29udHJhY3RCeXRlY29kZX0ke2VuY29kZVBhcmFtcyhjb25zdHJ1Y3RvclR5cGVzLCBjb25zdHJ1Y3RvckFyZ3MpLnNsaWNlKDIsKX1gXG5cbiAgY29uc3QgZW5jb2RlUGFyYW1zID0gKGRhdGFUeXBlczogYW55W10sIGRhdGE6IGFueVtdKSA9PiB7XG4gICAgY29uc3QgYWJpQ29kZXIgPSBldGhlcnMudXRpbHMuZGVmYXVsdEFiaUNvZGVyXG4gICAgcmV0dXJuIGFiaUNvZGVyLmVuY29kZShkYXRhVHlwZXMsIGRhdGEpXG4gIH1cbiAgXG4gIGNvbnN0IHNhbHRUb0hleCA9IChzYWx0OiBzdHJpbmcgfCBudW1iZXIpID0+IGV0aGVycy51dGlscy5pZChzYWx0LnRvU3RyaW5nKCkpXG5cbiJdfQ==
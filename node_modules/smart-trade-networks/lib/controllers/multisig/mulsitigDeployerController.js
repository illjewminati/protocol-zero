"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MultisigDeployerController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var artifact = _interopRequireWildcard(require("../../ethereum/abi/MultisigDeployer.json"));

var _encodeCall = require("../../ethereum/encodeCall");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var MultisigDeployerController = /*#__PURE__*/function () {
  function MultisigDeployerController(multisigDeployerAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, MultisigDeployerController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_multisigDeployerAddress", void 0);
    (0, _defineProperty2["default"])(this, "_multisigDeployerContract", void 0);
    this._multisigDeployerAddress = multisigDeployerAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(MultisigDeployerController, [{
    key: "_getContract",
    value: function () {
      var _getContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._multisigDeployerContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._multisigDeployerContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getMultisigDeployerContract)(this._multisigDeployerAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._multisigDeployerContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Multisig contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getContract() {
        return _getContract2.apply(this, arguments);
      }

      return _getContract;
    }()
    /**Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract3 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract3.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getAll",
    value: function () {
      var _getAll = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.getAll());

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getAll() {
        return _getAll.apply(this, arguments);
      }

      return getAll;
    }()
  }, {
    key: "isMultisigAdded",
    value: function () {
      var _isMultisigAdded = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(multisigAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.isMultisigAdded(multisigAddress));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function isMultisigAdded(_x) {
        return _isMultisigAdded.apply(this, arguments);
      }

      return isMultisigAdded;
    }()
  }, {
    key: "getFeeCollector",
    value: function () {
      var _getFeeCollector = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5() {
        var contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getContract();

              case 2:
                contract = _context5.sent;
                return _context5.abrupt("return", contract.feeCollector());

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function getFeeCollector() {
        return _getFeeCollector.apply(this, arguments);
      }

      return getFeeCollector;
    }()
  }, {
    key: "getPrecomputedAddress",
    value: function () {
      var _getPrecomputedAddress = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(bytecode, salt) {
        var contract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getContract();

              case 2:
                contract = _context6.sent;
                return _context6.abrupt("return", contract.getAddress(bytecode, salt));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function getPrecomputedAddress(_x2, _x3) {
        return _getPrecomputedAddress.apply(this, arguments);
      }

      return getPrecomputedAddress;
    }()
  }, {
    key: "getBytecode",
    value: function () {
      var _getBytecode = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(owners, requried) {
        var contract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getContract();

              case 2:
                contract = _context7.sent;
                return _context7.abrupt("return", contract.getBytecode(owners, requried));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function getBytecode(_x4, _x5) {
        return _getBytecode.apply(this, arguments);
      }

      return getBytecode;
    }()
  }, {
    key: "getContractSalt",
    value: function () {
      var _getContractSalt = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(address) {
        var contract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getContract();

              case 2:
                contract = _context8.sent;
                return _context8.abrupt("return", contract.getContractSalt(address));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function getContractSalt(_x6) {
        return _getContractSalt.apply(this, arguments);
      }

      return getContractSalt;
    }()
    /**Setters */

  }, {
    key: "setFeeCollector",
    value: function () {
      var _setFeeCollector = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(feeCollector) {
        var contract;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._getContract();

              case 2:
                contract = _context9.sent;
                return _context9.abrupt("return", contract.functions.setFeeCollector(feeCollector));

              case 4:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setFeeCollector(_x7) {
        return _setFeeCollector.apply(this, arguments);
      }

      return setFeeCollector;
    }()
  }, {
    key: "deployMultisigPrecomputed",
    value: function () {
      var _deployMultisigPrecomputed = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee10(bytecode, salt) {
        var contract;
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                _context10.next = 2;
                return this._getContract();

              case 2:
                contract = _context10.sent;
                return _context10.abrupt("return", contract.functions.deployMultisig(bytecode, salt));

              case 4:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function deployMultisigPrecomputed(_x8, _x9) {
        return _deployMultisigPrecomputed.apply(this, arguments);
      }

      return deployMultisigPrecomputed;
    }()
  }, {
    key: "transferOwnership",
    value: function () {
      var _transferOwnership = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee11(newOwner) {
        var contract;
        return _regenerator["default"].wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.next = 2;
                return this._getContract();

              case 2:
                contract = _context11.sent;
                return _context11.abrupt("return", contract.functions.transferOwnership(newOwner));

              case 4:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function transferOwnership(_x10) {
        return _transferOwnership.apply(this, arguments);
      }

      return transferOwnership;
    }()
    /** Helpers */

  }], [{
    key: "encodeCall",
    value: function encodeCall(functionName, args) {
      return (0, _encodeCall.encode)(artifact, functionName, args);
    }
  }, {
    key: "decodeCall",
    value: function decodeCall(data) {
      return (0, _encodeCall.decode)(artifact, data);
    }
  }]);
  return MultisigDeployerController;
}();

exports.MultisigDeployerController = MultisigDeployerController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9tdWx0aXNpZy9tdWxzaXRpZ0RlcGxveWVyQ29udHJvbGxlci50cyJdLCJuYW1lcyI6WyJNdWx0aXNpZ0RlcGxveWVyQ29udHJvbGxlciIsIm11bHRpc2lnRGVwbG95ZXJBZGRyZXNzIiwic2lnbmVyT3JQcm92aWRlciIsIl9tdWx0aXNpZ0RlcGxveWVyQWRkcmVzcyIsIlNpZ25lciIsImV0aGVycyIsInByb3ZpZGVycyIsIkpzb25ScGNTaWduZXIiLCJfc2lnbmVyIiwid2ViM1dyYXBwZXIiLCJXZWIzUHJvdmlkZXIiLCJnZXRTaWduZXIiLCJfbXVsdGlzaWdEZXBsb3llckNvbnRyYWN0IiwiY29udHJhY3QiLCJFcnJvciIsIl9nZXRDb250cmFjdCIsImdldEFsbCIsIm11bHRpc2lnQWRkcmVzcyIsImlzTXVsdGlzaWdBZGRlZCIsImZlZUNvbGxlY3RvciIsImJ5dGVjb2RlIiwic2FsdCIsImdldEFkZHJlc3MiLCJvd25lcnMiLCJyZXF1cmllZCIsImdldEJ5dGVjb2RlIiwiYWRkcmVzcyIsImdldENvbnRyYWN0U2FsdCIsImZ1bmN0aW9ucyIsInNldEZlZUNvbGxlY3RvciIsImRlcGxveU11bHRpc2lnIiwibmV3T3duZXIiLCJ0cmFuc2Zlck93bmVyc2hpcCIsImZ1bmN0aW9uTmFtZSIsImFyZ3MiLCJhcnRpZmFjdCIsImRhdGEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUdBOztBQUNBOzs7Ozs7SUFJYUEsMEI7QUFLVCxzQ0FBWUMsdUJBQVosRUFBNkNDLGdCQUE3QyxFQUFpRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQzdFLFNBQUtDLHdCQUFMLEdBQWdDRix1QkFBaEM7O0FBRUEsUUFBR0MsZ0JBQWdCLFlBQVlFLGNBQTVCLElBQXNDRixnQkFBZ0IsWUFBWUcsZUFBT0MsU0FBUCxDQUFpQkMsYUFBdEYsRUFBcUc7QUFDakcsV0FBS0MsT0FBTCxHQUFlTixnQkFB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b250cmFjdFRyYW5zYWN0aW9uLCBldGhlcnMsIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcbmltcG9ydCB7IGdldE11bHRpc2lnRGVwbG95ZXJDb250cmFjdCB9IGZyb20gXCIuLi8uLi9jaGFpbi9wcmVmYWJDb250cmFjdEZhY3RvcnlcIjtcbmltcG9ydCB7IE11bHRpc2lnRGVwbG95ZXIgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcblxuaW1wb3J0ICogYXMgYXJ0aWZhY3QgZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2FiaS9NdWx0aXNpZ0RlcGxveWVyLmpzb25cIlxuaW1wb3J0IHsgZGVjb2RlLCBlbmNvZGUgfSBmcm9tIFwiLi4vLi4vZXRoZXJldW0vZW5jb2RlQ2FsbFwiO1xuaW1wb3J0IHsgRGVjb2RlZENhbGwgfSBmcm9tIFwiLi4vaGVscGVycy9hYmlEZWNvZGVyQ29udHJvbGxlclwiO1xuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBNdWx0aXNpZ0RlcGxveWVyQ29udHJvbGxlciB7XG4gICAgcHJpdmF0ZSBfc2lnbmVyOiBTaWduZXI7XG4gICAgcHJpdmF0ZSBfbXVsdGlzaWdEZXBsb3llckFkZHJlc3MgOiBzdHJpbmdcbiAgICBwcml2YXRlIF9tdWx0aXNpZ0RlcGxveWVyQ29udHJhY3Q/IDogTXVsdGlzaWdEZXBsb3llclxuXG4gICAgY29uc3RydWN0b3IobXVsdGlzaWdEZXBsb3llckFkZHJlc3M6IHN0cmluZywgc2lnbmVyT3JQcm92aWRlcjogUHJvdmlkZXJPclNpZ25lcikge1xuICAgICAgICB0aGlzLl9tdWx0aXNpZ0RlcGxveWVyQWRkcmVzcyA9IG11bHRpc2lnRGVwbG95ZXJBZGRyZXNzO1xuICAgICAgICBcbiAgICAgICAgaWYoc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIFNpZ25lciB8fCBzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgZXRoZXJzLnByb3ZpZGVycy5Kc29uUnBjU2lnbmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9zaWduZXIgPSBzaWduZXJPclByb3ZpZGVyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgd2ViM1dyYXBwZXIgPSBuZXcgZXRoZXJzLnByb3ZpZGVycy5XZWIzUHJvdmlkZXIoc2lnbmVyT3JQcm92aWRlciBhcyBhbnkpIFxuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gd2ViM1dyYXBwZXIuZ2V0U2lnbmVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2dldENvbnRyYWN0KCk6IFByb21pc2U8TXVsdGlzaWdEZXBsb3llcj4ge1xuICAgICAgICBpZih0aGlzLl9tdWx0aXNpZ0RlcGxveWVyQ29udHJhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tdWx0aXNpZ0RlcGxveWVyQ29udHJhY3RcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBDb25uZWN0IHRvIHRoZSBjb250cmFjdCB3aXRoIG15IHNpZ25lclxuICAgICAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCBnZXRNdWx0aXNpZ0RlcGxveWVyQ29udHJhY3QodGhpcy5fbXVsdGlzaWdEZXBsb3llckFkZHJlc3MsIHRoaXMuX3NpZ25lcilcbiAgICAgICAgICAgIHRoaXMuX211bHRpc2lnRGVwbG95ZXJDb250cmFjdCA9IGNvbnRyYWN0O1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBGYWlsZWQgdG8gZ2V0IE11bHRpc2lnIGNvbnRyYWN0OiAke2V9YClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKkdldHRlcnMgKi9cbiAgICBwdWJsaWMgYXN5bmMgZ2V0Q29udHJhY3QoKTogUHJvbWlzZTxNdWx0aXNpZ0RlcGxveWVyPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldEFsbCgpOiBQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZ2V0QWxsKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGlzTXVsdGlzaWdBZGRlZChtdWx0aXNpZ0FkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5pc011bHRpc2lnQWRkZWQobXVsdGlzaWdBZGRyZXNzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0RmVlQ29sbGVjdG9yKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZlZUNvbGxlY3RvcigpO1xuICAgIH1cblxuXG4gICAgcHVibGljIGFzeW5jIGdldFByZWNvbXB1dGVkQWRkcmVzcyhieXRlY29kZTogQnl0ZXNMaWtlLCBzYWx0OiBCaWdOdW1iZXJpc2gpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5nZXRBZGRyZXNzKGJ5dGVjb2RlLCBzYWx0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0Qnl0ZWNvZGUob3duZXJzOiBBcnJheTxzdHJpbmc+LCByZXF1cmllZDogQmlnTnVtYmVyaXNoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZ2V0Qnl0ZWNvZGUob3duZXJzLCByZXF1cmllZCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldENvbnRyYWN0U2FsdChhZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPEJpZ051bWJlcmlzaD4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5nZXRDb250cmFjdFNhbHQoYWRkcmVzcyk7XG4gICAgfVxuXG4gICAgIC8qKlNldHRlcnMgKi8gIFxuICAgICBwdWJsaWMgYXN5bmMgc2V0RmVlQ29sbGVjdG9yKFxuICAgICAgICBmZWVDb2xsZWN0b3I6c3RyaW5nXG4gICAgKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5zZXRGZWVDb2xsZWN0b3IoZmVlQ29sbGVjdG9yKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZGVwbG95TXVsdGlzaWdQcmVjb21wdXRlZChcbiAgICAgICAgYnl0ZWNvZGU6IEJ5dGVzTGlrZSwgXG4gICAgICAgIHNhbHQ6IEJpZ051bWJlcmlzaFxuICAgICk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMuZGVwbG95TXVsdGlzaWcoYnl0ZWNvZGUsIHNhbHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyB0cmFuc2Zlck93bmVyc2hpcChuZXdPd25lcjogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy50cmFuc2Zlck93bmVyc2hpcChuZXdPd25lcik7XG4gICAgfVxuXG4gICAgLyoqIEhlbHBlcnMgKi9cbiAgICBwdWJsaWMgc3RhdGljIGVuY29kZUNhbGwoZnVuY3Rpb25OYW1lOiBzdHJpbmcsIGFyZ3M/OiBhbnlbXSk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBlbmNvZGUoYXJ0aWZhY3QsIGZ1bmN0aW9uTmFtZSwgYXJncylcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRlY29kZUNhbGwoZGF0YTogc3RyaW5nKTogRGVjb2RlZENhbGwgfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIGRlY29kZShhcnRpZmFjdCwgZGF0YSlcbiAgICB9XG59Il19
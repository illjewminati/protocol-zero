"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ProduceController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var _deploy = require("../../ethereum/deploy/deploy");

var ProduceController = /*#__PURE__*/function () {
  function ProduceController(_produceAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, ProduceController);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_produceAddress", void 0);
    (0, _defineProperty2["default"])(this, "_produceContract", void 0);
    this._produceAddress = _produceAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(ProduceController, [{
    key: "_getProduceContract",
    value: function () {
      var _getProduceContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._produceContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._produceContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getProduceContract)(this._produceAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._produceContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Produce contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getProduceContract() {
        return _getProduceContract2.apply(this, arguments);
      }

      return _getProduceContract;
    }()
  }, {
    key: "getContract",
    value:
    /**Getters */
    function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var produceContract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context2.sent;
                return _context2.abrupt("return", produceContract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getEntriesByCompany",
    value: function () {
      var _getEntriesByCompany = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(companyAddress) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context3.sent;
                return _context3.abrupt("return", produceContract.getEntriesByCompany(companyAddress));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getEntriesByCompany(_x) {
        return _getEntriesByCompany.apply(this, arguments);
      }

      return getEntriesByCompany;
    }()
  }, {
    key: "getEntriesByUser",
    value: function () {
      var _getEntriesByUser = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(userAddress) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context4.sent;
                return _context4.abrupt("return", produceContract.getEntriesByUser(userAddress));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function getEntriesByUser(_x2) {
        return _getEntriesByUser.apply(this, arguments);
      }

      return getEntriesByUser;
    }()
  }, {
    key: "getEntryData",
    value: function () {
      var _getEntryData = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(entryNumber) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context5.sent;
                return _context5.abrupt("return", produceContract.getEntryData(entryNumber));

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function getEntryData(_x3) {
        return _getEntryData.apply(this, arguments);
      }

      return getEntryData;
    }()
  }, {
    key: "getNumOfValidations",
    value: function () {
      var _getNumOfValidations = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(entryNumber) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context6.sent;
                return _context6.abrupt("return", produceContract.getNumOfValidations(entryNumber));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function getNumOfValidations(_x4) {
        return _getNumOfValidations.apply(this, arguments);
      }

      return getNumOfValidations;
    }()
  }, {
    key: "getValidation",
    value: function () {
      var _getValidation = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(entryNumber, index) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context7.sent;
                return _context7.abrupt("return", produceContract.getValidation(entryNumber, index));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function getValidation(_x5, _x6) {
        return _getValidation.apply(this, arguments);
      }

      return getValidation;
    }()
    /** Setters */

  }, {
    key: "setPermissionsContract",
    value: function () {
      var _setPermissionsContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(newAddress) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context8.sent;
                return _context8.abrupt("return", produceContract.functions.setPermissionsContract(newAddress));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function setPermissionsContract(_x7) {
        return _setPermissionsContract.apply(this, arguments);
      }

      return setPermissionsContract;
    }()
  }, {
    key: "setSTN721ManagerContract",
    value: function () {
      var _setSTN721ManagerContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(newAddress) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context9.sent;
                return _context9.abrupt("return", produceContract.functions.setSTN721ManagerContract(newAddress));

              case 4:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function setSTN721ManagerContract(_x8) {
        return _setSTN721ManagerContract.apply(this, arguments);
      }

      return setSTN721ManagerContract;
    }()
  }, {
    key: "produce",
    value: function () {
      var _produce = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee10(tokenIds, stn721Address, companyAddress, divisible, involvedCompanies, dbId) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                _context10.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context10.sent;
                return _context10.abrupt("return", produceContract.functions.produce(tokenIds, divisible, stn721Address, companyAddress, involvedCompanies, dbId));

              case 4:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function produce(_x9, _x10, _x11, _x12, _x13, _x14) {
        return _produce.apply(this, arguments);
      }

      return produce;
    }()
  }, {
    key: "produceChild",
    value: function () {
      var _produceChild = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee11(tokenIds, stn721Address, companyAddress, divisible, involvedCompanies, dbId) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context11.sent;
                return _context11.abrupt("return", produceContract.functions.produceChild(tokenIds, divisible, stn721Address, companyAddress, involvedCompanies, dbId));

              case 4:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function produceChild(_x15, _x16, _x17, _x18, _x19, _x20) {
        return _produceChild.apply(this, arguments);
      }

      return produceChild;
    }()
  }, {
    key: "createSTN721Child",
    value: function () {
      var _createSTN721Child = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee12(companyAddress, stn721Parent, tokenId, name, symbol) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                _context12.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context12.sent;
                return _context12.abrupt("return", produceContract.functions.createSTN721Child(companyAddress, stn721Parent, tokenId, name, symbol));

              case 4:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee12, this);
      }));

      function createSTN721Child(_x21, _x22, _x23, _x24, _x25) {
        return _createSTN721Child.apply(this, arguments);
      }

      return createSTN721Child;
    }()
  }, {
    key: "validateEntry",
    value: function () {
      var _validateEntry = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee13(entryNumber, companyAddress) {
        var produceContract;
        return _regenerator["default"].wrap(function _callee13$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                _context13.next = 2;
                return this._getProduceContract();

              case 2:
                produceContract = _context13.sent;
                return _context13.abrupt("return", produceContract.functions.validateEntry(entryNumber, companyAddress));

              case 4:
              case "end":
                return _context13.stop();
            }
          }
        }, _callee13, this);
      }));

      function validateEntry(_x26, _x27) {
        return _validateEntry.apply(this, arguments);
      }

      return validateEntry;
    }()
  }], [{
    key: "deployProduceContract",
    value: function () {
      var _deployProduceContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee14(signer, owner, permissionsAddress) {
        return _regenerator["default"].wrap(function _callee14$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                return _context14.abrupt("return", (0, _deploy.deployProduce)(signer, owner, permissionsAddress));

              case 1:
              case "end":
                return _context14.stop();
            }
          }
        }, _callee14);
      }));

      function deployProduceContract(_x28, _x29, _x30) {
        return _deployProduceContract.apply(this, arguments);
      }

      return deployProduceContract;
    }()
  }]);
  return ProduceController;
}();

exports.ProduceController = ProduceController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9yZWEvcHJvZHVjZUNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiUHJvZHVjZUNvbnRyb2xsZXIiLCJfcHJvZHVjZUFkZHJlc3MiLCJzaWduZXJPclByb3ZpZGVyIiwiU2lnbmVyIiwiZXRoZXJzIiwicHJvdmlkZXJzIiwiSnNvblJwY1NpZ25lciIsIl9zaWduZXIiLCJ3ZWIzV3JhcHBlciIsIldlYjNQcm92aWRlciIsImdldFNpZ25lciIsIl9wcm9kdWNlQ29udHJhY3QiLCJjb250cmFjdCIsIkVycm9yIiwiX2dldFByb2R1Y2VDb250cmFjdCIsInByb2R1Y2VDb250cmFjdCIsImNvbXBhbnlBZGRyZXNzIiwiZ2V0RW50cmllc0J5Q29tcGFueSIsInVzZXJBZGRyZXNzIiwiZ2V0RW50cmllc0J5VXNlciIsImVudHJ5TnVtYmVyIiwiZ2V0RW50cnlEYXRhIiwiZ2V0TnVtT2ZWYWxpZGF0aW9ucyIsImluZGV4IiwiZ2V0VmFsaWRhdGlvbiIsIm5ld0FkZHJlc3MiLCJmdW5jdGlvbnMiLCJzZXRQZXJtaXNzaW9uc0NvbnRyYWN0Iiwic2V0U1RONzIxTWFuYWdlckNvbnRyYWN0IiwidG9rZW5JZHMiLCJzdG43MjFBZGRyZXNzIiwiZGl2aXNpYmxlIiwiaW52b2x2ZWRDb21wYW5pZXMiLCJkYklkIiwicHJvZHVjZSIsInByb2R1Y2VDaGlsZCIsInN0bjcyMVBhcmVudCIsInRva2VuSWQiLCJuYW1lIiwic3ltYm9sIiwiY3JlYXRlU1RONzIxQ2hpbGQiLCJ2YWxpZGF0ZUVudHJ5Iiwic2lnbmVyIiwib3duZXIiLCJwZXJtaXNzaW9uc0FkZHJlc3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFHQTs7QUFDQTs7SUFtQmFBLGlCO0FBTVQsNkJBQVlDLGVBQVosRUFBcUNDLGdCQUFyQyxFQUF5RTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ3JFLFNBQUtELGVBQUwsR0FBdUJBLGVBQXZCOztBQUVB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dW1iZXJpc2gsIEJ5dGVzTGlrZSwgQ29udHJhY3RUcmFuc2FjdGlvbiwgZXRoZXJzLCBTaWduZXIgfSBmcm9tIFwiZXRoZXJzXCI7XG5cbmltcG9ydCB7IFByb2R1Y2UgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IGdldFByb2R1Y2VDb250cmFjdCB9IGZyb20gXCIuLi8uLi9jaGFpbi9wcmVmYWJDb250cmFjdEZhY3RvcnlcIjtcbmltcG9ydCB7IGRlcGxveVByb2R1Y2UgfSBmcm9tIFwiLi4vLi4vZXRoZXJldW0vZGVwbG95L2RlcGxveVwiO1xuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5cbmV4cG9ydCB0eXBlIEVudHJ5RGF0YSA9IFtzdHJpbmcsIHN0cmluZywgc3RyaW5nLCBCaWdOdW1iZXJpc2hbXSwgQmlnTnVtYmVyaXNoLCBzdHJpbmdbXSwgc3RyaW5nXSAmIHtcbiAgICBjb21wYW55OiBzdHJpbmc7XG4gICAgc2lnbmF0b3JpZTogc3RyaW5nO1xuICAgIHN0bjcyMUFkZHJlc3M6IHN0cmluZztcbiAgICB0b2tlbklkczogQmlnTnVtYmVyaXNoW107XG4gICAgdGltZXN0YW1wOiBCaWdOdW1iZXJpc2g7XG4gICAgaW52b2x2ZWRDb21wYW5pZXM6IHN0cmluZ1tdO1xuICAgIGRiSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgVmFsaWRhdGlvbkRhdGEgPSBbc3RyaW5nLCBzdHJpbmcsIEJpZ051bWJlcmlzaF0gJiB7XG4gICAgY29tcGFueTogc3RyaW5nO1xuICAgIHNpZ25hdG9yaWU6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IEJpZ051bWJlcmlzaDtcbn1cblxuZXhwb3J0IGNsYXNzIFByb2R1Y2VDb250cm9sbGVyIHtcblxuICAgIHByaXZhdGUgX3NpZ25lcjogU2lnbmVyO1xuICAgIHByaXZhdGUgX3Byb2R1Y2VBZGRyZXNzIDogc3RyaW5nXG4gICAgcHJpdmF0ZSBfcHJvZHVjZUNvbnRyYWN0PyA6IFByb2R1Y2VcblxuICAgIGNvbnN0cnVjdG9yKF9wcm9kdWNlQWRkcmVzczogc3RyaW5nLCBzaWduZXJPclByb3ZpZGVyOiBQcm92aWRlck9yU2lnbmVyKSB7XG4gICAgICAgIHRoaXMuX3Byb2R1Y2VBZGRyZXNzID0gX3Byb2R1Y2VBZGRyZXNzO1xuXG4gICAgICAgIGlmKHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBTaWduZXIgfHwgc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1NpZ25lcikge1xuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gc2lnbmVyT3JQcm92aWRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYjNXcmFwcGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHNpZ25lck9yUHJvdmlkZXIpIFxuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gd2ViM1dyYXBwZXIuZ2V0U2lnbmVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2dldFByb2R1Y2VDb250cmFjdCgpOiBQcm9taXNlPFByb2R1Y2U+IHtcbiAgICAgICAgaWYodGhpcy5fcHJvZHVjZUNvbnRyYWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvZHVjZUNvbnRyYWN0XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ29ubmVjdCB0byB0aGUgY29udHJhY3Qgd2l0aCBteSBzaWduZXJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgZ2V0UHJvZHVjZUNvbnRyYWN0KHRoaXMuX3Byb2R1Y2VBZGRyZXNzLCB0aGlzLl9zaWduZXIpXG4gICAgICAgICAgICB0aGlzLl9wcm9kdWNlQ29udHJhY3QgPSBjb250cmFjdDtcbiAgICAgICAgICAgIHJldHVybiBjb250cmFjdFxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgRmFpbGVkIHRvIGdldCBQcm9kdWNlIGNvbnRyYWN0OiAke2V9YClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgZGVwbG95UHJvZHVjZUNvbnRyYWN0KFxuICAgICAgICBzaWduZXI6IFNpZ25lciwgXG4gICAgICAgIG93bmVyOiBzdHJpbmcsIFxuICAgICAgICBwZXJtaXNzaW9uc0FkZHJlc3M6IHN0cmluZ1xuICAgICk6IFByb21pc2U8UHJvZHVjZT4ge1xuICAgICAgICByZXR1cm4gZGVwbG95UHJvZHVjZShzaWduZXIsIG93bmVyLCBwZXJtaXNzaW9uc0FkZHJlc3MpO1xuICAgIH1cblxuICAgIC8qKkdldHRlcnMgKi9cbiAgICBwdWJsaWMgYXN5bmMgZ2V0Q29udHJhY3QoKTogUHJvbWlzZTxQcm9kdWNlPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldEVudHJpZXNCeUNvbXBhbnkoY29tcGFueUFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8QXJyYXk8QmlnTnVtYmVyaXNoPj4ge1xuICAgICAgICBjb25zdCBwcm9kdWNlQ29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRQcm9kdWNlQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIHByb2R1Y2VDb250cmFjdC5nZXRFbnRyaWVzQnlDb21wYW55KGNvbXBhbnlBZGRyZXNzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0RW50cmllc0J5VXNlcih1c2VyQWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxBcnJheTxCaWdOdW1iZXJpc2g+PiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmdldEVudHJpZXNCeVVzZXIodXNlckFkZHJlc3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRFbnRyeURhdGEoZW50cnlOdW1iZXI6IEJpZ051bWJlcmlzaCk6IFByb21pc2U8RW50cnlEYXRhPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmdldEVudHJ5RGF0YShlbnRyeU51bWJlcik7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldE51bU9mVmFsaWRhdGlvbnMoZW50cnlOdW1iZXI6IEJpZ051bWJlcmlzaCk6IFByb21pc2U8QmlnTnVtYmVyaXNoPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmdldE51bU9mVmFsaWRhdGlvbnMoZW50cnlOdW1iZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRWYWxpZGF0aW9uKGVudHJ5TnVtYmVyOiBCaWdOdW1iZXJpc2gsIGluZGV4OiBCaWdOdW1iZXJpc2gpOiBQcm9taXNlPFZhbGlkYXRpb25EYXRhPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmdldFZhbGlkYXRpb24oZW50cnlOdW1iZXIsIGluZGV4KTtcbiAgICB9XG5cblxuICAgIC8qKiBTZXR0ZXJzICovXG4gICAgcHVibGljIGFzeW5jIHNldFBlcm1pc3Npb25zQ29udHJhY3QobmV3QWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmZ1bmN0aW9ucy5zZXRQZXJtaXNzaW9uc0NvbnRyYWN0KG5ld0FkZHJlc3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBzZXRTVE43MjFNYW5hZ2VyQ29udHJhY3QobmV3QWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmZ1bmN0aW9ucy5zZXRTVE43MjFNYW5hZ2VyQ29udHJhY3QobmV3QWRkcmVzcyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHByb2R1Y2UoXG4gICAgICAgIHRva2VuSWRzOiBBcnJheTxCaWdOdW1iZXJpc2g+LCBcbiAgICAgICAgc3RuNzIxQWRkcmVzczogc3RyaW5nLFxuICAgICAgICBjb21wYW55QWRkcmVzczogc3RyaW5nLFxuICAgICAgICBkaXZpc2libGU6IGJvb2xlYW4sXG4gICAgICAgIGludm9sdmVkQ29tcGFuaWVzOiBBcnJheTxzdHJpbmc+LFxuICAgICAgICBkYklkOiBCeXRlc0xpa2VcbiAgICApOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgcHJvZHVjZUNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0UHJvZHVjZUNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBwcm9kdWNlQ29udHJhY3QuZnVuY3Rpb25zLnByb2R1Y2UodG9rZW5JZHMsIGRpdmlzaWJsZSwgc3RuNzIxQWRkcmVzcywgY29tcGFueUFkZHJlc3MsIGludm9sdmVkQ29tcGFuaWVzLCBkYklkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgcHJvZHVjZUNoaWxkKFxuICAgICAgICB0b2tlbklkczogQXJyYXk8QmlnTnVtYmVyaXNoPiwgXG4gICAgICAgIHN0bjcyMUFkZHJlc3M6IHN0cmluZyxcbiAgICAgICAgY29tcGFueUFkZHJlc3M6IHN0cmluZyxcbiAgICAgICAgZGl2aXNpYmxlOiBib29sZWFuLFxuICAgICAgICBpbnZvbHZlZENvbXBhbmllczogQXJyYXk8c3RyaW5nPixcbiAgICAgICAgZGJJZDogQnl0ZXNMaWtlXG4gICAgKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmZ1bmN0aW9ucy5wcm9kdWNlQ2hpbGQodG9rZW5JZHMsIGRpdmlzaWJsZSwgc3RuNzIxQWRkcmVzcywgY29tcGFueUFkZHJlc3MsIGludm9sdmVkQ29tcGFuaWVzLCBkYklkKTtcbiAgICB9XG5cblxuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVTVE43MjFDaGlsZChcbiAgICAgICAgY29tcGFueUFkZHJlc3M6IHN0cmluZyxcbiAgICAgICAgc3RuNzIxUGFyZW50OiBzdHJpbmcsXG4gICAgICAgIHRva2VuSWQ6IEJpZ051bWJlcmlzaCxcbiAgICAgICAgbmFtZTogc3RyaW5nLFxuICAgICAgICBzeW1ib2w6IHN0cmluZ1xuICAgICk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBwcm9kdWNlQ29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRQcm9kdWNlQ29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIHByb2R1Y2VDb250cmFjdC5mdW5jdGlvbnMuY3JlYXRlU1RONzIxQ2hpbGQoY29tcGFueUFkZHJlc3MsIHN0bjcyMVBhcmVudCwgdG9rZW5JZCwgbmFtZSwgc3ltYm9sKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgdmFsaWRhdGVFbnRyeShlbnRyeU51bWJlcjogQmlnTnVtYmVyaXNoLCBjb21wYW55QWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IHByb2R1Y2VDb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldFByb2R1Y2VDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gcHJvZHVjZUNvbnRyYWN0LmZ1bmN0aW9ucy52YWxpZGF0ZUVudHJ5KGVudHJ5TnVtYmVyLCBjb21wYW55QWRkcmVzcyk7XG4gICAgfVxuICAgIFxuXG59Il19
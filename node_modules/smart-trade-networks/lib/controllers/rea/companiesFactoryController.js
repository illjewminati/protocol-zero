"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CompaniesFactoryController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var _deploy = require("../../ethereum/deploy/deploy");

var _encodeCall = require("../../ethereum/encodeCall");

var artifact = _interopRequireWildcard(require("../../ethereum/abi/CompaniesFactory.json"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var CompaniesFactoryController = /*#__PURE__*/function () {
  function CompaniesFactoryController(companiesFactoryAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, CompaniesFactoryController);
    (0, _defineProperty2["default"])(this, "_companiesFactoryAddress", void 0);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_factoryContract", void 0);
    this._companiesFactoryAddress = companiesFactoryAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(CompaniesFactoryController, [{
    key: "_getCompaniesFactoryContract",
    value: function () {
      var _getCompaniesFactoryContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._factoryContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._factoryContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getCompaniesFactoryContract)(this._companiesFactoryAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._factoryContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get CompaniesFactory contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getCompaniesFactoryContract() {
        return _getCompaniesFactoryContract2.apply(this, arguments);
      }

      return _getCompaniesFactoryContract;
    }()
  }, {
    key: "getContract",
    value:
    /**Getters */
    function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getCompanies",
    value: function () {
      var _getCompanies = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.getCompanies());

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getCompanies() {
        return _getCompanies.apply(this, arguments);
      }

      return getCompanies;
    }()
  }, {
    key: "isCompanyOwner",
    value: function () {
      var _isCompanyOwner = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(companyAddress, owner) {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.isCompanyOwner(companyAddress, owner));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function isCompanyOwner(_x, _x2) {
        return _isCompanyOwner.apply(this, arguments);
      }

      return isCompanyOwner;
    }()
  }, {
    key: "getCompaniesBySignatorie",
    value: function () {
      var _getCompaniesBySignatorie = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(signatorie) {
        var contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context5.sent;
                return _context5.abrupt("return", contract.getCompaniesBySignatorie(signatorie));

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function getCompaniesBySignatorie(_x3) {
        return _getCompaniesBySignatorie.apply(this, arguments);
      }

      return getCompaniesBySignatorie;
    }()
  }, {
    key: "getSignersByCompany",
    value: function () {
      var _getSignersByCompany = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(companyAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context6.sent;
                return _context6.abrupt("return", contract.getSignersByCompany(companyAddress));

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function getSignersByCompany(_x4) {
        return _getSignersByCompany.apply(this, arguments);
      }

      return getSignersByCompany;
    }()
    /** Setters */

  }, {
    key: "createCompany",
    value: function () {
      var _createCompany = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(owner, name, ipfsLink) {
        var contract;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context7.sent;
                return _context7.abrupt("return", contract.functions.createCompany(owner, name, ipfsLink));

              case 4:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function createCompany(_x5, _x6, _x7) {
        return _createCompany.apply(this, arguments);
      }

      return createCompany;
    }()
  }, {
    key: "removeCompany",
    value: function () {
      var _removeCompany = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(companyAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context8.sent;
                return _context8.abrupt("return", contract.functions.removeCompany(companyAddress));

              case 4:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function removeCompany(_x8) {
        return _removeCompany.apply(this, arguments);
      }

      return removeCompany;
    }()
  }, {
    key: "approveCompany",
    value: function () {
      var _approveCompany = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(companyAddress) {
        var contract;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context9.sent;
                return _context9.abrupt("return", contract.functions.approveCompany(companyAddress));

              case 4:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function approveCompany(_x9) {
        return _approveCompany.apply(this, arguments);
      }

      return approveCompany;
    }()
  }, {
    key: "addCompanySignatorie",
    value: function () {
      var _addCompanySignatorie = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee10(companyAddress, newSignatorie) {
        var contract;
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                _context10.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context10.sent;
                return _context10.abrupt("return", contract.functions.addCompanySignatorie(companyAddress, newSignatorie));

              case 4:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function addCompanySignatorie(_x10, _x11) {
        return _addCompanySignatorie.apply(this, arguments);
      }

      return addCompanySignatorie;
    }()
  }, {
    key: "removeCompanySignatorie",
    value: function () {
      var _removeCompanySignatorie = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee11(companyAddress, signatorie) {
        var contract;
        return _regenerator["default"].wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.next = 2;
                return this._getCompaniesFactoryContract();

              case 2:
                contract = _context11.sent;
                return _context11.abrupt("return", contract.functions.removeCompanySignatorie(companyAddress, signatorie));

              case 4:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function removeCompanySignatorie(_x12, _x13) {
        return _removeCompanySignatorie.apply(this, arguments);
      }

      return removeCompanySignatorie;
    }()
    /** Helpers */

  }], [{
    key: "deployCompaniesFactory",
    value: function () {
      var _deployCompaniesFactory = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee12(signer, owner) {
        return _regenerator["default"].wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                return _context12.abrupt("return", (0, _deploy.deployCompaniesfactory)(signer, owner));

              case 1:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee12);
      }));

      function deployCompaniesFactory(_x14, _x15) {
        return _deployCompaniesFactory.apply(this, arguments);
      }

      return deployCompaniesFactory;
    }()
  }, {
    key: "encodeCall",
    value: function encodeCall(functionName, args) {
      return (0, _encodeCall.encode)(artifact, functionName, args);
    }
  }, {
    key: "decodeCall",
    value: function decodeCall(data) {
      return (0, _encodeCall.decode)(artifact, data);
    }
  }]);
  return CompaniesFactoryController;
}();

exports.CompaniesFactoryController = CompaniesFactoryController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9yZWEvY29tcGFuaWVzRmFjdG9yeUNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiQ29tcGFuaWVzRmFjdG9yeUNvbnRyb2xsZXIiLCJjb21wYW5pZXNGYWN0b3J5QWRkcmVzcyIsInNpZ25lck9yUHJvdmlkZXIiLCJfY29tcGFuaWVzRmFjdG9yeUFkZHJlc3MiLCJTaWduZXIiLCJldGhlcnMiLCJwcm92aWRlcnMiLCJKc29uUnBjU2lnbmVyIiwiX3NpZ25lciIsIndlYjNXcmFwcGVyIiwiV2ViM1Byb3ZpZGVyIiwiZ2V0U2lnbmVyIiwiX2ZhY3RvcnlDb250cmFjdCIsImNvbnRyYWN0IiwiRXJyb3IiLCJfZ2V0Q29tcGFuaWVzRmFjdG9yeUNvbnRyYWN0IiwiZ2V0Q29tcGFuaWVzIiwiY29tcGFueUFkZHJlc3MiLCJvd25lciIsImlzQ29tcGFueU93bmVyIiwic2lnbmF0b3JpZSIsImdldENvbXBhbmllc0J5U2lnbmF0b3JpZSIsImdldFNpZ25lcnNCeUNvbXBhbnkiLCJuYW1lIiwiaXBmc0xpbmsiLCJmdW5jdGlvbnMiLCJjcmVhdGVDb21wYW55IiwicmVtb3ZlQ29tcGFueSIsImFwcHJvdmVDb21wYW55IiwibmV3U2lnbmF0b3JpZSIsImFkZENvbXBhbnlTaWduYXRvcmllIiwicmVtb3ZlQ29tcGFueVNpZ25hdG9yaWUiLCJzaWduZXIiLCJmdW5jdGlvbk5hbWUiLCJhcmdzIiwiYXJ0aWZhY3QiLCJkYXRhIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFJQTs7Ozs7O0lBR2FBLDBCO0FBTVQsc0NBQVlDLHVCQUFaLEVBQTZDQyxnQkFBN0MsRUFBaUY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUM3RSxTQUFLQyx3QkFBTCxHQUFnQ0YsdUJBQWhDOztBQUVBLFFBQUdDLGdCQUFnQixZQUFZRSxjQUE1QixJQUFzQ0YsZ0JBQWdCLFlBQVlHLGVBQU9DLFNB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QTtBQUFBLG1EQUNXLG9DQUF1QmMsTUFBdkIsRUFBK0JkLEtBQS9CLENBRFg7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsTzs7Ozs7Ozs7OztXQTBEQSxvQkFBeUJlLFlBQXpCLEVBQStDQyxJQUEvQyxFQUFxRTtBQUNqRSxhQUFPLHdCQUFPQyxRQUFQLEVBQWlCRixZQUFqQixFQUErQkMsSUFBL0IsQ0FBUDtBQUNIOzs7V0FFRCxvQkFBeUJFLElBQXpCLEVBQTJEO0FBQ3ZELGFBQU8sd0JBQU9ELFFBQVAsRUFBaUJDLElBQWpCLENBQVA7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ5dGVzTGlrZSwgQ29udHJhY3RUcmFuc2FjdGlvbiwgZXRoZXJzLCBTaWduZXIgfSBmcm9tIFwiZXRoZXJzXCI7XG5pbXBvcnQgeyBnZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QgfSBmcm9tIFwiLi4vLi4vY2hhaW4vcHJlZmFiQ29udHJhY3RGYWN0b3J5XCI7XG5pbXBvcnQgeyBkZXBsb3lDb21wYW5pZXNmYWN0b3J5IH0gZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2RlcGxveS9kZXBsb3lcIjtcbmltcG9ydCB7IGRlY29kZSwgZW5jb2RlIH0gZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2VuY29kZUNhbGxcIjtcbmltcG9ydCB7IFByb3ZpZGVyT3JTaWduZXIgfSBmcm9tIFwiLi4vLi4vbG9jYWxUeXBlc1wiO1xuaW1wb3J0IHsgQ29tcGFuaWVzRmFjdG9yeSB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IHsgRGVjb2RlZENhbGwgfSBmcm9tIFwiLi4vaGVscGVycy9hYmlEZWNvZGVyQ29udHJvbGxlclwiO1xuaW1wb3J0ICogYXMgYXJ0aWZhY3QgZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2FiaS9Db21wYW5pZXNGYWN0b3J5Lmpzb25cIlxuXG5cbmV4cG9ydCBjbGFzcyBDb21wYW5pZXNGYWN0b3J5Q29udHJvbGxlciB7XG5cbiAgICBwcml2YXRlIF9jb21wYW5pZXNGYWN0b3J5QWRkcmVzczogc3RyaW5nO1xuICAgIHByaXZhdGUgX3NpZ25lcjogU2lnbmVyO1xuICAgIHByaXZhdGUgX2ZhY3RvcnlDb250cmFjdD8gOiBDb21wYW5pZXNGYWN0b3J5XG5cbiAgICBjb25zdHJ1Y3Rvcihjb21wYW5pZXNGYWN0b3J5QWRkcmVzczogc3RyaW5nLCBzaWduZXJPclByb3ZpZGVyOiBQcm92aWRlck9yU2lnbmVyKSB7XG4gICAgICAgIHRoaXMuX2NvbXBhbmllc0ZhY3RvcnlBZGRyZXNzID0gY29tcGFuaWVzRmFjdG9yeUFkZHJlc3M7XG4gICAgICAgIFxuICAgICAgICBpZihzaWduZXJPclByb3ZpZGVyIGluc3RhbmNlb2YgU2lnbmVyIHx8IHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBldGhlcnMucHJvdmlkZXJzLkpzb25ScGNTaWduZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHNpZ25lck9yUHJvdmlkZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB3ZWIzV3JhcHBlciA9IG5ldyBldGhlcnMucHJvdmlkZXJzLldlYjNQcm92aWRlcihzaWduZXJPclByb3ZpZGVyKSBcbiAgICAgICAgICAgIHRoaXMuX3NpZ25lciA9IHdlYjNXcmFwcGVyLmdldFNpZ25lcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTogUHJvbWlzZTxDb21wYW5pZXNGYWN0b3J5PiB7XG4gICAgICAgIGlmKHRoaXMuX2ZhY3RvcnlDb250cmFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZhY3RvcnlDb250cmFjdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBDb25uZWN0IHRvIHRoZSBjb250cmFjdCB3aXRoIG15IHNpZ25lclxuICAgICAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCBnZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QodGhpcy5fY29tcGFuaWVzRmFjdG9yeUFkZHJlc3MsIHRoaXMuX3NpZ25lcik7XG4gICAgICAgICAgICB0aGlzLl9mYWN0b3J5Q29udHJhY3QgPSBjb250cmFjdDtcbiAgICAgICAgICAgIHJldHVybiBjb250cmFjdDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYEZhaWxlZCB0byBnZXQgQ29tcGFuaWVzRmFjdG9yeSBjb250cmFjdDogJHtlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBkZXBsb3lDb21wYW5pZXNGYWN0b3J5KHNpZ25lcjogU2lnbmVyLCBvd25lcjogc3RyaW5nKTogUHJvbWlzZTxDb21wYW5pZXNGYWN0b3J5PiB7XG4gICAgICAgIHJldHVybiBkZXBsb3lDb21wYW5pZXNmYWN0b3J5KHNpZ25lciwgb3duZXIpXG4gICAgfVxuXG4gICAgLyoqR2V0dGVycyAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRDb250cmFjdCgpOiBQcm9taXNlPENvbXBhbmllc0ZhY3Rvcnk+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldENvbXBhbmllcygpOiBQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmdldENvbXBhbmllcygpXG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGlzQ29tcGFueU93bmVyKGNvbXBhbnlBZGRyZXNzOiBzdHJpbmcsIG93bmVyOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmlzQ29tcGFueU93bmVyKGNvbXBhbnlBZGRyZXNzLCBvd25lcik7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldENvbXBhbmllc0J5U2lnbmF0b3JpZShzaWduYXRvcmllOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmdldENvbXBhbmllc0J5U2lnbmF0b3JpZShzaWduYXRvcmllKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0U2lnbmVyc0J5Q29tcGFueShjb21wYW55QWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxBcnJheTxzdHJpbmc+PiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29tcGFuaWVzRmFjdG9yeUNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5nZXRTaWduZXJzQnlDb21wYW55KGNvbXBhbnlBZGRyZXNzKTtcbiAgICB9XG5cblxuICAgIC8qKiBTZXR0ZXJzICovXG4gICAgcHVibGljIGFzeW5jIGNyZWF0ZUNvbXBhbnkob3duZXI6IHN0cmluZywgbmFtZTogc3RyaW5nLCBpcGZzTGluazogQnl0ZXNMaWtlKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29tcGFuaWVzRmFjdG9yeUNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMuY3JlYXRlQ29tcGFueShvd25lciwgbmFtZSwgaXBmc0xpbmspO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyByZW1vdmVDb21wYW55KGNvbXBhbnlBZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5yZW1vdmVDb21wYW55KGNvbXBhbnlBZGRyZXNzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgYXBwcm92ZUNvbXBhbnkoY29tcGFueUFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbXBhbmllc0ZhY3RvcnlDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZnVuY3Rpb25zLmFwcHJvdmVDb21wYW55KGNvbXBhbnlBZGRyZXNzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgYWRkQ29tcGFueVNpZ25hdG9yaWUoY29tcGFueUFkZHJlc3M6IHN0cmluZywgbmV3U2lnbmF0b3JpZTogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29tcGFuaWVzRmFjdG9yeUNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMuYWRkQ29tcGFueVNpZ25hdG9yaWUoY29tcGFueUFkZHJlc3MsIG5ld1NpZ25hdG9yaWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyByZW1vdmVDb21wYW55U2lnbmF0b3JpZShjb21wYW55QWRkcmVzczogc3RyaW5nLCBzaWduYXRvcmllOiBzdHJpbmcpOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW5pZXNGYWN0b3J5Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5yZW1vdmVDb21wYW55U2lnbmF0b3JpZShjb21wYW55QWRkcmVzcywgc2lnbmF0b3JpZSk7XG4gICAgfVxuXG4gICAgLyoqIEhlbHBlcnMgKi9cbiAgICBwdWJsaWMgc3RhdGljIGVuY29kZUNhbGwoZnVuY3Rpb25OYW1lOiBzdHJpbmcsIGFyZ3M/OiBhbnlbXSk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBlbmNvZGUoYXJ0aWZhY3QsIGZ1bmN0aW9uTmFtZSwgYXJncylcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRlY29kZUNhbGwoZGF0YTogc3RyaW5nKTogRGVjb2RlZENhbGwgfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIGRlY29kZShhcnRpZmFjdCwgZGF0YSlcbiAgICB9XG59Il19
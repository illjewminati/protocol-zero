"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ERC20MaticController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var artifact = _interopRequireWildcard(require("../../ethereum/abi/ChildMintableERC20.json"));

var _encodeCall = require("../../ethereum/encodeCall");

var _erc20Controller = require("../tokens/erc20Controller");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var ERC20MaticController = /*#__PURE__*/function (_ERC20Controller) {
  (0, _inherits2["default"])(ERC20MaticController, _ERC20Controller);

  var _super = _createSuper(ERC20MaticController);

  function ERC20MaticController(erc20MaticAddress, signerOrProvider) {
    var _this;

    (0, _classCallCheck2["default"])(this, ERC20MaticController);
    _this = _super.call(this, erc20MaticAddress, signerOrProvider);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_erc20MaticAddress", void 0);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_erc20MaticContract", void 0);
    _this._erc20MaticAddress = erc20MaticAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      _this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      _this._signer = web3Wrapper.getSigner();
    }

    return _this;
  }

  (0, _createClass2["default"])(ERC20MaticController, [{
    key: "_getERC20MaticContract",
    value: function () {
      var _getERC20MaticContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._erc20MaticContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._erc20MaticContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getERC20MaticContract)(this._erc20MaticAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._erc20MaticContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get ChildMintableERC20 contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getERC20MaticContract() {
        return _getERC20MaticContract2.apply(this, arguments);
      }

      return _getERC20MaticContract;
    }()
    /**Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getERC20MaticContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
    /** Setters */

  }, {
    key: "deposit",
    value: function () {
      var _deposit = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(user, depositData) {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getERC20MaticContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.functions.deposit(user, depositData));

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function deposit(_x, _x2) {
        return _deposit.apply(this, arguments);
      }

      return deposit;
    }()
  }, {
    key: "withdraw",
    value: function () {
      var _withdraw = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(amount) {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getERC20MaticContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.functions.withdraw(amount));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function withdraw(_x3) {
        return _withdraw.apply(this, arguments);
      }

      return withdraw;
    }()
  }, {
    key: "mint",
    value: function () {
      var _mint = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(sender, amount) {
        var contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getERC20MaticContract();

              case 2:
                contract = _context5.sent;
                return _context5.abrupt("return", contract.functions.mint(sender, amount));

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function mint(_x4, _x5) {
        return _mint.apply(this, arguments);
      }

      return mint;
    }()
    /** Helpers */

  }, {
    key: "onEvent",
    value: function () {
      var _onEvent = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(filter, onContractevent) {
        var contract;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._getERC20MaticContract();

              case 2:
                contract = _context6.sent;
                contract.once(filter, function (from, to, value, event) {
                  onContractevent({
                    from: from,
                    to: to,
                    value: value,
                    event: event
                  });
                });

              case 4:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function onEvent(_x6, _x7) {
        return _onEvent.apply(this, arguments);
      }

      return onEvent;
    }()
  }], [{
    key: "encodeCall",
    value: function encodeCall(functionName, args) {
      return (0, _encodeCall.encode)(artifact, functionName, args);
    }
  }, {
    key: "decodeCall",
    value: function decodeCall(data) {
      return (0, _encodeCall.decode)(artifact, data);
    }
  }]);
  return ERC20MaticController;
}(_erc20Controller.ERC20Controller);

exports.ERC20MaticController = ERC20MaticController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9tYXRpYy9lcmMyME1hdGljQ29udHJvbGxlci50cyJdLCJuYW1lcyI6WyJFUkMyME1hdGljQ29udHJvbGxlciIsImVyYzIwTWF0aWNBZGRyZXNzIiwic2lnbmVyT3JQcm92aWRlciIsIl9lcmMyME1hdGljQWRkcmVzcyIsIlNpZ25lciIsImV0aGVycyIsInByb3ZpZGVycyIsIkpzb25ScGNTaWduZXIiLCJfc2lnbmVyIiwid2ViM1dyYXBwZXIiLCJXZWIzUHJvdmlkZXIiLCJnZXRTaWduZXIiLCJfZXJjMjBNYXRpY0NvbnRyYWN0IiwiY29udHJhY3QiLCJFcnJvciIsIl9nZXRFUkMyME1hdGljQ29udHJhY3QiLCJ1c2VyIiwiZGVwb3NpdERhdGEiLCJmdW5jdGlvbnMiLCJkZXBvc2l0IiwiYW1vdW50Iiwid2l0aGRyYXciLCJzZW5kZXIiLCJtaW50IiwiZmlsdGVyIiwib25Db250cmFjdGV2ZW50Iiwib25jZSIsImZyb20iLCJ0byIsInZhbHVlIiwiZXZlbnQiLCJmdW5jdGlvbk5hbWUiLCJhcmdzIiwiYXJ0aWZhY3QiLCJkYXRhIiwiRVJDMjBDb250cm9sbGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOzs7Ozs7Ozs7O0lBS2FBLG9COzs7OztBQUtULGdDQUFZQyxpQkFBWixFQUF1Q0MsZ0JBQXZDLEVBQTJFO0FBQUE7O0FBQUE7QUFDdkUsOEJBQU1ELGlCQUFOLEVBQXlCQyxnQkFBekI7QUFEdUU7QUFBQTtBQUV2RSxVQUFLQyxrQkFBTCxHQUEwQkYsaUJBQTFCOztBQUVBLFFBQUdDLGdCQUFnQixZQUFZRSxjQUE1QixJQUFzQ0YsZ0JBQWdCLFlBQVlHLGVBQU9DLFNBQVAsQ0FBaUJDLGFBQXRGLEVBQXFHO0FBQ2pHLFlBQUtDLE9BQUwsR0FBZU4sZ0JBQWY7QUFDSCxLQUZELE1BRU87QUFDSCxVQUFNTyxXQUFXLEdBQUcs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QixFQUErQkMsSUFBL0IsQ0FBUDtBQUNIOzs7V0FFRCxvQkFBeUJFLElBQXpCLEVBQTJEO0FBQ3ZELGFBQU8sd0JBQU9ELFFBQVAsRUFBaUJDLElBQWpCLENBQVA7QUFDSDs7O0VBaEVxQ0MsZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWdOdW1iZXJpc2gsIEJ5dGVzTGlrZSwgQ29udHJhY3RUcmFuc2FjdGlvbiwgZXRoZXJzLCBFdmVudEZpbHRlciwgU2lnbmVyIH0gZnJvbSBcImV0aGVyc1wiO1xuaW1wb3J0IHsgZ2V0RVJDMjBNYXRpY0NvbnRyYWN0IH0gZnJvbSBcIi4uLy4uL2NoYWluL3ByZWZhYkNvbnRyYWN0RmFjdG9yeVwiO1xuaW1wb3J0ICogYXMgYXJ0aWZhY3QgZnJvbSBcIi4uLy4uL2V0aGVyZXVtL2FiaS9DaGlsZE1pbnRhYmxlRVJDMjAuanNvblwiXG5pbXBvcnQgeyBkZWNvZGUsIGVuY29kZSB9IGZyb20gXCIuLi8uLi9ldGhlcmV1bS9lbmNvZGVDYWxsXCI7XG5pbXBvcnQgeyBEZWNvZGVkQ2FsbCB9IGZyb20gXCIuLi9oZWxwZXJzL2FiaURlY29kZXJDb250cm9sbGVyXCI7XG5pbXBvcnQgeyBDaGlsZE1pbnRhYmxlRVJDMjAgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IEVSQzIwQ29udHJvbGxlciB9IGZyb20gXCIuLi90b2tlbnMvZXJjMjBDb250cm9sbGVyXCI7XG5pbXBvcnQgeyBQcm92aWRlck9yU2lnbmVyIH0gZnJvbSBcIi4uLy4uL2xvY2FsVHlwZXNcIjtcblxuXG5cbmV4cG9ydCBjbGFzcyBFUkMyME1hdGljQ29udHJvbGxlciBleHRlbmRzIEVSQzIwQ29udHJvbGxlciB7XG5cbiAgICBwcml2YXRlIF9lcmMyME1hdGljQWRkcmVzczogc3RyaW5nO1xuICAgIHByaXZhdGUgX2VyYzIwTWF0aWNDb250cmFjdD8gOiBDaGlsZE1pbnRhYmxlRVJDMjBcblxuICAgIGNvbnN0cnVjdG9yKGVyYzIwTWF0aWNBZGRyZXNzOiBzdHJpbmcsIHNpZ25lck9yUHJvdmlkZXI6IFByb3ZpZGVyT3JTaWduZXIpIHtcbiAgICAgICAgc3VwZXIoZXJjMjBNYXRpY0FkZHJlc3MsIHNpZ25lck9yUHJvdmlkZXIpO1xuICAgICAgICB0aGlzLl9lcmMyME1hdGljQWRkcmVzcyA9IGVyYzIwTWF0aWNBZGRyZXNzO1xuXG4gICAgICAgIGlmKHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBTaWduZXIgfHwgc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1NpZ25lcikge1xuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gc2lnbmVyT3JQcm92aWRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYjNXcmFwcGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHNpZ25lck9yUHJvdmlkZXIpIFxuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gd2ViM1dyYXBwZXIuZ2V0U2lnbmVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2dldEVSQzIwTWF0aWNDb250cmFjdCgpOiBQcm9taXNlPENoaWxkTWludGFibGVFUkMyMD4ge1xuICAgICAgICBpZih0aGlzLl9lcmMyME1hdGljQ29udHJhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lcmMyME1hdGljQ29udHJhY3Q7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ29ubmVjdCB0byB0aGUgY29udHJhY3Qgd2l0aCBteSBzaWduZXJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgZ2V0RVJDMjBNYXRpY0NvbnRyYWN0KHRoaXMuX2VyYzIwTWF0aWNBZGRyZXNzLCB0aGlzLl9zaWduZXIpO1xuICAgICAgICAgICAgdGhpcy5fZXJjMjBNYXRpY0NvbnRyYWN0ID0gY29udHJhY3Q7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhY3Q7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBGYWlsZWQgdG8gZ2V0IENoaWxkTWludGFibGVFUkMyMCBjb250cmFjdDogJHtlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqR2V0dGVycyAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRDb250cmFjdCgpOiBQcm9taXNlPENoaWxkTWludGFibGVFUkMyMD4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldEVSQzIwTWF0aWNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3RcbiAgICB9XG5cblxuICAgIC8qKiBTZXR0ZXJzICovICAgIFxuICAgIHB1YmxpYyBhc3luYyBkZXBvc2l0KHVzZXI6IHN0cmluZywgZGVwb3NpdERhdGE6IEJ5dGVzTGlrZSk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldEVSQzIwTWF0aWNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZnVuY3Rpb25zLmRlcG9zaXQodXNlciwgZGVwb3NpdERhdGEpXG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHdpdGhkcmF3KGFtb3VudDogc3RyaW5nKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0RVJDMjBNYXRpY0NvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMud2l0aGRyYXcoYW1vdW50KVxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBtaW50KHNlbmRlcjogc3RyaW5nLCBhbW91bnQ6IHN0cmluZyk6IFByb21pc2U8Q29udHJhY3RUcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldEVSQzIwTWF0aWNDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3QuZnVuY3Rpb25zLm1pbnQoc2VuZGVyLCBhbW91bnQpXG4gICAgfVxuXG4gIFxuICAgIC8qKiBIZWxwZXJzICovXG4gICAgcHVibGljIHN0YXRpYyBlbmNvZGVDYWxsKGZ1bmN0aW9uTmFtZTogc3RyaW5nLCBhcmdzPzogYW55W10pOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gZW5jb2RlKGFydGlmYWN0LCBmdW5jdGlvbk5hbWUsIGFyZ3MpXG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBkZWNvZGVDYWxsKGRhdGE6IHN0cmluZyk6IERlY29kZWRDYWxsIHwgbnVsbCB7XG4gICAgICAgIHJldHVybiBkZWNvZGUoYXJ0aWZhY3QsIGRhdGEpXG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIG9uRXZlbnQoZmlsdGVyOiBFdmVudEZpbHRlciwgb25Db250cmFjdGV2ZW50OiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldEVSQzIwTWF0aWNDb250cmFjdCgpO1xuICAgICAgICBjb250cmFjdC5vbmNlKGZpbHRlciwgKGZyb206IHN0cmluZywgdG86IHN0cmluZywgdmFsdWU6IEJpZ051bWJlcmlzaCwgZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgb25Db250cmFjdGV2ZW50KHtmcm9tLCB0bywgdmFsdWUsIGV2ZW50fSlcbiAgICAgICAgfSlcbiAgICB9XG59Il19
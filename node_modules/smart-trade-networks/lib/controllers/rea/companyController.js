"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CompanyController = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _ethers = require("ethers");

var _prefabContractFactory = require("../../chain/prefabContractFactory");

var CompanyController = /*#__PURE__*/function () {
  function CompanyController(companyAddress, signerOrProvider) {
    (0, _classCallCheck2["default"])(this, CompanyController);
    (0, _defineProperty2["default"])(this, "_companyAddress", void 0);
    (0, _defineProperty2["default"])(this, "_signer", void 0);
    (0, _defineProperty2["default"])(this, "_companyContract", void 0);
    this._companyAddress = companyAddress;

    if (signerOrProvider instanceof _ethers.Signer || signerOrProvider instanceof _ethers.ethers.providers.JsonRpcSigner) {
      this._signer = signerOrProvider;
    } else {
      var web3Wrapper = new _ethers.ethers.providers.Web3Provider(signerOrProvider);
      this._signer = web3Wrapper.getSigner();
    }
  }

  (0, _createClass2["default"])(CompanyController, [{
    key: "_getCompanyContract",
    value: function () {
      var _getCompanyContract2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var contract;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!this._companyContract) {
                  _context.next = 2;
                  break;
                }

                return _context.abrupt("return", this._companyContract);

              case 2:
                _context.prev = 2;
                _context.next = 5;
                return (0, _prefabContractFactory.getCompanyContract)(this._companyAddress, this._signer);

              case 5:
                contract = _context.sent;
                this._companyContract = contract;
                return _context.abrupt("return", contract);

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](2);
                throw Error("Failed to get Company contract: ".concat(_context.t0));

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 10]]);
      }));

      function _getCompanyContract() {
        return _getCompanyContract2.apply(this, arguments);
      }

      return _getCompanyContract;
    }()
    /**Getters */

  }, {
    key: "getContract",
    value: function () {
      var _getContract = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var contract;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._getCompanyContract();

              case 2:
                contract = _context2.sent;
                return _context2.abrupt("return", contract);

              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getContract() {
        return _getContract.apply(this, arguments);
      }

      return getContract;
    }()
  }, {
    key: "getData",
    value: function () {
      var _getData = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
        var contract;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._getCompanyContract();

              case 2:
                contract = _context3.sent;
                return _context3.abrupt("return", contract.getData());

              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function getData() {
        return _getData.apply(this, arguments);
      }

      return getData;
    }()
    /** Setters */

  }, {
    key: "changeName",
    value: function () {
      var _changeName = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(name) {
        var contract;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._getCompanyContract();

              case 2:
                contract = _context4.sent;
                return _context4.abrupt("return", contract.functions.changeName(name));

              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function changeName(_x) {
        return _changeName.apply(this, arguments);
      }

      return changeName;
    }()
  }, {
    key: "changeIpfsLink",
    value: function () {
      var _changeIpfsLink = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(ipfsLink) {
        var contract;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._getCompanyContract();

              case 2:
                contract = _context5.sent;
                return _context5.abrupt("return", contract.functions.changeIpfsLink(ipfsLink));

              case 4:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function changeIpfsLink(_x2) {
        return _changeIpfsLink.apply(this, arguments);
      }

      return changeIpfsLink;
    }()
  }]);
  return CompanyController;
}();

exports.CompanyController = CompanyController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVycy9yZWEvY29tcGFueUNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiQ29tcGFueUNvbnRyb2xsZXIiLCJjb21wYW55QWRkcmVzcyIsInNpZ25lck9yUHJvdmlkZXIiLCJfY29tcGFueUFkZHJlc3MiLCJTaWduZXIiLCJldGhlcnMiLCJwcm92aWRlcnMiLCJKc29uUnBjU2lnbmVyIiwiX3NpZ25lciIsIndlYjNXcmFwcGVyIiwiV2ViM1Byb3ZpZGVyIiwiZ2V0U2lnbmVyIiwiX2NvbXBhbnlDb250cmFjdCIsImNvbnRyYWN0IiwiRXJyb3IiLCJfZ2V0Q29tcGFueUNvbnRyYWN0IiwiZ2V0RGF0YSIsIm5hbWUiLCJmdW5jdGlvbnMiLCJjaGFuZ2VOYW1lIiwiaXBmc0xpbmsiLCJjaGFuZ2VJcGZzTGluayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUdBOztJQVVhQSxpQjtBQU1ULDZCQUFZQyxjQUFaLEVBQW9DQyxnQkFBcEMsRUFBd0U7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNwRSxTQUFLQyxlQUFMLEdBQXVCRixjQUF2Qjs7QUFFQSxRQUFHQyxnQkFBZ0IsWUFBWUUsY0FBNUIsSUFBc0NGLGdCQUFnQixZQUFZRyxlQUFPQyxTQUFQLENBQWlCQyxhQUF0RixFQUFxRztBQUNqRyxXQUFLQyxPQUFMLEdBQWVOLGdCQUFmO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsVUFBTU8sV0FBVyxHQUFHLElBQUlKLGVBQU9DLFNBQVAsQ0FBaUJJLFlBQXJCLENBQWtDUixnQkFBbEMsQ0FBcEI7QUFDQSxXQUFLTSxPQUFMLEdBQWVDLFdBQVcsQ0FBQ0UsU0FBWixFQUFmO0FBQ0g7QUFDSjs7Ozs7K0dBRUQ7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEscUJBQ08sS0FBS0MsZ0JBRFo7QUFBQTtBQUFBO0FBQUE7O0FBQUEsaURBRWUsS0FBS0EsZ0JBRnBCOztBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQU8rQiwrQ0FBbUIsS0FBS1QsZUFBeEIsRUFBeUMsS0FBS0ssT0FBOUMsQ0FQL0I7O0FBQUE7QUFPY0ssZ0JBQUFBLFFBUGQ7QUFRUSxxQkFBS0QsZ0JBQUwsR0FBd0JDLFFBQXhCO0FBUlIsaURBU2VBLFFBVGY7O0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBWWNDLEtBQUssd0RBWm5COztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7O0FBZ0JBOzs7Ozt1R0FDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQUMyQixLQUFLQyxtQkFBTCxFQUQzQjs7QUFBQTtBQUNVRixnQkFBQUEsUUFEVjtBQUFBLGtEQUVXQSxRQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7Ozs7O21HQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQzJCLEtBQUtFLG1CQUFMLEVBRDNCOztBQUFBO0FBQ1VGLGdCQUFBQSxRQURWO0FBQUEsa0RBRVdBLFFBQVEsQ0FBQ0csT0FBVCxFQUZYOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLE87Ozs7Ozs7O0FBS0E7Ozs7O3NHQUNBLGtCQUF3QkMsSUFBeEI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFDMkIsS0FBS0YsbUJBQUwsRUFEM0I7O0FBQUE7QUFDVUYsZ0JBQUFBLFFBRFY7QUFBQSxrREFFV0EsUUFBUSxDQUFDSyxTQUFULENBQW1CQyxVQUFuQixDQUE4QkYsSUFBOUIsQ0FGWDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxPOzs7Ozs7Ozs7OzswR0FLQSxrQkFBNEJHLFFBQTVCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQzJCLEtBQUtMLG1CQUFMLEVBRDNCOztBQUFBO0FBQ1VGLGdCQUFBQSxRQURWO0FBQUEsa0RBRVdBLFFBQVEsQ0FBQ0ssU0FBVCxDQUFtQkcsY0FBbkIsQ0FBa0NELFFBQWxDLENBRlg7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJpZ051bWJlcmlzaCwgQnl0ZXNMaWtlLCBDb250cmFjdFRyYW5zYWN0aW9uLCBldGhlcnMsIFNpZ25lciB9IGZyb20gXCJldGhlcnNcIjtcblxuaW1wb3J0IHsgQ29tcGFueSB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IHsgZ2V0Q29tcGFueUNvbnRyYWN0IH0gZnJvbSBcIi4uLy4uL2NoYWluL3ByZWZhYkNvbnRyYWN0RmFjdG9yeVwiO1xuaW1wb3J0IHsgUHJvdmlkZXJPclNpZ25lciB9IGZyb20gXCIuLi8uLi9sb2NhbFR5cGVzXCI7XG5cbnR5cGUgQ29tcGFueURhdGEgPSBbc3RyaW5nLCBzdHJpbmcsIEJpZ051bWJlcmlzaCwgc3RyaW5nXSAmIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgaXBmc0xpbms6IHN0cmluZztcbiAgICBjcmVhdGVkQXQ6IEJpZ051bWJlcmlzaDtcbiAgICBvd25lcjogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQ29tcGFueUNvbnRyb2xsZXIge1xuXG4gICAgcHJpdmF0ZSBfY29tcGFueUFkZHJlc3M6IHN0cmluZztcbiAgICBwcml2YXRlIF9zaWduZXI6IFNpZ25lcjtcbiAgICBwcml2YXRlIF9jb21wYW55Q29udHJhY3Q/IDogQ29tcGFueVxuXG4gICAgY29uc3RydWN0b3IoY29tcGFueUFkZHJlc3M6IHN0cmluZywgc2lnbmVyT3JQcm92aWRlcjogUHJvdmlkZXJPclNpZ25lcikge1xuICAgICAgICB0aGlzLl9jb21wYW55QWRkcmVzcyA9IGNvbXBhbnlBZGRyZXNzO1xuXG4gICAgICAgIGlmKHNpZ25lck9yUHJvdmlkZXIgaW5zdGFuY2VvZiBTaWduZXIgfHwgc2lnbmVyT3JQcm92aWRlciBpbnN0YW5jZW9mIGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1NpZ25lcikge1xuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gc2lnbmVyT3JQcm92aWRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYjNXcmFwcGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHNpZ25lck9yUHJvdmlkZXIpIFxuICAgICAgICAgICAgdGhpcy5fc2lnbmVyID0gd2ViM1dyYXBwZXIuZ2V0U2lnbmVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2dldENvbXBhbnlDb250cmFjdCgpOiBQcm9taXNlPENvbXBhbnk+IHtcbiAgICAgICAgaWYodGhpcy5fY29tcGFueUNvbnRyYWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY29tcGFueUNvbnRyYWN0O1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgdG8gdGhlIGNvbnRyYWN0IHdpdGggbXkgc2lnbmVyXG4gICAgICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldENvbXBhbnlDb250cmFjdCh0aGlzLl9jb21wYW55QWRkcmVzcywgdGhpcy5fc2lnbmVyKTtcbiAgICAgICAgICAgIHRoaXMuX2NvbXBhbnlDb250cmFjdCA9IGNvbnRyYWN0O1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRyYWN0O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgRmFpbGVkIHRvIGdldCBDb21wYW55IGNvbnRyYWN0OiAke2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipHZXR0ZXJzICovXG4gICAgcHVibGljIGFzeW5jIGdldENvbnRyYWN0KCk6IFByb21pc2U8Q29tcGFueT4ge1xuICAgICAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IHRoaXMuX2dldENvbXBhbnlDb250cmFjdCgpO1xuICAgICAgICByZXR1cm4gY29udHJhY3RcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0RGF0YSgpOiBQcm9taXNlPENvbXBhbnlEYXRhPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29tcGFueUNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5nZXREYXRhKCk7XG4gICAgfVxuXG4gICAgLyoqIFNldHRlcnMgKi9cbiAgICBwdWJsaWMgYXN5bmMgY2hhbmdlTmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPENvbnRyYWN0VHJhbnNhY3Rpb24+IHtcbiAgICAgICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCB0aGlzLl9nZXRDb21wYW55Q29udHJhY3QoKTtcbiAgICAgICAgcmV0dXJuIGNvbnRyYWN0LmZ1bmN0aW9ucy5jaGFuZ2VOYW1lKG5hbWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBjaGFuZ2VJcGZzTGluayhpcGZzTGluazogQnl0ZXNMaWtlKTogUHJvbWlzZTxDb250cmFjdFRyYW5zYWN0aW9uPiB7XG4gICAgICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgdGhpcy5fZ2V0Q29tcGFueUNvbnRyYWN0KCk7XG4gICAgICAgIHJldHVybiBjb250cmFjdC5mdW5jdGlvbnMuY2hhbmdlSXBmc0xpbmsoaXBmc0xpbmspO1xuICAgIH1cbn0iXX0=
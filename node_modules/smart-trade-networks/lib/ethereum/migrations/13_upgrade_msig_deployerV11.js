const V12 = artifacts.require('MultisigDeployer.sol');
const Proxy = artifacts.require('OwnedUpgradeabilityProxy.sol')
const abi = require('ethereumjs-abi');


function encodeCall(name, args, values) {
	const methodId = abi.methodID(name, args).toString('hex');
	const params = abi.rawEncode(args, values).toString('hex');
	return '0x' + methodId + params;
}

module.exports = async deployer => {

	/** Steps */

	/** 1: Deploy contract to upgrade */
	await deployer.deploy(V12);

	/** 2: Fetch deployed contract address */
	const deployed = await V12.deployed(); 

	/** 3: Fetch deployed proxy contract*/
	/**  const proxyAddress = "0x9db5E619cC4835065CaF005D93a34dBDae8BE4f5"; //Prod*/
	const proxyAddress = "0x525B301f7bEbd51E3eF36a66B083F704dCceb694"; //Dev 
	const contract = await V12.at(proxyAddress);

	/** 4: Encode data to initialize */
	const initData = encodeCall('initializeV1_1', [], []);

	/** 5: Upgrade proxy contract */
	/** await erc721Proxy.upgradeToAndCall(erc721deployed.address, initData); */

	/** Test with new contract functions */
	/** Fetch erc721 contract */
	/** const erc721 = await ERC721V12.at(erc721ProxyAddress); */
	/** call new functions */

	// await deployer.deploy(ERC721V12);

	/** 1: Deploy contract to upgrade */
	// await deployer.deploy(ERC721V12);

	// /** 2: Fetch deployed contract address */
	// const erc721deployed = await ERC721V12.deployed();

	// /** 3: Fetch deployed proxy contract*/
	const erc721ProxyAddress = "0x737614D2116Ada57A340E7d05fab0f03a35Be283";
	// const erc721Proxy = await ERC721Proxy.at(erc721ProxyAddress);

	// /** 4: Encode data to initialize */
	// const initData = encodeCall('initializeV121', [], []);

	// /** 5: Upgrade proxy contract */
	// await erc721Proxy.upgradeTo(erc721deployed.address);

	/** Test with new contract functions */
	/** Fetch erc721 contract */
	const erc721 = await ERC721V12.at(erc721ProxyAddress);
	/** call new functions */
	
	console.log("ownerOf 99977431", await erc721.ownerOf("99977431"))
	console.log("ownerOf 1000031157593", await erc721.ownerOf("1000031157593"))
	console.log("ownerOf 1000031157626", await erc721.ownerOf("1000031157626"))
	console.log("ownerOf 1000031157827", await erc721.ownerOf("1000031157827"))
}
{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/danildovgal/Desktop/protocol_zero/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { ethers, utils } from \"ethers\";\nimport { PureComponent } from \"react\";\nimport { Alert, Button, Container, Form, InputGroup, Spinner } from \"react-bootstrap\";\nimport { connect } from \"react-redux\";\nimport { addToken } from \"../../services/metamask\";\nimport { initBalances, reviewSwap as _reviewSwap, startAllowanceAndSwapSteps as _startAllowanceAndSwapSteps, startSwapStep as _startSwapStep } from \"../../store/actions\";\nimport { getBalances, getGasPrice, getGSNProvider, getPaymasterData, getTokenBalances, getWeb3State } from \"../../store/blockchain/selectors\";\nimport { Web3State } from \"../../types/blockchain\";\nvar maxGasUsage = 1600000;\nvar SwapState;\n\n(function (SwapState) {\n  SwapState[SwapState[\"Init\"] = 0] = \"Init\";\n  SwapState[SwapState[\"Loading\"] = 1] = \"Loading\";\n  SwapState[SwapState[\"Done\"] = 2] = \"Done\";\n})(SwapState || (SwapState = {}));\n\nvar SwapToken = /*#__PURE__*/function (_PureComponent) {\n  _inherits(SwapToken, _PureComponent);\n\n  var _super = _createSuper(SwapToken);\n\n  function SwapToken() {\n    var _this;\n\n    _classCallCheck(this, SwapToken);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      amount: \"\",\n      swapState: SwapState.Init,\n      txHash: null,\n      gasUsed: \"\",\n      selectedToken: process.env.ZRO_TOKEN,\n      txPrice: \"\",\n      errorMessage: null,\n      reviewSwap: false,\n      swapReviewResponse: \"\",\n      deposited: \"\",\n      withdrawn: \"\"\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"addToken\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(token) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return addToken(token);\n\n              case 3:\n                _context.next = 8;\n                break;\n\n              case 5:\n                _context.prev = 5;\n                _context.t0 = _context[\"catch\"](0);\n                console.log(_context.t0);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 5]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"onSwap\", function (res) {\n      if (res.error) {\n        return _this.setState({\n          swapState: SwapState.Init,\n          errorMessage: res.message\n        });\n      }\n\n      _this.setState({\n        txHash: res.data.txHash,\n        gasUsed: res.data.gasUsed,\n        swapState: SwapState.Done,\n        txPrice: res.data.txPrice,\n        deposited: res.data.deposited,\n        withdrawn: res.data.withdrawn\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"reviewSwap\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _this$state, selectedToken, amount, tokensBalance, tokenBalance, swapReviewResponse;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$state = _this.state, selectedToken = _this$state.selectedToken, amount = _this$state.amount;\n\n              if (!(selectedToken === \"\")) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", null);\n\n            case 3:\n              tokensBalance = _this.props.tokensBalance;\n              tokenBalance = tokensBalance.find(function (t) {\n                return t.token.address === selectedToken;\n              });\n              _context2.next = 7;\n              return _this.props.reviewSwap(amount, tokenBalance.token);\n\n            case 7:\n              swapReviewResponse = _context2.sent;\n\n              _this.setState({\n                swapReviewResponse: ethers.utils.formatEther(swapReviewResponse)\n              });\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"swap\", /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(address) {\n        var _this$state2, amount, reviewSwap, _this$props, tokensBalance, paymasterData, tokenBalance, amountBN, feeBN, allowanceBN, minAllowanceBN, message;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this$state2 = _this.state, amount = _this$state2.amount, reviewSwap = _this$state2.reviewSwap;\n\n                if (reviewSwap) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                _this.setState({\n                  reviewSwap: true\n                });\n\n                return _context3.abrupt(\"return\", _this.reviewSwap());\n\n              case 4:\n                _this.setState({\n                  swapState: SwapState.Loading,\n                  errorMessage: null\n                });\n\n                _this$props = _this.props, tokensBalance = _this$props.tokensBalance, paymasterData = _this$props.paymasterData;\n                tokenBalance = tokensBalance.find(function (t) {\n                  return t.token.address === address;\n                });\n                amountBN = utils.parseUnits(amount, tokenBalance.token.decimals);\n                feeBN = utils.parseUnits(paymasterData.paymentData.fee, tokenBalance.token.decimals);\n                allowanceBN = utils.parseUnits(tokenBalance.tokenSwapAllowance, tokenBalance.token.decimals);\n                _context3.prev = 10;\n                minAllowanceBN = amountBN.add(feeBN);\n\n                if (!allowanceBN.lt(minAllowanceBN)) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                _context3.next = 15;\n                return _this.props.startAllowanceAndSwapSteps(tokenBalance.token, process.env.GSN_TOKEN_SWAP, amount, _this.onSwap);\n\n              case 15:\n                _context3.next = 18;\n                break;\n\n              case 17:\n                _this.props.startSwapStep(tokenBalance.token, amount, _this.onSwap);\n\n              case 18:\n                _context3.next = 24;\n                break;\n\n              case 20:\n                _context3.prev = 20;\n                _context3.t0 = _context3[\"catch\"](10);\n                message = _context3.t0.message;\n\n                if (message.startsWith(\"user rejected transaction\")) {} else if (message.includes(\"Not enough to pay for tx\")) {\n                  _this.setState({\n                    swapState: SwapState.Init,\n                    errorMessage: \"Not enough to pay for tx, try swapping more tokens\"\n                  });\n                }\n\n              case 24:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[10, 20]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"renderTokenInfo\", function () {\n      var selectedToken = _this.state.selectedToken;\n      if (selectedToken === \"\") return null;\n      var tokensBalance = _this.props.tokensBalance;\n      var tokenBalance = tokensBalance.find(function (t) {\n        return t.token.address === selectedToken;\n      });\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsxs(\"strong\", {\n            children: [tokenBalance.token.symbol, \" Balance: \"]\n          }), /*#__PURE__*/_jsx(\"span\", {\n            children: Number(utils.formatUnits(tokenBalance.balance)).toLocaleString()\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"strong\", {}), /*#__PURE__*/_jsxs(\"span\", {\n            children: [\"1 ETH  = \", Number(utils.formatUnits(tokenBalance.uniswapValue)).toLocaleString(), \" \", tokenBalance.token.symbol]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"strong\", {\n            children: \"Total Supply: \"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            children: Number(tokenBalance.totalSupply).toLocaleString()\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"strong\", {\n            children: \"Total Burned: \"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            children: Number(tokenBalance.burned).toLocaleString()\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          children: /*#__PURE__*/_jsx(Button, {\n            variant: \"link\",\n            onClick: function onClick() {\n              return _this.addToken(tokenBalance.token);\n            },\n            children: \"Add token To Metamask\"\n          })\n        })]\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderAmountToGet\", function () {\n      var _this$state3 = _this.state,\n          amount = _this$state3.amount,\n          selectedToken = _this$state3.selectedToken,\n          reviewSwap = _this$state3.reviewSwap,\n          swapReviewResponse = _this$state3.swapReviewResponse;\n      if (amount === \"\" || isNaN(parseFloat(amount))) return null;\n      var title = reviewSwap ? \"Swap\" : \"Review Swap\";\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [swapReviewResponse === \"\" ? null : /*#__PURE__*/_jsxs(\"small\", {\n          children: [swapReviewResponse, \" ETH\"]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          children: /*#__PURE__*/_jsx(Button, {\n            className: \"swap_button\",\n            onClick: function onClick() {\n              return _this.swap(selectedToken);\n            },\n            children: title\n          })\n        })]\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderSwapInfo\", function () {\n      var _this$state4 = _this.state,\n          swapState = _this$state4.swapState,\n          txHash = _this$state4.txHash,\n          gasUsed = _this$state4.gasUsed,\n          selectedToken = _this$state4.selectedToken,\n          errorMessage = _this$state4.errorMessage,\n          deposited = _this$state4.deposited,\n          withdrawn = _this$state4.withdrawn;\n      if (selectedToken === \"\") return null;\n      var tokensBalance = _this.props.tokensBalance;\n\n      if (swapState === SwapState.Loading) {\n        return /*#__PURE__*/_jsx(Spinner, {\n          animation: \"border\",\n          role: \"status\",\n          children: /*#__PURE__*/_jsx(\"span\", {\n            className: \"visually-hidden\"\n          })\n        });\n      } else if (swapState === SwapState.Done) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"div\", {\n            children: \"Transaction Mined\"\n          }), /*#__PURE__*/_jsx(\"a\", {\n            target: \"_blank\",\n            href: \"https://goerli.etherscan.io/tx/\".concat(txHash),\n            children: \"View on Goerli\"\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"strong\", {\n              children: \"Gas Used: \"\n            }), gasUsed]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"strong\", {\n              children: \"Amount Swapped: \"\n            }), deposited, \" ETH\"]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"strong\", {\n              children: \"Amount Gotten: \"\n            }), withdrawn, \" ETH\"]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"strong\", {\n              children: \"Amount Charged: \"\n            }), parseFloat(deposited) - parseFloat(withdrawn), \" ETH\"]\n          })]\n        });\n      } else if (swapState === SwapState.Init && errorMessage) {\n        return /*#__PURE__*/_jsx(Alert, {\n          variant: \"danger\",\n          onClose: function onClose() {\n            return _this.setState({\n              errorMessage: null\n            });\n          },\n          dismissible: true,\n          children: errorMessage\n        });\n      }\n\n      return /*#__PURE__*/_jsx(Container, {\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(InputGroup, {\n            className: \"mb-3\",\n            style: {\n              width: \"200px\",\n              margin: \"5px auto 0px auto\"\n            },\n            children: /*#__PURE__*/_jsx(Form.Control, {\n              className: \"swap\",\n              placeholder: \"Amount to swap\",\n              \"aria-label\": \"Amount to swap\",\n              \"aria-describedby\": \"basic-addon1\",\n              type: \"number\",\n              value: _this.state.amount,\n              onChange: function onChange(_ref4) {\n                var target = _ref4.target;\n                return _this.setState({\n                  amount: target.value,\n                  errorMessage: null,\n                  reviewSwap: false,\n                  swapReviewResponse: \"\"\n                });\n              }\n            })\n          }), _this.renderAmountToGet()]\n        })\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderUserInfo\", function () {\n      var ethBalance = _this.props.ethBalance;\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(\"strong\", {\n          children: \"ETH Balance: \"\n        }), /*#__PURE__*/_jsx(\"span\", {\n          children: Number(utils.formatUnits(ethBalance.balance)).toLocaleString()\n        })]\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(SwapToken, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props2 = this.props,\n          ethBalance = _this$props2.ethBalance,\n          tokensBalance = _this$props2.tokensBalance,\n          web3State = _this$props2.web3State;\n      if (web3State !== Web3State.Done || !ethBalance || tokensBalance.length === 0) return null;\n      return /*#__PURE__*/_jsxs(\"div\", {\n        className: \"tokens_info\",\n        children: [this.renderUserInfo(), this.renderTokenInfo(), this.renderSwapInfo()]\n      });\n    }\n  }]);\n\n  return SwapToken;\n}(PureComponent);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    ethBalance: getBalances(state),\n    tokensBalance: getTokenBalances(state),\n    gsnProvider: getGSNProvider(state),\n    gasPrice: getGasPrice(state),\n    web3State: getWeb3State(state),\n    paymasterData: getPaymasterData(state)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    fetchBalances: function fetchBalances() {\n      return dispatch(initBalances());\n    },\n    startAllowanceAndSwapSteps: function startAllowanceAndSwapSteps(token, to, amount, callback) {\n      return dispatch(_startAllowanceAndSwapSteps(token, to, amount, callback));\n    },\n    startSwapStep: function startSwapStep(token, amount, callback) {\n      return dispatch(_startSwapStep(token, amount, callback));\n    },\n    reviewSwap: function reviewSwap(amount, token) {\n      return dispatch(_reviewSwap(amount, token));\n    }\n  };\n};\n\nvar SwapTokenContainer = connect(mapStateToProps, mapDispatchToProps)(SwapToken);\nexport { SwapTokenContainer };","map":null,"metadata":{},"sourceType":"module"}